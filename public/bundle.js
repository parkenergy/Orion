angular.module("Orion.Controllers",[]),angular.module("Orion.Components",[]),angular.module("Orion.Directives",[]),angular.module("CommonControllers",[]),angular.module("CommonComponents",[]),angular.module("CommonDirectives",[]),angular.module("CommonServices",["ngRoute","ngResource","ngCookies"]),angular.module("Orion.Services",["ngRoute","ngResource","ngCookies","ui.utils"]),angular.module("Orion",["CommonControllers","CommonComponents","CommonDirectives","CommonServices","Orion.Controllers","Orion.Components","Orion.Directives","Orion.Services","UnitApp","PaidTimeOffApp","PartOrderApp","CallReportApp","WorkOrderApp","MCDiligenceApp","ui.bootstrap","ui.utils","satellizer"]),angular.module("Orion").config(["$routeProvider","$authProvider",function($routeProvider,$authProvider){$routeProvider.when("/",{controller:"LoginCtrl",templateUrl:"/lib/public/angular/views/controller.views/clientLogin.html"}).when("/myaccount",{needsLogin:!0,controller:"MyAccountCtrl",templateUrl:"/lib/public/angular/views/controller.views/myaccount.html",resolve:{users:function($route,$q,Users){return Users.query({size:1e5}).$promise},units:function($route,$q,Units){return Units.query({size:1e5}).$promise}}}).when("/areapmreport/:name",{needsLogin:!0,controller:"AreaPMReportCtrl",templateUrl:"/lib/public/angular/views/controller.views/areapmreport.html",resolve:{users:function($route,$q,Users){let locationName=$route.current.params.name;return Users.query({regexArea:locationName,size:1e5}).$promise},units:function($route,$q,Units){return Units.query({size:1e5}).$promise},areaName:function($route){return $route.current.params.name}}}).when("/areapmreport/:name/:user",{needsLogin:!0,controller:"UserPMReportCtrl",templateUrl:"/lib/public/angular/views/controller.views/userpmreport.html",resolve:{users:function($route,$q,Users){let username=$route.current.params.user;return Users.query({userName:username}).$promise}}}),$authProvider.google({url:"/auth/google",authorizationEndpoint:"https://accounts.google.com/o/oauth2/auth",redirectUri:window.location.origin,requiredUrlParams:["scope"],optionalUrlParams:["display"],scope:["profile","email"],scopePrefix:"openid",scopeDelimiter:" ",display:"popup",type:"2.0",popupOptions:{width:452,height:633},clientId:"402483966217-5crk767d69pcn25dhds4htv3o67kdpuc.apps.googleusercontent.com",responseType:"token"}),$authProvider.httpInterceptor=function(){return!0},$authProvider.withCredentials=!0,$authProvider.tokenRoot=null,$authProvider.baseUrl="/",$authProvider.loginUrl="/auth/login",$authProvider.signupUrl="/auth/signup",$authProvider.unlinkUrl="/auth/unlink/",$authProvider.tokenName="token",$authProvider.tokenPrefix="satellizer",$authProvider.authHeader="Authorization",$authProvider.authToken="Bearer",$authProvider.storageType="localStorage"}]).factory("authProvider",["$cookies","$location","SessionService",function($cookies,$location,SessionService){return{isLoggedIn:function(){const currentPath=$location.path(),SS=SessionService;return!!($cookies.get("tech")&&localStorage.getItem("satellizer_token")&&SS.get("loggedIn"))||("/"!==currentPath&&(SS.add("loggedIn",!0),$cookies.put("OrionNotLoggedInRoute",currentPath)),!1)}}}]).run(["$rootScope","$location","authProvider",function($rootScope,$location,authProvider){$rootScope.$on("$routeChangeStart",function(event){const currentPath=$location.path();new RegExp("/wpi","i").test(currentPath)||(authProvider.isLoggedIn()?console.log("here?"):$location.path("/"))})}]);
angular.module("CommonControllers").controller("AreaPMReportCtrl",["$scope","users","units","areaName","ApiRequestService",function($scope,users,units,areaName,ApiRequestService){const ARS=ApiRequestService,searchedUsers=[];$scope.users=users,$scope.units=units,$scope.areaName=areaName,$scope.users.forEach(user=>{"admin"!==user.role&&searchedUsers.push(user)});const obj={users:JSON.stringify(searchedUsers)};ARS.http.get.WorkOrdersUnapprovedByUser(obj).then(res=>{res.data.forEach(unapprovedObj=>{$scope.users.forEach(user=>{user.username===unapprovedObj.user&&(user.unapprovedCount=unapprovedObj.count)})})},err=>{console.log(`Error retrieving unapproved for user: ${err}`)})}]);
angular.module("CommonControllers").controller("LoginCtrl",["$scope","$http","$location","$routeParams","$window","$cookies","AlertService","Users","$auth",function($scope,$http,$location,$routeParams,$window,$cookies,AlertService,Users,$auth){$scope.hideLocalLogin=!1,$scope.title="Login",$scope.message="Use your local login to access the system.",$scope.returnUrl=$routeParams.returnUrl,$scope.fragment=$routeParams.fragment,$location.search({}),"true"===$routeParams.failure&&AlertService.add("info","We were unable to log you in. Please try again."),$scope.localLogin=function(){console.log("localLogin"),$scope.username=$scope.username.toUpperCase(),console.log($scope.username),AlertService.add("info","Login Successful!",1e3),$location.path($scope.fragment||"myaccount")},$scope.authenticate=function(provider){console.log("authenticate called"),$auth.authenticate(provider).then(function(){$http.get("/api/identify").then(function(res){console.log("authorized"),console.log("Authed as: ",res.data.username),$cookies.put("tech",res.data.username||"Logged Out"),$cookies.put("role",res.data.role);const OrionNotLoggedInRoute=$cookies.get("OrionNotLoggedInRoute");OrionNotLoggedInRoute?($cookies.remove("OrionNotLoggedInRoute"),$location.path(OrionNotLoggedInRoute)):$location.path("myaccount")}).catch(function(res){console.log("did not auth"),AlertService.add("danger",res,1e3)})}).catch(function(err){console.log(err),AlertService.add("danger","Login Failed!",1e3)})},$scope.showLocalLogin=function(){$scope.hideLocalLogin=!1}}]);
angular.module("CommonControllers").controller("MyAccountCtrl",["$window","$scope","users","units","ApiRequestService","SessionService",function($window,$scope,users,units,ApiRequestService,SessionService){const ARS=ApiRequestService,SS=SessionService,searchUsers=[],searchedAreas=[],resData=[];$scope.units=units,$scope.users=users,$scope.areas=[],$window.onhashchange=(()=>SS.drop("unitNumber"));$scope.users.forEach(user=>{"admin"!==user.role&&searchUsers.push(user)});const obj={users:JSON.stringify(searchUsers)};ARS.http.get.WorkOrdersUnapprovedArea(obj).then(res=>{res.data.forEach(a=>{const thisArea={area:"",count:0};thisArea.area=a.area.split(":")[0].slice(2).trim(),thisArea.count=a.count,-1===searchedAreas.indexOf(thisArea.area)&&""!==thisArea.area&&searchedAreas.push(thisArea.area),resData.push(thisArea)}),searchedAreas.forEach(name=>{const thisArea={area:"",count:0};thisArea.area=name,resData.forEach(a=>{a.area===name&&(thisArea.count+=a.count)}),$scope.areas.push(thisArea)})},err=>{console.log(`Error retrieving unapproved by area: ${err}`)})}]);
angular.module("CommonControllers").controller("UserPMReportCtrl",["$window","$scope","users","ApiRequestService","AlertService",function($window,$scope,users,ApiRequestService,AlertService){$scope.user=users[0],$scope.spinner=!0,$scope.loaded=!0;const ARS=ApiRequestService;$scope.spinnerOff=(()=>{$scope.spinner=!1}),$scope.spinnerOn=(()=>{$scope.spinner=!0}),$scope.getWorkOrders=(days=>{$scope.loaded=!1,$scope.spinnerOn();const now=(new Date).getTime(),query={};if(query.tech=$scope.user.username,query.noSplitInfo=!0,0===days){const todayHours=36e5*now.getHours();query.from=now-todayHours,query.to=now}else{const minusDays=864e5*days;query.from=new Date(now-minusDays),query.to=new Date(now)}query.limit=1e5,ARS.Units({tech:$scope.user.username,size:500}).then(res=>$scope.units=res).catch(err=>console.log(err)),ARS.WorkOrders(query).then(res=>{$scope.workorders=res,$scope.spinnerOff(),$scope.loaded=!0,0===res.length&&AlertService.add("info",`No work orders found from ${days} days ago`)}).catch(err=>console.log(err))}),$scope.getWorkOrders(45)}]);
angular.module("CommonComponents").component("areaPmDash",{templateUrl:"/lib/public/angular/views/component.views/areaPmDash.html",bindings:{units:"<",users:"<",areaName:"<"},controller:["$location","$timeout","PmDashService",class AreaPmDashCtrl{constructor($location,$timeout,PmDashService){this.$location=$location,this.$timeout=$timeout,this.PMS=PmDashService,this.init=null,this.activePMStatus=0,this.active=0,this.test=0,this.idle=0,this.total=0,this.activeReg=new RegExp("Active","i"),this.testReg=new RegExp("Test","i"),this.idleReg=new RegExp("Idle","i"),this.usersUnits=[],this.displayUsers=[],this.activeUnits=[],this.usernames=[],this.sortReverse=!1,this.sortType="percent"}setDisplayUnapproved(){this.displayUsers.forEach(du=>{this.users.forEach(user=>{du.username===user.username&&(du.unapproved=user.unapprovedCount)})})}$onInit(){this.users.forEach(user=>{this.usernames.push(user.username);const thisUser=this.newDisplayUser();user.hasOwnProperty("hours")&&(thisUser.totalHours=user.hours.total),thisUser.username=user.username,thisUser.name=user.firstName.concat(" ").concat(user.lastName),user.email&&this.displayUsers.push(thisUser)}),this.displayUsers.forEach(user=>{this.units.forEach(unit=>{unit.assignedTo===user.username&&this.usersUnits.push(unit)})}),this.displayUsers.forEach(user=>{const thisUsersUnits=[];this.usersUnits.forEach(unit=>{unit.assignedTo===user.username&&(this.total+=1,thisUsersUnits.push(unit),unit.status.match(this.activeReg)?(this.active+=1,user.activeUnits+=1):unit.status.match(this.testReg)?(this.test+=1,user.testUnits+=1):unit.status.match(this.idleReg)&&(this.idle+=1,user.idleUnits+=1))}),thisUsersUnits.length>0?0===user.activeUnits?user.percent=-1:user.percent=+(100*this.PMS.returnUnitsPmPercent(thisUsersUnits)).toFixed(2):user.percent=-1}),this.activePMStatus=this.PMS.totalPercent(this.displayUsers).toFixed(0),isNaN(this.activePMStatus)&&(this.activePMStatus=0)}$doCheck(){this.users[0].hasOwnProperty("unapprovedCount")&&null===this.init&&(this.$timeout(()=>{this.setDisplayUnapproved()}),this.init=!0)}resort(by){this.sortType=by,this.sortReverse=!this.sortReverse}newDisplayUser(){return{username:"",name:"",unapproved:0,idleUnits:0,totalHours:0,activeUnits:0,testUnits:0,percent:0}}routeToUser(user){const username=user.username;this.$location.url(`/areapmreport/${this.areaName}/${username}`)}}]});
angular.module("CommonComponents").component("pmDash",{templateUrl:"/lib/public/angular/views/component.views/pmReport.html",bindings:{units:"<",users:"<",unapproved:"<"},controller:["$timeout","$location","PmDashService","SessionService",class PmDashCtrl{constructor($timeout,$location,PmDashService,SessionService){this.$timeout=$timeout,this.$location=$location,this.PMS=PmDashService,this.SS=SessionService,this.activePMStatus=0,this.activeUnitPMStatus=0,this.active=0,this.test=0,this.idle=0,this.total=0,this.activeReg=new RegExp("Active","i"),this.testReg=new RegExp("Test","i"),this.idleReg=new RegExp("Idle","i"),this.soldReg=new RegExp("Sold","i"),this.areas=[],this.activeUnits=[],this.userAreas=[],this.fullNameAreas=[],this.displayUsers=[],this.sortReverse=!1,this.sortType="percent",this.didCheck=!1}$onInit(){this.users.forEach(user=>{if(user.area&&user.email){const thisUser=this.newUser();thisUser.username=user.username,thisUser.area=user.area.split(":")[0].slice(2).trim(),user.hasOwnProperty("hours")&&(thisUser.totalHours=+user.hours.total);const area=user.area.split(":")[0].slice(2).trim();if(this.displayUsers.push(thisUser),-1===this.userAreas.indexOf(area)&&"CORPORATE"!==area){this.userAreas.push(area),this.fullNameAreas.push(user.area);const thisArea=this.newArea();thisArea.locationName=area,this.areas.push(thisArea)}}}),this.areas.forEach(area=>{this.displayUsers.forEach(user=>{area.locationName===user.area&&area.users.push(user)})}),this.areas.forEach(area=>{let areaAvg=0,userCount=0;const areaUnits=[];area.users.forEach(user=>{user.hasOwnProperty("totalHours")&&0!=+user.totalHours&&(userCount+=1,areaAvg+=+user.totalHours);const thisUsersUnits=[];this.units.forEach(unit=>{unit.assignedTo===user.username&&(thisUsersUnits.push(unit),areaUnits.push(unit),unit.status.match(this.activeReg)?user.activeUnits+=1:unit.status.match(this.testReg)?user.testUnits+=1:unit.status.match(this.idleReg)&&(user.idleUnits+=1))}),thisUsersUnits.length>0&&(user.percent=+(100*this.PMS.returnUnitsPmPercent(thisUsersUnits)).toFixed(2));const activeUnits=this.PMS.returnActiveUnits(thisUsersUnits),idleUnits=this.PMS.returnIdleUnits(thisUsersUnits);area.idleUnits+=idleUnits.length,area.activeUnits+=activeUnits.length});const afterFilter=area.users.filter(obj=>0!==obj.idleUnits||0!==obj.activeUnits);areaUnits.length>0&&(area.unitPercent=+(100*this.PMS.returnUnitsPmPercent(areaUnits)).toFixed(0)),area.areaAvg=0===areaAvg?+(0).toFixed(2):+(+areaAvg/+userCount).toFixed(2),area.percent=+this.PMS.totalPercent(afterFilter).toFixed(0),isNaN(area.percent)&&(area.percent=0)}),this.setHeader()}$doCheck(){this.areas.length>0&&this.unapproved.length>0&&!1===this.didCheck&&(this.didCheck=!0,this.areas.forEach(a=>{this.unapproved.forEach(u=>{a.locationName===u.area&&(a.unapproved=u.count)})}))}resort(by){this.sortType=by,this.sortReverse=!this.sortReverse}newArea(){return{locationName:"",unapproved:0,areaAvg:0,idleUnits:0,activeUnits:0,unitPercent:0,users:[],percent:0}}newUser(){return{username:"",area:"",idleUnits:0,totalHours:0,activeUnits:0,testUnits:0,percent:0}}setHeader(){this.units.forEach(unit=>{unit.status.match(this.soldReg)||(this.total+=1),unit.status.match(this.activeReg)?this.active+=1:unit.status.match(this.testReg)?this.test+=1:unit.status.match(this.idleReg)&&(this.idle+=1)}),this.activeUnitPMStatus=this.PMS.totalUnitPercent(this.areas).toFixed(0),this.activePMStatus=this.PMS.totalPercent(this.areas).toFixed(0)}routeToArea(area){const location=area.locationName;this.$location.path(`/areapmreport/${location}`)}}]});
angular.module("CommonComponents").component("userPmDash",{templateUrl:"/lib/public/angular/views/component.views/userPmDash.html",bindings:{updateWorkOrders:"&",spin:"<",loaded:"<",user:"<",units:"<",workorders:"<"},controller:["$window","$timeout","$location","PmDashService","ApiRequestService","SessionService",class UserPmDashCtrl{constructor($window,$timeout,$location,PmDashService,ApiRequestService,SessionService){this.$timeout=$timeout,this.$window=$window,this.$location=$location,this.PMS=PmDashService,this.ARS=ApiRequestService,this.SS=SessionService,this.isYard=!1,this.fullName="",this.activePMStatus=0,this.active=0,this.test=0,this.idle=0,this.total=0,this.totalWorkorders="..Loading",this.totalShownWOs="..Loading",this.indirect=0,this.days=45,this.displayUnits=[],this.sortReverse=!0,this.sortType="nextPmDate",this.supervisor=""}$onInit(){this.fullName=this.user.firstName.concat(" ").concat(this.user.lastName),this.ARS.Users({textId:this.user.supervisor}).then(res=>{res.length>0&&(this.supervisor=res[0].firstName.concat(" ").concat(res[0].lastName))}).catch(err=>console.log(err)),this.fullName.includes("YARD")&&(this.isYard=!0)}$onChanges(changes){this.createDisplayUnits(this.units),changes.hasOwnProperty("workorders")&&this.workorders&&(this.totalWorkorders=this.workorders.length),changes.hasOwnProperty("units")&&this.units&&(this.setHeader(this.units),this.activePMStatus=+(100*this.PMS.returnUnitsPmPercent(this.units)).toFixed(2))}setHeader(units){const active=new RegExp("Active","i"),test=new RegExp("Test","i"),idle=new RegExp("Idle","i");units.forEach(unit=>{this.total+=1,unit.status.match(active)?this.active+=1:unit.status.match(test)?this.test+=1:unit.status.match(idle)&&(this.idle+=1)})}createDisplayUnits(units){this.displayUnits=[],units&&units.forEach(unit=>{const thisUnit=this.newDisplayUnit();console.log(unit.locationName.includes("YARD")),unit.locationName.includes("YARD")?(thisUnit.productSeries=+unit.productSeries.substring(5),thisUnit.customerName=unit.productSeries):thisUnit.customerName=unit.customerName.substr(0,17)+"...",thisUnit.unitNumber=unit.number,thisUnit.status=unit.status,thisUnit.leaseName=unit.locationName,unit.nextPM1Date?thisUnit.nextPmDate=unit.nextPM1Date:thisUnit.nextPmDate=unit.nextPmDate,this.workorders?this.workorders.forEach(wo=>{if(wo.unitNumber&&wo.unitNumber===unit.number)switch(wo.type){case"PM":thisUnit.PM+=1;break;case"Trouble Call":case"Transfer":case"Swap":case"Corrective":wo.pm&&(thisUnit.PM+=1)}}):thisUnit.PM=0,this.displayUnits.push(thisUnit)}),this.totalShownWOs=0,this.displayUnits.forEach(unit=>{this.totalShownWOs+=unit.PM})}dayChange(changedData){this.days=changedData}search(){this.totalWorkorders="...Loading",this.updateWorkOrders({days:this.days})}resort(by){this.sortType=by,this.sortReverse=!this.sortReverse}newDisplayUnit(){return{unitNumber:"",customerName:"",leaseName:"",PM:0,status:"",nextPmDate:""}}searchUnits(unit){this.SS.add("unitNumber",unit.unitNumber),this.$window.open("#/workorder")}}]});
angular.module("CommonServices").factory("Handler401",["$q","$cookies","$window","$injector","$location",function($q,$cookies,$window,$injector,$location){function logInAgain(){var url=$window.location.toString().split("#"),returnUrl=url[0],fragment=url[1];$location.search("returnUrl",returnUrl).search("fragment",fragment).path("/login")}return{request:function(config){return $injector.invoke(function($http,$route){return!0===$route.current.needsLogin&&($route.current.needsLogin=!1,function checkAuthorization(httpService,currentRoute){var deferred=$q.defer();return null!==$cookies.get("userId")&&void 0!==$cookies.get("userId")&&0!==$cookies.get("userId")&&"undefined"!==$cookies.get("userId")?deferred.resolve($cookies.get("userId")):httpService.get("/authorized").success(function(user){"0"!==user&&null!=user&&"undefined"!==user?($cookies.put("userId",user._id),$cookies.put("userName",user.userName),deferred.resolve($cookies.get("userId"))):($cookies.remove("userId"),$cookies.remove("user"),deferred.reject("Unauthorized"))}).error(function(err){$cookies.remove("userId"),$cookies.remove("user"),deferred.reject(err)}),deferred.promise}($http,$route.current).then(function(resolveValue){console.log("Resolve Value: ",resolveValue)},function(rejectionReason){console.log("Rejection Reason: ",rejectionReason),logInAgain()})),config||$q.when(config)})},requestError:function(rejection){return logInAgain(),$q.reject(rejection)},response:function(response){return response||$q.when(response)},responseError:function(rejection){return 401===rejection.status&&logInAgain(),$q.reject(rejection)}}}]);
angular.module("CommonServices").factory("AlertService",["$rootScope","$timeout",function($rootScope,$timeout){var AlertService={};return $rootScope.alerts=[],AlertService.add=function(type,message,timeout){timeout||(timeout=5e3),timeout<100&&(timeout*=1e3);var alert={type,message};$rootScope.alerts.push(alert),$timeout(function(){AlertService.closeAlert(alert)},timeout)},AlertService.closeAlert=function(alert){var indexOfAlert=$rootScope.alerts.indexOf(alert);AlertService.closeAlertIndex(indexOfAlert)},AlertService.closeAlertIndex=function(index){$rootScope.alerts.splice(index,1)},AlertService}]);
angular.module("CommonServices").factory("ApiRequestService",["$q","$http","Units","Users","ReviewNotes","Customers","CallReports","PartOrders","WorkOrders","PaidTimeOffs","Counties","MCUnitDiligenceForms",function($q,$http,Units,Users,ReviewNotes,Customers,CallReports,PartOrders,WorkOrders,PaidTimeOffs,Counties,MCUnitDiligenceForms){const ARS={http:{get:{},post:{}},CallReports:obj=>CallReports.query(obj).$promise,Counties:obj=>Counties.query(obj).$promise,Customers:obj=>Customers.query(obj).$promise,PaidTimeOffs:obj=>PaidTimeOffs.query(obj).$promise,PartOrders:obj=>PartOrders.query(obj).$promise,ReviewNotes:obj=>ReviewNotes.query(obj).$promise,Units:obj=>Units.query(obj).$promise,Users:obj=>Users.query(obj).$promise,getUser:obj=>Users.get(obj).$promise,WorkOrders:obj=>WorkOrders.query(obj).$promise,MCUnitDiligenceForms:obj=>MCUnitDiligenceForms.query(obj).$promise};return ARS.http.post.Workorder=(obj=>$http({url:"/api/WorkOrders",method:"POST",params:obj})),ARS.http.get.UnitWorkOrders=(obj=>$http({url:"/api/Unit/Workorders",method:"GET",params:obj})),ARS.http.get.MCUnitDiligenceFormCount=(obj=>$http({url:"/api/MCUnitDiligenceFormsNoIdentityCount",method:"GET",params:obj})),ARS.http.get.WorkOrderCount=(obj=>$http({url:"/api/workorderscount",method:"GET",params:obj})),ARS.http.get.WorkOrdersNoIdentityCount=(obj=>$http({url:"/api/workordersnoidentitycount",method:"GET",params:obj})),ARS.http.get.WorkOrdersUnapprovedArea=(obj=>$http({url:"/api/workordersunapprovedarea",method:"GET",params:obj})),ARS.http.get.WorkOrdersUnapprovedByUser=(obj=>$http({url:"/api/workordersunapprovedbyuser",method:"GET",params:obj})),ARS.http.get.UnitsNoIdentityCount=(obj=>$http({url:"/api/unitnoidentitycount",method:"GET",params:obj})),ARS.http.get.countiesSplit=(obj=>$http({url:"/api/counties",method:"GET",params:obj})),ARS}]);
angular.module("CommonServices").factory("DateService",[function(){return{startOfDay(a){const From=new Date(a);return new Date(From.setHours(0,0,0,0))},endOfDay(b){const To=new Date(b);return new Date(To.setHours(23,59,59,999))},addHours:(d,h)=>"object"==typeof d?new Date(d.setTime(d.getTime()+60*h*60*1e3)):"string"==typeof d?new Date(new Date(d).setTime(new Date(d).getTime()+60*h*60*1e3)):new Date(d),saveToOrion(date){const offset=date.getTimezoneOffset();return new Date(date.getTime()-60*offset*1e3)},displayLocal(date){const offset=date.getTimezoneOffset();return new Date(date.getTime()+60*offset*1e3)},UTCtoLocaleDate(date){return"object"==typeof date?this.addHours(date.toUTCString(),(new Date).getTimezoneOffset()/60):"string"==typeof date?this.addHours(new Date(date).toUTCString(),(new Date).getTimezoneOffset()/60):date},dateToUTC:date=>new Date(Date.UTC(date.getFullYear(),date.getMonth(),date.getDate(),date.getHours(),date.getMinutes(),date.getSeconds(),date.getMilliseconds())),getToFromDatesWeek(num){let returnStart,returnEnd;const now=new Date,toStart=new Date,toEnd=new Date,day=now.getDay();return day>0&&day<6?toStart.setDate(now.getDate()-day-1):6===day?toStart.setDate(now.getDate()):7===day&&toStart.setDate(now.getDate()-1),returnStart=this.startOfDay(toStart),toEnd.setDate(now.getDate()+(num-day)),{returnStart,returnEnd:returnEnd=this.endOfDay(toEnd)}}}}]);
angular.module("CommonServices").factory("GeneralPartSearchService",[function(){const GeneralPartSearchService={mapParts:Parts=>Parts.map(part=>(part.searchStr=[part.description,part.componentName,part.MPN].join(" "),part)),partTableModel:(Parts,type,data)=>({tableName:"Search For Parts",objectList:GeneralPartSearchService.mapParts(Parts),displayColumns:[{title:"Part #",objKey:"componentName"},{title:"MPN",objKey:"MPN"},{title:"Description",objKey:"description"}],rowsClickAction:GeneralPartSearchService.addPart(type,data),rowButtons:null,headerButtons:null,sort:{column:["number"],descending:!1}}),addPart:(type,data)=>"replace"===type?part=>data.part=GeneralPartSearchService.generalAddPart(part):"push"===type?part=>data.parts.push(GeneralPartSearchService.generalAddPart(part)):"wo"===type?part=>data.parts.push(GeneralPartSearchService.woAddPart(part)):void 0,manualAddPart:part=>({vendor:part.vendor,number:part.number,description:part.description,cost:part.cost,laborCode:"",quantity:0,isBillable:!1,isWarranty:!1,isManual:!0}),generalAddPart:part=>({vendor:part.vendor,number:part.number,MPN:part.MPN,smartPart:part.componentName,componentName:part.componentName,description:part.description,quantity:0,isBillable:!1,isWarranty:!1,isManual:!1,netsuiteId:part.netsuiteId}),woAddPart:part=>({vendor:part.vendor,number:part.number,MPN:part.MPN,smartPart:part.componentName,componentName:part.componentName,description:part.description,quantity:0,cost:0,laborCode:"",isBillable:!1,isWarranty:!1,isManual:!1,netsuiteId:part.netsuiteId})};return GeneralPartSearchService}]);
angular.module("CommonServices").factory("LocationItemService",[function(){const LocationItemService={getTruckInfo:(truckId,locations)=>{const thisTruck={truckId:"",netsuiteId:"",_id:null};return _.map(locations,obj=>{-1!==obj.name.indexOf(":")&&obj.name.substr(obj.name.indexOf(":")+1).trim()===truckId&&(thisTruck._id=obj._id,thisTruck.truckId=truckId,thisTruck.netsuiteId=obj.netsuiteId)}),thisTruck},getTruckFromString:(str,locations)=>{const thisTruck={name:"",_id:null,netsuiteId:""};return locations.forEach(loc=>{-1!==loc.name.toUpperCase().indexOf(str.toUpperCase())?(thisTruck.name=loc.name,thisTruck._id=loc._id,thisTruck.netsuiteId=Number(loc.netsuiteId)):-1!==loc.name.indexOf(":")&&loc.name.substr(loc.name.indexOf(":")+1).trim().toUpperCase()===str.toUpperCase()&&(thisTruck.name=loc.name,thisTruck._id=loc._id,thisTruck.netsuiteId=Number(loc.netsuiteId))}),thisTruck},getTruckFromNSID:(nsid,locations)=>{let returnString="";return _.map(locations,obj=>{obj.netsuiteId===nsid&&(returnString=obj.name.substr(obj.name.indexOf(":")+1).trim())}),returnString},getIDFromNSID:(nsid,locations)=>{let returnVariable=null;return nsid&&_.map(locations,obj=>{obj.netsuiteId===nsid&&(returnVariable=obj._id)}),returnVariable},getNameFromNSID:(nsid,locations)=>{let returnString="";return nsid&&_.map(locations,obj=>{obj.netsuiteId===nsid&&(returnString=obj.name)}),returnString},getLocationNSID:(id,locations)=>{for(let i=0;i<locations.length;i++)if(locations[i]._id===id)return locations[i].netsuiteId;return null},getTruckObj:locations=>{const reg=/^\d+$/,returnArray=[];return _.map(locations,obj=>{if(-1!==obj.name.indexOf(":")&&reg.test(obj.name.substr(obj.name.indexOf(":")+1).trim())){const thisLocation={name:"",netsuiteId:"",_id:null};thisLocation.name=obj.name,thisLocation.netsuiteId=obj.netsuiteId,thisLocation._id=obj._id,returnArray.push(thisLocation)}}),returnArray},getLocationNameArray:locations=>{const returnedArray=[];return _.map(locations,obj=>{if(-1===obj.name.indexOf(":")){const thisLocation={name:""};thisLocation.name=obj.name,returnedArray.push(thisLocation)}}),returnedArray},getLocationWarehouseObjArray:locations=>{const returnedArray=[];return _.map(locations,obj=>{if(-1===obj.name.indexOf(":")){const thisLocation={name:"",netsuiteId:"",_id:null};thisLocation.name=obj.name,thisLocation.netsuiteId=obj.netsuiteId,thisLocation._id=obj._id,returnedArray.push(thisLocation)}}),returnedArray}};return LocationItemService}]);
angular.module("CommonServices").factory("ObjectService",[function(){var ObjectService={updateNestedObjectValue:function(object,newValue,path){_.update(object,path,function(n){return newValue})},setObjValue:(obj,path,value)=>"string"==typeof path?ObjectService.setObjValue(obj,path.split("."),value):1===path.length?obj[path[0]]=value:0===path.length?obj:ObjectService.setObjValue(obj[path[0]],path.slice(1),value),updateNonNestedObjectValue:function(object,newValue,path){object[path]=newValue},getNestedObjectValue:function(object,path){for(var stack=path.split(".");stack.length>1;)object=object[stack.shift()];return object[stack.shift()]}};return ObjectService}]);
angular.module("CommonServices").factory("PmDashService",[function(){const PMS={white:"#ffffff",green:"#b2f4b3",yellow:"#eff4b2",red:"#f4bab2",setBackgroundColor:percent=>percent>=95?PMS.green:percent>90&&percent<95?PMS.yellow:-1===percent?PMS.white:PMS.red,returnUnitsPmPercent:units=>{const unitPercentages=[],idle=new RegExp("Idle"),sold=new RegExp("Sold"),now=(new Date).getTime();units.forEach(unit=>{if(!unit.status.match(sold)&&!unit.status.match(idle)){const unitNextPM=new Date(unit.nextPmDate).getTime(),unitNextPM1=new Date(unit.nextPM1Date).getTime();unitNextPM1?(console.log("PM!"),unitNextPM1>now?unitPercentages.push(1):unitNextPM1<now&&unitPercentages.push(0)):(console.log("regular pm"),unitNextPM>now?unitPercentages.push(1):unitNextPM<now&&unitPercentages.push(0))}});const total=unitPercentages.reduce((a,b)=>a+b,0);return 0===unitPercentages.length&&0===total?0:+(total/unitPercentages.length).toFixed(2)},returnIdleUnits:units=>{const idleUnits=[],idle=new RegExp("Idle");return units.length>0&&units.forEach(unit=>{unit.status.match(idle)&&idleUnits.push(unit)}),idleUnits},returnActiveUnits:units=>{const activeUnits=[],idle=new RegExp("Idle"),sold=new RegExp("Sold");return units.length>0&&units.forEach(unit=>{unit.status.match(sold)||unit.status.match(idle)||activeUnits.push(unit)}),activeUnits},setDateBackground:date=>{const now=(new Date).getTime(),dateTime=new Date(date).getTime(),green=now+6048e5;return dateTime>green?PMS.green:now<dateTime&&dateTime<green?PMS.yellow:dateTime<now?PMS.red:"white"},totalUnitPercent:objListWithePercentField=>{const activeUnits=objListWithePercentField.map(obj=>obj.unitPercent/100);return 100*+(activeUnits.reduce((a,b)=>a+b,0)/activeUnits.length).toFixed(2)},totalPercent:objListWithePercentField=>{const activeUnits=objListWithePercentField.reduce((array,obj)=>0!==obj.activeUnits?array.concat(obj.percent/100):array,[]);return 100*+(activeUnits.reduce((a,b)=>a+b,0)/activeUnits.length).toFixed(2)}};return PMS}]);
angular.module("CommonServices").factory("SessionService",["$window",function($window){const SS={},sessionStorage=$window.sessionStorage;return SS.add=((key,value)=>{sessionStorage.setItem(JSON.stringify(key),JSON.stringify(value))}),SS.get=(key=>JSON.parse(sessionStorage.getItem(JSON.stringify(key)))),SS.drop=(key=>sessionStorage.removeItem(JSON.stringify(key))),SS.clear=(()=>sessionStorage.clear()),SS}]);
angular.module("CommonServices").factory("TimeDisplayService",[function(){var TimeDisplayService={pad:function(n){return n>=0?n>9?""+n:"0"+n:n<-9?""+n:"-0"+Math.abs(n)},exactPad:function(n,width,z){return z=z||"0",(n+="").length>=width?n:new Array(width-n.length+1).join(z)+n},timeManager:function(h,m){var totalM=0;return m<0&&0===h?{hours:"-0"+h,minutes:TimeDisplayService.pad(Math.abs(m))}:m<0&&h<0?{hours:TimeDisplayService.pad(h),minutes:TimeDisplayService.pad(Math.abs(m))}:m>0&&0===h?{hours:TimeDisplayService.pad(h),minutes:TimeDisplayService.pad(m)}:m>0&&h<0?(h=(totalM=m-Math.abs(Math.round(60*h)))>0?totalM/60<1?0:Math.round(totalM/60):totalM/60,m=Math.round(totalM%60),TimeDisplayService.timeManager(h,m)):m<0&&h>0?(h=(totalM=Math.abs(Math.round(60*h))+m)/60<1?0:Math.floor(totalM/60),m=Math.round(totalM%60),TimeDisplayService.timeManager(h,m)):{hours:TimeDisplayService.pad(h),minutes:TimeDisplayService.pad(m)}}};return TimeDisplayService}]);
angular.module("CommonServices").factory("Utils",[function(){return{debounce(fn,wait,immediate){let inDebounce;return console.log(fn),console.log(wait),function executedFunction(){let context=this,args=arguments,callNow=immediate&&!inDebounce;clearTimeout(inDebounce),inDebounce=setTimeout(function(){inDebounce=null,immediate||fn.apply(context,args)},wait),callNow&&fn.apply(context,args)}}}}]);
angular.module("CommonServices").factory("ActivityTypes",["$resource",function($resource){return $resource("/api/activitytypes/:id",{id:"@id"})}]).factory("ApplicationTypes",["$resource",function($resource){return $resource("/api/applicationtypes/:id",{id:"@id"})}]).factory("AssetTypes",["$resource",function($resource){return $resource("/api/assettypes/:id",{id:"@id"})}]).factory("Areas",["$resource",function($resource){return $resource("/api/areas/:id",{id:"@id"})}]).factory("CallReports",["$resource",function($resource){return $resource("/api/callreports/:id",{id:"@id"})}]).factory("Compressors",["$resource",function($resource){return $resource("/api/compressors/:id",{id:"@id"})}]).factory("Counties",["$resource",function($resource){return $resource("/api/counties/:id",{id:"@id"})}]).factory("Customers",["$resource",function($resource){return $resource("/api/customers/:id",{id:"@id"})}]).factory("EditHistories",["$resource",function($resource){return $resource("/api/edithistories/:id",{id:"@id"})}]).factory("Engines",["$resource",function($resource){return $resource("/api/engines/:id",{id:"@id"})}]).factory("InventoryTransfers",["$resource",function($resource){return $resource("/api/inventorytransfers/:id",{id:"@id"})}]).factory("Jsas",["$resource",function($resource){return $resource("/api/jsas/:id",{id:"@id"})}]).factory("Locations",["$resource",function($resource){return $resource("/api/locations/:id",{id:"@id"})}]).factory("MCUnitDiligenceForms",["$resource",function($resource){return $resource("/api/MCUnitDiligenceForms/:id",{id:"@id"})}]).factory("OppTypes",["$resource",function($resource){return $resource("/api/opptypes/:id",{id:"@id"})}]).factory("OpportunitySizes",["$resource",function($resource){return $resource("/api/opportunitysizes/:id",{id:"@id"})}]).factory("PaidTimeOffs",["$resource",function($resource){return $resource("/api/paidtimeoffs/:id",{id:"@id"},{update:{method:"PUT",params:{id:"@id"}}})}]).factory("Parts",["$resource",function($resource){return $resource("/api/parts/:id",{id:"@id"})}]).factory("PartOrder",["$resource",function($resource){return $resource("/api/partorders",{ids:"@id"})}]).factory("PartOrders",["$resource",function($resource){return $resource("/api/partorders/:id",{id:"@id"},{update:{method:"PUT",params:{id:"@id"}}})}]).factory("ReviewNotes",["$resource",function($resource){return $resource("/api/reviewnotes/:id",{id:"@id"})}]).factory("States",["$resource",function($resource){return $resource("/api/states/:id",{id:"@id"})}]).factory("StatusTypes",["$resource",function($resource){return $resource("/api/statustypes/:id",{id:"@id"})}]).factory("Titles",["$resource",function($resource){return $resource("/api/titles/:id",{id:"@id"})}]).factory("Transfers",["$resource",function($resource){return $resource("/api/transfers/:id",{id:"@id"})}]).factory("Units",["$resource",function($resource){return $resource("/api/units/:id",{id:"@id"})}]).factory("UnitTypes",["$resource",function($resource){return $resource("/api/unittypes/:id",{id:"@id"})}]).factory("Users",["$resource",function($resource){return $resource("/api/users/:id",{id:"@id"})}]).factory("Vendors",["$resource",function($resource){return $resource("/api/vendors/:id",{id:"@id"})}]).factory("WorkOrders",["$resource",function($resource){return $resource("/api/workorders/:id",{id:"@id"},{update:{method:"PUT",params:{id:"@id"}}})}]).factory("WoUnitInputMatrixes",["$resource",function($resource){return $resource("/api/WOUnitInputsMatrix/:id",{id:"@id"})}]).factory("FrameModels",["$resource",function($resource){return $resource("/api/FrameModels/:id",{id:"@id"})}]).factory("EngineModels",["$resource",function($resource){return $resource("/api/EngineModels/:id",{id:"@id"})}]).factory("WOPMCheck",["$resource",function($resource){return $resource("/api/WOPMCheck/:id",{id:"@id"})}]);
angular.module("CommonDirectives").directive("alerts",["AlertService",function(AlertService){return{restrict:"E",templateUrl:"/lib/public/angular/views/directive.views/alerts.html",link:function(scope,elem,attrs,ctrl){scope.closeAlert=function(obj){return AlertService.closeAlert(obj)}}}}]);
angular.module("CommonDirectives").directive("customValidation",function(){return{require:"ngModel",scope:!0,link:function(scope,element,attr,ngModelCtrl){element.bind("focus",function(){"0"===element.context.value&&(element.context.value="")}),ngModelCtrl.$parsers.push(function fromUser(text){var originalText=text,isNumber=void 0!==attr.number,isTextOnly=void 0!==attr.textonly,isNonNegative="true"===attr.nonNegative,isIntegerOnly="true"===attr.integerOnly;if(console.log(attr.integerOnly),isNumber){text=text.replace(/[^-?\d+\.?\d*$]/g,"");for(var decimalCount=0,i=0;i<text.length;i++)0===i&&"-"===text[i]||("-"===text[i]?text=text.slice(0,i)+text.slice(i+1,text.length):"."===text[i]&&(decimalCount>0?text=text.slice(0,i)+text.slice(i+1,text.length):decimalCount=1));isNonNegative&&(text=text.split("-").join()),isIntegerOnly&&(text=text.split(".")[0])}return isTextOnly&&console.log("text only validation not implemented"),text!==originalText&&(ngModelCtrl.$setViewValue(text),ngModelCtrl.$render()),text})}}});
angular.module("CommonDirectives").directive("header",["$window","$location","$cookies",function($window,$location,$cookies){return{restrict:"E",templateUrl:"/lib/public/angular/views/directive.views/header.html",link:function(scope,elem,attrs,ctrl){scope.navItems=function getnavItems(){return[{text:"User: "+$cookies.get("tech")||"Logged Out",action:function(){$location.path("/support")}}]}()}}}]);
angular.module("CommonControllers").controller("SuperTableCtrl",["$scope","AlertService",function($scope,AlertService){$scope.changeSorting=function(column){var sort=$scope.sort;sort.column==column?sort.descending=!sort.descending:(sort.column=column,sort.descending=!1)},$scope.filterPart=function(obj,index,fullArrayOfParts){if(!$scope.searchPhrase)return!1;if(!($scope.searchPhrase.length>=3))return!1;{const pattern2=new RegExp($scope.searchPhrase,"i"),mpn=obj.MPN?obj.MPN:"",desc=obj.description?obj.description:"",compN=obj.componentName?obj.componentName:"",full=`${mpn} ${desc} ${compN}`,pattern=new RegExp("(?=.*\\b"+$scope.searchPhrase.split(" ").join("\\b)(?=.*\\b")+"\\b)","i");if(mpn.match(pattern)||desc.match(pattern)||compN.match(pattern)||full.match(pattern)||mpn.match(pattern2)||desc.match(pattern2)||compN.match(pattern2)||full.match(pattern2))return!0}},$scope.getDefaultSort=function(){var column=[];for(var key in $scope.displayColumns)column.push(key.toString());$scope.defaultSort={column,descending:[!1]}},$scope.onLoad=function(){var m=$scope.model;if(!m.objectList||!m.displayColumns){console.log("WARNING!"),console.log("You failed to provide required data for the directive."),console.log("See super-table documentation for more info.");throw new Error("SuperTabelCtrl: Required attributes were not assigned to model.")}$scope.tableName=m.tableName||"My Table Name",$scope.objectList=m.objectList,$scope.displayColumns=m.displayColumns,$scope.rowClickAction=m.rowClickAction,$scope.headerButtons=m.headerButtons,$scope.rowButtons=m.rowButtons,$scope.sort=m.sort||$scope.getDefaultSort()},$scope.clearSearchPhrase=function(obj){$scope.searchPhrase="";var alertString=obj.description+" added";AlertService.add("success",alertString)},$scope.onLoad()}]);
function CheckBoxCtrl(){var self=this;self.onUpdate=function(item){self.onDataChange({changedData:item,selected:self.modelName})}}angular.module("CommonComponents").component("checkBox",{templateUrl:"/lib/public/angular/views/component.views/customComponents/checkbox.html",bindings:{labelText:"@",modelName:"@",boxStyling:"@",inputStyling:"@",onDataChange:"&",data:"<",disabled:"<"},controller:CheckBoxCtrl});
function DateFieldCtrl(){var self=this;self.onUpdate=function(item){console.log(item),self.onDataChange({changedData:item,selected:self.modelName})}}angular.module("CommonComponents").component("dateField",{templateUrl:"/lib/public/angular/views/component.views/customComponents/datefield.html",bindings:{labelText:"@",modelName:"@",placeholderText:"@",onDataChange:"&",data:"<",weeks:"<"},controller:DateFieldCtrl});
function DualTextFieldCtrl(){var self=this;self.onUpdate=function(item,modelName){self.onDataChange({changedData:item,selected:modelName})}}angular.module("CommonComponents").component("dualTextField",{templateUrl:"/lib/public/angular/views/component.views/customComponents/dual-textfield.html",bindings:{labelText:"@",modelNameOne:"@",modelNameTwo:"@",inputStyling:"<",fieldStyling:"@",placeholderTextOne:"@",placeholderTextTwo:"@",onDataChange:"&",dataone:"<",datatwo:"<",disabled:"<"},controller:DualTextFieldCtrl});
function SelectListCtrl(){var self=this;self.onUpdate=function(item){self.onDataChange({changedData:item,selected:self.modelName})}}angular.module("CommonComponents").component("selectList",{templateUrl:"/lib/public/angular/views/component.views/customComponents/selectlist.html",bindings:{labelText:"@",selectField:"@",modelName:"@",displayField:"@",onDataChange:"&",arrayList:"<",data:"<",disabled:"<"},controller:SelectListCtrl});
function TextAreaFieldCtrl(){var self=this;self.onUpdate=function(item){self.onDataChange({changedData:item,selected:self.modelName})}}angular.module("CommonComponents").component("textAreaField",{templateUrl:"/lib/public/angular/views/component.views/customComponents/textareafield.html",bindings:{labelText:"@",modelName:"@",placeholderText:"@",rows:"@",onDataChange:"&",data:"<",disabled:"<"},controller:TextAreaFieldCtrl});
function TextFieldCtrl(){var self=this;self.onUpdate=function(item){self.onDataChange({changedData:item,selected:self.modelName})}}angular.module("CommonComponents").component("textField",{templateUrl:"/lib/public/angular/views/component.views/customComponents/textfield.html",bindings:{labelText:"@",modelName:"@",inputStyling:"@",fieldStyling:"@",placeholderText:"@",onDataChange:"&",data:"<",disabled:"<"},controller:TextFieldCtrl});
angular.module("CommonComponents").component("timeField",{templateUrl:"/lib/public/angular/views/component.views/customComponents/timefield.html",bindings:{labelText:"@",modelName:"@",onDataChange:"&",data:"<",hours:"<",minutes:"<",show:"<",disabled:"<"},controller:class TimeFieldCtrl{constructor(){}onUpdate(item){this.onDataChange({changedData:item,selected:this.modelName})}}});
function TripleTextFieldCtrl(){var self=this;self.onUpdate=function(item,modelName){self.onDataChange({changedData:item,selected:modelName})}}angular.module("CommonComponents").component("tripleTextField",{templateUrl:"/lib/public/angular/views/component.views/customComponents/triple-textfield.html",bindings:{labelText:"@",modelNameOne:"@",modelNameTwo:"@",modelNameThree:"@",inputStyling:"<",fieldStyling:"@",placeholderTextOne:"@",placeholderTextTwo:"@",placeholderTextThree:"@",onDataChange:"&",dataone:"<",datatwo:"<",datathree:"<",disabled:"<"},controller:TripleTextFieldCtrl});
function TypeAheadCtrl(ObjectService){var self=this;self.objItemArray=[],self.$onChanges=function(changes){self.disabled||self.arrayList&&self.arrayList.length>0&&("object"==typeof self.arrayList[0]?self.arrayList.map(function(obj){self.objItemArray.push(ObjectService.getNestedObjectValue(obj,self.itemPath))}):"string"==typeof self.arrayList[0]||"number"==typeof self.arrayList[0]||"boolean"==typeof self.arrayList[0]?self.objItemArray=self.arrayList:console.error({arrayList:self.arrayList},"An Error occurred while attempting to display typeahead item: "+self.labelText+"."))},self.onUpdate=function(item){self.onDataChange({changedData:item,selected:self.modelName})}}angular.module("CommonComponents").component("typeAhead",{templateUrl:"/lib/public/angular/views/component.views/customComponents/typeahead.html",bindings:{labelText:"@",itemPath:"@",modelName:"@",placeholderText:"@",onDataChange:"&",wait:"<",arrayList:"<",data:"<",limit:"<",disabled:"<"},controller:["ObjectService",TypeAheadCtrl]});
angular.module("MCDiligenceApp.Controllers",[]),angular.module("MCDiligenceApp.Directives",["uiGmapgoogle-maps"]),angular.module("MCDiligenceApp.Components",[]),angular.module("MCDiligenceApp.Services",["ngResource","ngCookies","ui.utils"]),angular.module("MCDiligenceApp",["MCDiligenceApp.Controllers","MCDiligenceApp.Directives","MCDiligenceApp.Services","MCDiligenceApp.Components","infinite-scroll"]),angular.module("MCDiligenceApp").config(["$routeProvider",function($routeProvider){$routeProvider.when("/mcdiligence/view/:id?",{controller:"MCDiligenceReviewCtrl",templateUrl:"/lib/public/angular/apps/mcdiligence/views/mcUnitDFReview.html",resolve:{mcDiligenceForm:function($route,$q,MCUnitDiligenceForms){return MCUnitDiligenceForms.get({id:$route.current.params.id}).$promise}}}).when("/wpi/view/:id?",{controller:"MCDiligenceReviewCtrl",templateUrl:"/lib/public/angular/apps/mcdiligence/views/wpiUnitDFReview.html",resolve:{mcDiligenceForm:function($route,$q,MCUnitDiligenceForms){return MCUnitDiligenceForms.get({id:$route.current.params.id}).$promise}}}).when("/mcdiligence",{controller:"MCDiligenceCtrl",templateUrl:"/lib/public/angular/apps/mcdiligence/views/mcDiligenceOverview.html"}).when("/wpi",{controller:"MCDiligenceCtrl",templateUrl:"/lib/public/angular/apps/mcdiligence/views/wpiDiligenceOverview.html"})}]);
angular.module("CallReportApp.Controllers",[]),angular.module("CallReportApp.Components",[]),angular.module("CallReportApp.Directives",[]),angular.module("CallReportApp.Services",["ngResource","ngCookies","ui.utils"]),angular.module("CallReportApp",["CallReportApp.Controllers","CallReportApp.Components","CallReportApp.Directives","CallReportApp.Services","infinite-scroll"]),angular.module("CallReportApp").config(["$routeProvider",function($routeProvider){$routeProvider.when("/callreport",{needsLogin:!0,controller:"CallReportCtrl",templateUrl:"/lib/public/angular/apps/callreport/views/crOverview.html"}).when("/callreport/review/:id",{needsLogin:!0,controller:"CallReportReviewCtrl",templateUrl:"/lib/public/angular/apps/callreport/views/crReview.html",resolve:{callreport:function($route,$q,CallReports){const id=$route.current.params.id||0;return id?CallReports.get({id}).$promise:null}}}).when("/callreport/edit/:id",{needsLogin:!0,controller:"CallReportEditCtrl",templateUrl:"/lib/public/angular/apps/callreport/views/crEdit.html",resolve:{callreport:function($route,$q,CallReports){const id=$route.current.params.id||0;return id?CallReports.get({id}).$promise:null},unittypes:function($route,$q,UnitTypes){return UnitTypes.query({}).$promise},titles:function($route,$q,Titles){return Titles.query({}).$promise},statustypes:function($route,$q,StatusTypes){return StatusTypes.query({}).$promise},opportunitysizes:function($route,$q,OpportunitySizes){return OpportunitySizes.query({}).$promise},opptypes:function($route,$q,OppTypes){return OppTypes.query({}).$promise},activitytypes:function($route,$q,ActivityTypes){return ActivityTypes.query({}).$promise},customers:function($route,$q,Customers){return Customers.query({}).$promise},applicationtypes:function($route,$q,ApplicationTypes){return ApplicationTypes.query({}).$promise},users:function($route,$q,Users){return Users.query({}).$promise}}}).when("/callreport/create",{needsLogin:!0,controller:"CallReportCreateCtrl",templateUrl:"/lib/public/angular/apps/callreport/views/crCreate.html",resolve:{unittypes:function($route,$q,UnitTypes){return UnitTypes.query({}).$promise},titles:function($route,$q,Titles){return Titles.query({}).$promise},statustypes:function($route,$q,StatusTypes){return StatusTypes.query({}).$promise},opportunitysizes:function($route,$q,OpportunitySizes){return OpportunitySizes.query({}).$promise},opptypes:function($route,$q,OppTypes){return OppTypes.query({}).$promise},activitytypes:function($route,$q,ActivityTypes){return ActivityTypes.query({}).$promise},applicationtypes:function($route,$q,ApplicationTypes){return ApplicationTypes.query({}).$promise}}})}]);
angular.module("PaidTimeOffApp.Controllers",[]),angular.module("PaidTimeOffApp.Components",[]),angular.module("PaidTimeOffApp.Directives",[]),angular.module("PaidTimeOffApp.Services",["ngResource","ngCookies","ui.utils"]),angular.module("PaidTimeOffApp",["PaidTimeOffApp.Controllers","PaidTimeOffApp.Components","PaidTimeOffApp.Directives","PaidTimeOffApp.Services","infinite-scroll"]),angular.module("PaidTimeOffApp").config(["$routeProvider",function($routeProvider){$routeProvider.when("/paidtimeoff",{needsLogin:!0,controller:"PaidTimeOffCtrl",templateUrl:"/lib/public/angular/apps/paidtimeoff/views/ptoOverview.html"}).when("/paidtimeoff/review/:id",{needsLogin:!0,controller:"PaidTimeOffReviewCtrl",templateUrl:"/lib/public/angular/apps/paidtimeoff/views/ptoReview.html",resolve:{paidtimeoff:function($route,$q,PaidTimeOffs){const id=$route.current.params.id||0;return id?PaidTimeOffs.get({id}).$promise:null}}})}]),angular.module("PaidTimeOffApp").run(["$route","$rootScope","$location",function($route,$rootScope,$location){var original=$location.path;$location.path=function(path,reload){if(!1===reload)var lastRoute=$route.current,un=$rootScope.$on("$locationChangeSuccess",function(){$route.current=lastRoute,un()});return original.apply($location,[path])}}]);
angular.module("UnitApp.Controllers",[]),angular.module("UnitApp.Directives",["uiGmapgoogle-maps"]),angular.module("UnitApp.Components",[]),angular.module("UnitApp.Services",["ngResource","ngCookies","ui.utils"]),angular.module("UnitApp",["UnitApp.Controllers","UnitApp.Directives","UnitApp.Services","UnitApp.Components"]),angular.module("UnitApp").config(["$routeProvider",function($routeProvider){$routeProvider.when("/unit/view/:id?",{controller:"UnitViewCtrl",templateUrl:"/lib/public/angular/apps/unit/views/view.html",resolve:{unit:function($route,$q,Units){return Units.get({id:$route.current.params.id}).$promise}}}).when("/unit/page/:coords?",{controller:"UnitPageCtrl",templateUrl:"/lib/public/angular/apps/unit/views/page.html",resolve:{coords:function($route){const coords=$route.current.params.coords.split(",");return[+coords[1],+coords[0]]}}}).when("/unit",{controller:"UnitIndexCtrl",templateUrl:"/lib/public/angular/apps/unit/views/index.html"})}]);
angular.module("PartOrderApp.Controllers",[]),angular.module("PartOrderApp.Components",[]),angular.module("PartOrderApp.Directives",[]),angular.module("PartOrderApp.Services",["ngResource","ngCookies","ui.utils"]),angular.module("PartOrderApp",["PartOrderApp.Controllers","PartOrderApp.Components","PartOrderApp.Directives","PartOrderApp.Services","infinite-scroll"]),angular.module("PartOrderApp").config(["$routeProvider",function($routeProvider){$routeProvider.when("/partorder",{needsLogin:!0,controller:"PartOrderCtrl",templateUrl:"/lib/public/angular/apps/partorder/views/poOverview.html",resolve:{locations:function($route,$q,Locations){return Locations.query({}).$promise}}}).when("/partorder/review/:id",{needsLogin:!0,controller:"PartOrderReviewCtrl",templateUrl:"/lib/public/angular/apps/partorder/views/poReview.html",resolve:{partorder:function($route,$q,PartOrders){const id=$route.current.params.id||0;return id?PartOrders.get({id}).$promise:null},locations:function($route,$q,Locations){return Locations.query({}).$promise}}}).when("/partorder/editMany/:array",{needsLogin:!0,controller:"PartOrdersEditCtrl",templateUrl:"/lib/public/angular/apps/partorder/views/posEdit.html",resolve:{partorders:function($route,$q,PartOrder){const ids=JSON.parse($route.current.params.array);return ids?PartOrder.query({ids}).$promise:null},locations:function($route,$q,Locations){return Locations.query({}).$promise}}}).when("/partorder/edit/:id",{needsLogin:!0,controller:"PartOrderEditCtrl",templateUrl:"/lib/public/angular/apps/partorder/views/poEdit.html",resolve:{partorder:function($route,$q,PartOrders){const id=$route.current.params.id||0;return id?PartOrders.get({id}).$promise:null},locations:function($route,$q,Locations){return Locations.query({}).$promise}}}).when("/partorder/create",{needsLogin:!0,controller:"PartOrderCreateCtrl",templateUrl:"/lib/public/angular/apps/partorder/views/poCreate.html",resolve:{parts:function($route,$q,Parts){return Parts.query({}).$promise},locations:function($route,$q,Locations){return Locations.query({}).$promise}}})}]),angular.module("PartOrderApp").run(["$route","$rootScope","$location",function($route,$rootScope,$location){var original=$location.path;$location.path=function(path,reload){if(!1===reload)var lastRoute=$route.current,un=$rootScope.$on("$locationChangeSuccess",function(){$route.current=lastRoute,un()});return original.apply($location,[path])}}]);
angular.module("CommonDirectives").directive("ngMin",function(){return{restrict:"A",require:"ngModel",link:function(scope,elem,attr,ctrl){ctrl.$parsers.unshift(viewValue=>{viewValue=+viewValue;let min=!0,max=!0;return 0==scope.min?min=viewValue>-1:1==scope.min?min=viewValue>0:null==scope.min&&(scope.check=!0),0!=scope.max&&null===scope.max&&!1===scope.max||(max=viewValue<=scope.max),min&&max?(ctrl.$setValidity("ngMin",!0),elem.parent().hasClass("has-error")?(elem.parent().removeClass("has-error"),elem.parent().addClass("has-success")):elem.parent().addClass("has-success"),viewValue):(ctrl.$setValidity("ngMin",!1),void(elem.parent().hasClass("has-success")?(elem.parent().removeClass("has-success"),elem.parent().addClass("has-error")):elem.parent().addClass("has-error")))})}}}).directive("numberField",[function(){return{restrict:"E",templateUrl:"/lib/public/angular/views/directive.views/customElements/numberfield.html",scope:{labelText:"@",data:"=",min:"@",max:"@",name:"@",nonNegative:"@",integerOnly:"@",placeholderText:"@",disabled:"="}}}]);
angular.module("CommonDirectives").directive("oldCheckBox",[function(){return{restrict:"E",templateUrl:"/lib/public/angular/views/directive.views/customElements/oldcheckbox.html",scope:{labelText:"@",data:"=",disabled:"="}}}]);
angular.module("CommonDirectives").directive("priceField",[function(){return{restrict:"E",templateUrl:"/lib/public/angular/views/directive.views/customElements/pricefield.html",scope:{labelText:"@",placeholderText:"@",data:"=",nonNegative:"@",integerOnly:"@",disabled:"="}}}]);
angular.module("CommonDirectives").directive("superTable",["$window",function($window){return{restrict:"E",scope:{model:"="},controller:"SuperTableCtrl",templateUrl:"/lib/public/angular/views/directive.views/customElements/supertable.html"}}]);
angular.module("WorkOrderApp.Controllers",[]),angular.module("WorkOrderApp.Components",[]),angular.module("WorkOrderApp.Directives",["uiGmapgoogle-maps"]),angular.module("WorkOrderApp.Services",["ngResource","ngCookies","ui.utils"]),angular.module("WorkOrderApp",["WorkOrderApp.Controllers","WorkOrderApp.Components","WorkOrderApp.Directives","WorkOrderApp.Services","infinite-scroll"]),angular.module("WorkOrderApp").config(["$routeProvider",function($routeProvider){$routeProvider.when("/workorder",{needslogin:!0,controller:"WorkOrderCtrl",templateUrl:"/lib/public/angular/apps/workorder/views/woOverview.html",resolve:{STARTTIME:()=>null,ENDTIME:()=>null,WOTYPE:()=>null,TECHNICIANID:()=>null}}).when("/workorder/v1Search/:startTime/:technicianID/:Type?",{needsLogin:!0,controller:"WorkOrderCtrl",templateUrl:"/lib/public/angular/apps/workorder/views/woOverview.html",resolve:{STARTTIME:function($route){return $route.current.params.startTime||null},ENDTIME:()=>null,WOTYPE:function($route){return $route.current.params.Type||null},TECHNICIANID:function($route){return $route.current.params.technicianID||null}}}).when("/workorder/v2Search/:startTime/:endTime/:technicianID",{needsLogin:!0,controller:"WorkOrderCtrl",templateUrl:"/lib/public/angular/apps/workorder/views/woOverview.html",resolve:{STARTTIME:function($route){return $route.current.params.startTime||null},ENDTIME:function($route){return $route.current.params.endTime||null},WOTYPE:()=>null,TECHNICIANID:function($route){return $route.current.params.technicianID||null}}}).when("/workorder/review/:id?",{needsLogin:!0,controller:"WorkOrderReviewCtrl",templateUrl:"/lib/public/angular/apps/workorder/views/review.html",resolve:{workorder:function($route,$q,WorkOrders){var id=$route.current.params.id||null;return id?WorkOrders.get({id}).$promise:null},woInputMatrixes:function($route,$q,WoUnitInputMatrixes){return WoUnitInputMatrixes.query({}).$promise},engineModels:function($route,$q,EngineModels){return EngineModels.query({}).$promise},frameModels:function($route,$q,FrameModels){return FrameModels.query({}).$promise},reviewNotes:function($route,$q,ReviewNotes){var id=$route.current.params.id||null;return id?ReviewNotes.query({workOrder:id}).$promise:null},editHistories:function($route,$q,EditHistories){var id=$route.current.params.id||null;return id?EditHistories.query({workOrder:id}).$promise:null},me:function($route,$q,Users){return Users.get({id:"me"}).$promise},applicationtypes:function($route,$q,ApplicationTypes){return ApplicationTypes.query({}).$promise},parts:function($route,$q,Parts){return Parts.query({}).$promise},locations:function($route,$q,Locations){return Locations.query({}).$promise}}}).when("/workorder/create",{needsLogin:!0,controller:"WorkOrderCreateCtrl",templateUrl:"/lib/public/angular/apps/workorder/views/create.html",resolve:{woInputMatrixes:function($route,$q,WoUnitInputMatrixes){return WoUnitInputMatrixes.query({}).$promise},units:function($route,$q,Units){return Units.query({}).$promise},customers:function($route,$q,Customers){return Customers.query({}).$promise},woSOPChecks:function($route,$q,WOPMCheck){return WOPMCheck.query({}).$promise},engineModels:function($route,$q,EngineModels){return EngineModels.query({}).$promise},frameModels:function($route,$q,FrameModels){return FrameModels.query({}).$promise},assettypes:function($route,$q,AssetTypes){return AssetTypes.query({}).$promise},me:function($route,$q,Users){return Users.get({id:"me"}).$promise},parts:function($route,$q,Parts){return Parts.query({}).$promise},users:function($route,$q,Users){return Users.query({}).$promise},states:function($route,$q,States){return States.query({}).$promise},counties:function($route,$q,Counties){return Counties.query({}).$promise},applicationtypes:function($route,$q,ApplicationTypes){return ApplicationTypes.query({}).$promise},locations:function($route,$q,Locations){return Locations.query({}).$promise}}}).when("/workorder/edit/:id?",{needsLogin:!0,controller:"WorkOrderEditCtrl",templateUrl:"/lib/public/angular/apps/workorder/views/edit.html",resolve:{workorder:function($route,$q,WorkOrders){var id=$route.current.params.id||null;return id?WorkOrders.get({id}).$promise:null},woInputMatrixes:function($route,$q,WoUnitInputMatrixes){return WoUnitInputMatrixes.query({}).$promise},engineModels:function($route,$q,EngineModels){return EngineModels.query({}).$promise},frameModels:function($route,$q,FrameModels){return FrameModels.query({}).$promise},assettypes:function($route,$q,AssetTypes){return AssetTypes.query({}).$promise},reviewNotes:function($route,$q,ReviewNotes){var id=$route.current.params.id||null;return id?ReviewNotes.query({workOrder:id}).$promise:null},editHistories:function($route,$q,EditHistories){var id=$route.current.params.id||null;return id?EditHistories.query({workOrder:id}).$promise:null},me:function($route,$q,Users){return Users.get({id:"me"}).$promise},parts:function($route,$q,Parts){return Parts.query({}).$promise},states:function($route,$q,States){return States.query({}).$promise},applicationtypes:function($route,$q,ApplicationTypes){return ApplicationTypes.query({}).$promise},locations:function($route,$q,Locations){return Locations.query({}).$promise}}})}]),angular.module("WorkOrderApp").run(["$route","$rootScope","$location",function($route,$rootScope,$location){var original=$location.path;$location.path=function(path,reload){if(!1===reload)var lastRoute=$route.current,un=$rootScope.$on("$locationChangeSuccess",function(){$route.current=lastRoute,un()});return original.apply($location,[path])}}]);
function OriginDestinationLocationCtrl(LocationItemService){var self=this;self.originArray=[],self.destinationArray=[],"warehouse"===self.ccOriginType?self.originArray=LocationItemService.getLocationWarehouseObjArray(self.ccLocations):self.originArray=self.ccLocations,"warehouse-truck"===self.ccDestinationType?self.destinationArray=LocationItemService.getTruckObj(self.ccLocations):self.destinationArray=self.ccLocations,self.OriginChange=function(changedData,selected){self.ccOriginChange({changedData,selected})},self.DestinationChange=function(changedData,selected){self.ccDestinationChange({changedData,selected})}}angular.module("CommonComponents").component("generalDestinationSelection",{templateUrl:"/lib/public/angular/views/customContainers/GeneralDestinationSelection.html",bindings:{ccPanelTitle:"@",ccLabelOrigin:"@",ccLabelDestination:"@",ccReturnType:"@",ccOriginType:"@",ccDestinationType:"@",ccOriginModelName:"@",ccDestinationModelName:"@",ccOriginChange:"&",ccDestinationChange:"&",ccDataOrigin:"<",ccDataDestination:"<",ccLocations:"<"},controller:["LocationItemService",OriginDestinationLocationCtrl]});
function GeneralPartsListCtrl($uibModal){var self=this;self.openManualPartModal=function(){$uibModal.open({templateUrl:"/lib/public/angular/views/modals/manualAddPartModal.html",controller:"AddPartModalCtrl"}).result.then(function(part){var thisPart=part;thisPart.quantity=0,thisPart.isManual=!0,self.ccOnManualAdd({part:thisPart})})}}angular.module("CommonComponents").controller("AddPartModalCtrl",["$scope","$uibModalInstance",function($scope,$uibModalInstance){$scope.cancel=function(){$uibModalInstance.dismiss("cancel")}}]).component("generalPartsList",{templateUrl:"lib/public/angular/views/customComponents/GeneralPartsList.html",bindings:{ccData:"<",ccPanelTitle:"@",ccTableClass:"@",ccOnManualAdd:"&",ccOnDelete:"&"},controller:["$uibModal",GeneralPartsListCtrl]});
function SelectTechOrWarehouseCtrl(LocationItemService){var self=this;self.locationWarehouseArray=[],self.locationWarehouseNSIDArray=[],"name"===self.ccType&&(self.locationWarehouseArray=LocationItemService.getLocationNameArray(self.ccTruckId,self.ccLocations)),"netsuiteId"===self.ccType&&(self.locationTechWarehouseObjArray=LocationItemService.getLocationTechWarehouseObjArray(self.ccTruckId,self.ccLocations)),self.onChange=function(changedData,selected){self.ccOnDataChange({item:changedData,type:self.ccType,selected})}}angular.module("CommonComponents").component("selectTechWarehouseId",{templateUrl:"lib/public/angular/views/customComponents/selectTechWarehouseId.html",bindings:{ccPanelTitle:"@",ccClass:"@",ccLabel:"@",ccModelName:"@",ccReturnType:"@",ccType:"@",ccOnDataChange:"&",ccData:"<",ccLocations:"<"},controller:["LocationItemService",SelectTechOrWarehouseCtrl]});
angular.module("MCDiligenceApp.Components").component("diligenceOverviewTable",{templateUrl:"lib/public/angular/apps/mcdiligence/views/component-views/mcDiligenceOverviewTable.html",bindings:{mcUnitDiligenceReport:"&",contentSearch:"&",mcUnitDiligenceFormCount:"<",reportDisabled:"<",mcUnitDiligenceForms:"<"},controller:["$window","DateService",class MCDiligenceOverviewCtrl{constructor($window,DateService){this.DS=DateService,this.$window=$window,this.sortType="epoch",this.sortReverse=!1,this.searchFilter="",this.unitNumber="",this.reviewer="",this.limit=50,this.skip=0,this.dates={from:null,to:null,fromInput:null,toInput:null}}$onInit(){this.submit()}startOfDay(input){this.dates.fromInput=input,"object"==typeof input&&null!==input&&(this.dates.from=new Date(new Date(input).setHours(0,0,0,0))),null===input&&(this.dates.from=null)}endOfDay(input){this.dates.toInput=input,"object"==typeof input&&null!==input&&(this.dates.to=new Date(new Date(input).setHours(23,59,59,999))),null===input&&(this.dates.to=null)}resort(by){this.sortType=by,this.sortReverse=!this.sortReverse}queryConstruct(limit,skip){const query={limit,skip};return this.dates.from&&this.dates.to&&(query.from=this.DS.saveToOrion(this.dates.from),query.to=this.DS.saveToOrion(this.dates.to)),this.unitNumber&&(query.unitNumber=this.unitNumber),this.reviewer&&(query.reviewer=this.reviewer),query}submit(){this.limit=50,this.skip=0;const query=this.queryConstruct(this.limit,this.skip);this.contentSearch({query})}report(type){const query={};this.dates.from&&this.dates.to&&(query.from=this.DS.saveToOrion(this.dates.from),query.to=this.DS.saveToOrion(this.dates.to)),"mcUnitDownload"===type&&this.mcUnitDiligenceReport({query})}routeToMCDiligenceForm(mcdf){console.log("route"),this.$window.open("#/mcdiligence/view/"+mcdf._id)}}]});
angular.module("MCDiligenceApp.Components").component("wpiDiligenceOverviewTable",{templateUrl:"lib/public/angular/apps/mcdiligence/views/component-views/wpiDiligenceOverviewTable.html",bindings:{contentSearch:"&",mcUnitDiligenceFormCount:"<",mcUnitDiligenceForms:"<"},controller:["$window","DateService",class MCDiligenceOverviewCtrl{constructor($window,DateService){this.DS=DateService,this.$window=$window,this.sortType="epoch",this.sortReverse=!1,this.searchFilter="",this.limit=50,this.skip=0,this.dates={from:null,to:null,fromInput:null,toInput:null}}$onInit(){this.submit()}startOfDay(input){this.dates.fromInput=input,"object"==typeof input&&null!==input&&(this.dates.from=new Date(new Date(input).setHours(0,0,0,0))),null===input&&(this.dates.from=null)}endOfDay(input){this.dates.toInput=input,"object"==typeof input&&null!==input&&(this.dates.to=new Date(new Date(input).setHours(23,59,59,999))),null===input&&(this.dates.to=null)}resort(by){this.sortType=by,this.sortReverse=!this.sortReverse}queryConstruct(limit,skip){const query={limit,skip,leaseName:"yard"};return query}submit(){this.limit=50,this.skip=0;const query=this.queryConstruct(this.limit,this.skip);this.contentSearch({query})}routeToMCDiligenceForm(mcdf){console.log("route"),this.$window.open("#/wpi/view/"+mcdf._id)}}]});
angular.module("MCDiligenceApp.Controllers").controller("MCDiligenceCtrl",["$scope","$http","$timeout","$location","$q","ApiRequestService","DateService","AlertService",function($scope,$http,$timeout,$location,$q,ApiRequestService,DateService,AlertService){const ARS=ApiRequestService;function mapMCUnitDiligenceForms(mcd){return mcd.submitted=new Date(mcd.submitted),mcd.epoch=new Date(mcd.submitted).getTime(),mcd}$scope.infiniteScroll=!1,$scope.unitCount=0,$scope.loaded=!1,$scope.spinner=!0,$scope.reportDisabled=!1,$scope.spinnerOff=(()=>{$scope.spinner=!1}),$scope.lookup=(query=>{$scope.loaded=!1,$scope.infiniteScroll=!1,ARS.MCUnitDiligenceForms(query).then(mcUnitDiligenceForms=>{$scope.mcUnitDiligenceForms=mcUnitDiligenceForms.map(mapMCUnitDiligenceForms),$scope.loaded=!0,$scope.spinnerOff(),ARS.http.get.MCUnitDiligenceFormCount(query).then(res=>{$scope.unitCount=res.data,query.skip<$scope.unitCount&&(query.skip+=query.limit,$scope.infiniteScroll=!0,$scope.MCDiligenceScrollLookup(query))},err=>{console.error(`Counting Error: ${err}`)})}).catch(err=>console.log("Failed to load: ",err))}),$scope.MCDiligenceScrollLookup=(query=>{console.log("Looking up Call Reports..."),ARS.MCUnitDiligenceForms(query).then(mcUnitDiligenceForms=>{console.log("Call Reports Loaded.");const cr=mcUnitDiligenceForms.map(mapMCUnitDiligenceForms);$scope.mcUnitDiligenceForms=$scope.mcUnitDiligenceForms.concat(cr),$scope.infiniteScroll&&(query.skip<$scope.unitCount?(query.skip+=query.limit,$scope.infiniteScroll=!0,$scope.MCDiligenceScrollLookup(query)):$scope.mcUnitDiligenceForms.length===$scope.unitCount&&($scope.infiniteScroll=!1))}).catch(err=>console.log("Failed to load diligence forms on scroll: ",err))}),$scope.mcUnitDiligenceReport=(query=>{$http({method:"GET",url:"api/MCUnitDiligenceFormsReport",params:query}).then(res=>{angular.element("<a/>").attr({href:"data:attachment/tsv;charset=utf-8,"+encodeURI(res.data),target:"_blank",download:"MCUnitDiligenceReport.tsv"})[0].click(),$scope.reportDisabled=!1},err=>{AlertService.add("danger","Report failed",2e3),console.log(err),$scope.reportDisabled=!1})})}]);
angular.module("MCDiligenceApp.Controllers").controller("MCDiligenceReviewCtrl",["$scope","mcDiligenceForm","$uibModal",function($scope,mcDiligenceForm,$uibModal){$scope.mcDiligenceForm=mcDiligenceForm,$scope.latLong=$scope.mcDiligenceForm.coords.slice(Math.max($scope.mcDiligenceForm.coords.length-2,0)),$scope.openUnitView=(()=>{console.log("open modal");$uibModal.open({templateUrl:"/lib/public/angular/apps/mcdiligence/views/modals/mcUnitModalView.html",scope:$scope,controller:"mcDiligenceModalCtrl"})})}]);
angular.module("PaidTimeOffApp.Components").component("ptoOverviewTable",{templateUrl:"/lib/public/angular/apps/paidtimeoff/views/component-views/ptoOverviewTable.html",bindings:{paidtimeoffs:"<",scrollContentSearch:"&",getPaidTimeOffReport:"&",contentSearch:"&"},controller:["$window","$cookies","DateService",class PoOverviewCtrl{constructor($window,$cookies,DateService){this.$window=$window,this.$cookies=$cookies,this.DS=DateService,this.sortType="epoch",this.sortReverse=!1,this.searchFilter="",this.isLoaded=!1,this.username="",this.type="",this.pending=!1,this.approved=!1,this.rejected=!1,this.size=50,this.page=0,this.dates={from:null,fromInput:null,to:null,toInput:null}}$onInit(){this.role=this.$cookies.get("role"),"admin"===this.role&&(this.approved=!0,this.rejected=!0),"manager"===this.role&&(this.pending=!0,this.approved=!1,this.rejected=!1),this.submit()}resort(by){this.sortType=by,this.sortReverse=!this.sortReverse}ptostartOfDay(input){this.dates.fromInput=input,"object"==typeof input&&(this.dates.from=this.DS.startOfDay(new Date(input)))}ptoendOfDay(input){this.dates.toInput=input,"object"==typeof input&&(this.dates.to=this.DS.endOfDay(new Date(input)))}queryConstruct(size,page){const query={size,page};return this.dates.from&&this.dates.to&&(query.from=this.DS.saveToOrion(this.dates.from),query.to=this.DS.saveToOrion(this.dates.to)),this.username&&(query.username=this.username.toUpperCase()),this.type&&(query.type=this.type),this.approved&&(query.approved=this.approved),this.rejected&&(query.rejected=this.rejected),this.pending&&(query.pending=this.pending),query}loadOnScroll(){console.log("Scrolling..."),this.page+=this.size;const query=this.queryConstruct(this.size,this.page);this.scrollContentSearch({query})}submit(){this.size=50,this.page=0;const query=this.queryConstruct(this.size,this.page);this.contentSearch({query})}getReport(){const query=this.queryConstruct(this.size,this.page);query.report=!0,this.getPaidTimeOffReport({query})}clearText(selected){switch(selected){case"username":this.username=null;break;case"type":this.type=null}}routeToPaidTimeOff(pto){this.$window.open("#/paidtimeoff/review/"+pto._id)}}]});
angular.module("PaidTimeOffApp.Components").component("ptoReview",{templateUrl:"/lib/public/angular/apps/paidtimeoff/views/component-views/ptoReview.html",bindings:{paidtimeoff:"<",setAdminChanges:"&",approvalStatusChange:"&",setManagerReviewed:"&",textAreaChange:"&"},controller:["$cookies","$timeout",class PaidTimeOffReviewCtrl{constructor($cookies,$timeout){this.role=$cookies.get("role"),this.$timeout=$timeout,this.edit=!1,this.status={approved:!1,rejected:!1}}$onInit(){"Approved"===this.paidtimeoff.status&&(this.status.approved=!0,this.status.rejected=!1),"Rejected"===this.paidtimeoff.status&&(this.status.rejected=!0,this.status.approved=!1)}$doCheck(){"Approved"===this.paidtimeoff.status&&(this.status.approved=!0,this.status.rejected=!1),"Rejected"===this.paidtimeoff.status&&(this.status.rejected=!0,this.status.approved=!1)}thisBoxDataChange(changedData,selected){this.approvalStatusChange({selected})}managerCommentChange(changedData,selected){this.textAreaChange({changedData,selected})}editPTO(){this.$timeout(()=>this.edit=!this.edit)}}]});
angular.module("CallReportApp.Components").component("crCreateContactInfo",{templateUrl:"/lib/public/angular/apps/callreport/views/component-views/crCreateContactInfo.html",bindings:{onSelectChange:"&",onTextChange:"&",onManualChange:"&",activitytypes:"<",titles:"<",callreport:"<",crContactInfo:"<"},controller:[class CrCreateContactInfoCtrl{constructor(){this.phoneNumber=/^\d{3}-\d{3}-\d{4}$/,this.testEmail=/^(([^<>()\[\]\\.,;:\s@"]+(\.[^<>()\[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/,this.decisionMakerObjArray=[{type:"Yes"},{type:"No"},{type:"Maybe"}]}selectFieldChange(changedData,selected){if("Other"!==changedData)this.onSelectChange({changedData,selected});else switch(selected){case"activityType":this.onManualChange({changedData:!0,selected:"isManualActivity"}),this.onSelectChange({changedData:"",selected});break;case"title":this.onManualChange({changedData:!0,selected:"isManualTitle"}),this.onSelectChange({changedData:"",selected})}}textFieldChange(changedData,selected){if("*"===changedData&&changedData.length<2)switch(selected){case"activityType":this.onManualChange({changedData:!1,selected:"isManualActivity"}),this.onTextChange({changedData:"",selected});break;case"title":this.onManualChange({changedData:!1,selected:"isManualTitle"}),this.onTextChange({changedData:"",selected})}else this.onTextChange({changedData,selected})}}]});
angular.module("CallReportApp.Components").component("crCreateOpportunityInfo",{templateUrl:"/lib/public/angular/apps/callreport/views/component-views/crCreateOpportunityInfo.html",bindings:{onSelectChange:"&",onTextChange:"&",onCheckboxChange:"&",onTypeaheadChange:"&",onManualChange:"&",customers:"<",statustypes:"<",opptypes:"<",applicationtypes:"<",opportunitysizes:"<",unittypes:"<",callreport:"<",crOppInfo:"<"},controller:["ObjectService",class CrCreateOpportunityInfoCtrl{constructor(ObjectService){this.ObjectService=ObjectService}selectFieldChange(changedData,selected){if("Other"!==changedData)this.onSelectChange({changedData,selected});else switch(selected){case"status":this.onManualChange({changedData:!0,selected:"isManualStatus"}),this.onSelectChange({changedData:"",selected});break;case"applicationType":this.onManualChange({changedData:!0,selected:"isManualAppType"}),this.onSelectChange({changedData:"",selected});break;case"unitType":this.onManualChange({changedData:!0,selected:"isManualUnitType"}),this.onSelectChange({changedData:"",selected});break;case"oppType":this.onManualChange({changedData:!0,selected:"isManualOppType"}),this.onTextChange({changedData:"",selected})}}textFieldChange(changedData,selected){if("*"===changedData&&changedData.length<2)switch(selected){case"status":this.onManualChange({changedData:!1,selected:"isManualStatus"}),this.onTextChange({changedData:"",selected});break;case"applicationType":this.onManualChange({changedData:!1,selected:"isManualAppType"}),this.onTextChange({changedData:"",selected});break;case"unitType":this.onManualChange({changedData:!1,selected:"isManualUnitType"}),this.onTextChange({changedData:"",selected});break;case"oppType":this.onManualChange({changedData:!1,selected:"isManualOppType"}),this.onTextChange({changedData:"",selected})}else this.onTextChange({changedData,selected})}checkboxChange(changedData,selected){this.onCheckboxChange({changedData,selected})}typeaheadChange(changedData,selected){this.onTypeaheadChange({changedData,selected})}}]});
angular.module("CallReportApp.Components").component("crOverviewTable",{templateUrl:"/lib/public/angular/apps/callreport/views/component-views/crOverviewTable.html",bindings:{scrollContentSearch:"&",contentSearch:"&",onTypeaheadChange:"&",users:"<",customers:"<",callreports:"<"},controller:["$window","DateService",class CrOverviewCtrl{constructor($window,DateService){this.DS=DateService,this.$window=$window,this.sortType="epoch",this.sortReverse=!1,this.searchFilter="",this.limit=50,this.skip=0,this.customerName=null,this.userName=null,this.dates={from:null,fromInput:null,to:null,toInput:null}}$onInit(){this.submit()}customerChange(changedData,selected){this.onTypeaheadChange({changedData,selected})}userChange(changedData,selected){this.onTypeaheadChange({changedData,selected})}resort(by){this.sortType=by,this.sortReverse=!this.sortReverse}crstartOfDay(input){this.dates.fromInput=input,"object"==typeof input&&(this.dates.from=new Date(new Date(input).setHours(0,0,0,0)))}crendOfDay(input){this.dates.toInput=input,"object"==typeof input&&(this.dates.to=new Date(new Date(input).setHours(23,59,59,999)))}queryConstruct(limit,skip){const query={limit,skip};return this.dates.from&&this.dates.to&&(query.from=this.DS.saveToOrion(this.dates.from),query.to=this.DS.saveToOrion(this.dates.to)),this.userName&&(query.username=this.userName),this.customerName&&(query.customer=this.customerName),query}loadOnScroll(){console.log("Scrolling..."),this.skip+=this.limit;const query=this.queryConstruct(this.limit,this.skip);this.scrollContentSearch({query})}submit(){this.limit=50,this.skip=0;const query=this.queryConstruct(this.limit,this.skip);this.contentSearch({query})}clearText(selected){switch(selected){case"customer":this.customerName=null;break;case"user":this.userName=null}}routeToCallReport(cr){this.$window.open("#/callreport/review/"+cr._id)}}]});
angular.module("CallReportApp.Components").component("crReviewContactInfo",{templateUrl:"/lib/public/angular/apps/callreport/views/component-views/crReviewContactInfo.html",bindings:{callreport:"<"}});
angular.module("CallReportApp.Components").component("crReviewOpportunityInfo",{templateUrl:"/lib/public/angular/apps/callreport/views/component-views/crReviewOpportunityInfo.html",bindings:{callreport:"<"}});
angular.module("UnitApp.Controllers").controller("UnitIndexCtrl",["$scope","AlertService","ApiRequestService",function($scope,AlertService,ApiRequestService){const ARS=ApiRequestService;$scope.title="Units Map",$scope.units=[],$scope.bounds={},$scope.displayUnitsFromController=[],$scope.displayUsersFromController=[],$scope.displayCustomersFromController=[],$scope.setUnits=(params=>{params.hasOwnProperty("numbers")&&(params.numbers=params.numbers.replace(/\s/g,"").split(",")),params.hasOwnProperty("techs")&&(params.techs=params.techs.replace(/\s/g,"").split(",")),ARS.Units(params).then(units=>{$scope.units=units.map(unit=>{let now=new Date,inSevenDays=moment().add(7,"days"),pmDate=unit.nextPmDate?new Date(unit.nextPmDate):null,icon="lib/public/images/marker_grey.png";return pmDate&&(icon=moment(now).isAfter(pmDate,"day")?"lib/public/images/marker_red.png":moment(inSevenDays).isAfter(pmDate,"day")?"lib/public/images/marker_yellow.png":"lib/public/images/marker_green.png"),{id:unit.number,geo:unit.geo,show:!1,productSeries:unit.productSeries,locationName:unit.locationName,customerName:unit.customerName,assignedTo:unit.assignedTo,pmDate,icon}})}).catch(err=>{AlertService.add("danger","Failed to load",2e3),console.log(err)})}),$scope.typeaheadChange=function(changedData,selected){"unitNumber"===selected?ARS.Units({regexN:changedData}).then(units=>{$scope.displayUnitsFromController=units}).catch(err=>console.log(err)):"supervisor"===selected||"tech"===selected?ARS.Users({regexName:name}).then(users=>{const userArray=[];if(users.length>0){for(let user in users)if(users.hasOwnProperty(user)&&users[user].hasOwnProperty("firstName")){const fullName=users[user].firstName.concat(" ").concat(users[user].lastName),thisUser=users[user];thisUser.fullName=fullName,userArray.push(thisUser)}$scope.displayUsersFromController=userArray}}).catch(err=>console.log(err)):"customer"===selected&&ARS.Customers({regexName:changedData}).then(customers=>{$scope.displayCustomersFromController=customers}).catch(err=>console.log(err))}}]);
angular.module("UnitApp.Controllers").controller("UnitViewCtrl",["$window","$scope","$route","$location","AlertService","SessionService","ApiRequestService","unit",function($window,$scope,$route,$location,AlertService,SessionService,ApiRequestService,unit){const ARS=ApiRequestService,SS=SessionService;$scope.unit=unit,$scope.title=unit.number,$scope.user={},$scope.supervisor={},unit.assignedTo&&ARS.getUser({id:unit.assignedTo}).then(user=>($scope.user=user,ARS.getUser({id:user.supervisor}))).then(supervisor=>{$scope.supervisor=supervisor}).catch(err=>{AlertService.add("danger","Could not populate user data for PM Report"),console.log(err)}),$scope.searchUnits=(()=>{SS.add("unitNumber",$scope.unit.number),$window.open("#/workorder")})}]);
angular.module("UnitApp.Controllers").controller("UnitPageCtrl",["coords","$scope",function(coords,$scope){$scope.coords=coords}]);
angular.module("UnitApp.Components").component("unitMap",{templateUrl:"/lib/public/angular/apps/unit/views/component-views/unitMap.html",bindings:{units:"<",bounds:"<"},controller:["$scope",class UnitMapCtrl{constructor($scope){this.map={center:{latitude:37.996162679728116,longitude:-98.0419921875},zoom:4,mapEvents:{click:(marker,eventName,model)=>{const thisMarker={id:0,geo:{type:"Point",coordinates:[0,0]}};thisMarker.geo.coordinates[0]=model[0].latLng.lng().toFixed(6),thisMarker.geo.coordinates[1]=model[0].latLng.lat().toFixed(6),this.map.CoordInfoWindow.marker=thisMarker,$scope.$apply()}},options:{pixelOffset:{width:-1,height:-45}},CoordMarkerEvents:{click:(marker,eventName,model)=>{this.map.CoordInfoWindow.model=model,this.map.CoordInfoWindow.show=!0,this.map.unitInfoWindow.show=!1}},CoordInfoWindow:{marker:{id:0},show:!1,closeClick:function(){this.show=!1}},unitMarkerEvents:{click:(marker,eventName,model)=>{this.map.unitInfoWindow.model=model,this.map.unitInfoWindow.show=!0,this.map.CoordInfoWindow.show=!1}},unitInfoWindow:{marker:{},show:!1,closeClick:function(){this.show=!1}}},this.options={scrollwheel:!1}}}]});
angular.module("UnitApp.Components").component("unitPage",{templateUrl:"/lib/public/angular/apps/unit/views/component-views/unitPage.html",bindings:{coords:"<"},controller:["$scope","$timeout","uiGmapGoogleMapApi",class UnitPageCtrl{constructor($scope,$timeout,uiGmapGoogleMapApi){this.showMap=!1,this.$scope=$scope,this.$timeout=$timeout,this.ui=uiGmapGoogleMapApi,this.map={center:{latitude:37.996162679728116,longitude:-98.0419921875},zoom:13,bounds:{},mapEvents:{click:(marker,eventName,model)=>{const thisMarker={id:3,geo:{type:"Point",coordinates:[0,0]}};thisMarker.geo.coordinates[0]=model[0].latLng.lng().toFixed(6),thisMarker.geo.coordinates[1]=model[0].latLng.lat().toFixed(6),this.map.CoordInfoWindow.marker=thisMarker,$scope.$apply()}},options:{pixelOffset:{width:-1,height:-45}},CoordMarkerEvents:{click:(marker,eventName,model)=>{this.map.CoordInfoWindow.model=model,this.map.CoordInfoWindow.show=!0}},CoordInfoWindow:{marker:{id:3},show:!1,closeClick:function(){this.show=!1}}},this.options={scrollwheel:!0}}$onInit(){this.map.center={latitude:this.coords[1],longitude:this.coords[0]},this.marker={id:4,geo:{type:"Point",coordinates:this.coords}},this.ui.then(()=>{this.$timeout(()=>{this.showMap=!0},100)})}}]});
angular.module("UnitApp.Components").component("unitSat",{templateUrl:"/lib/public/angular/apps/unit/views/component-views/unitSat.html",bindings:{unit:"<"},controller:["$scope","$timeout","uiGmapGoogleMapApi",class UnitSatCtrl{constructor($scope,$timeout,uiGmapGoogleMapApi){this.showMap=!1,this.$scope=$scope,this.$timeout=$timeout,this.ui=uiGmapGoogleMapApi,this.map={center:{latitude:37.996162679728116,longitude:-98.0419921875},zoom:18,bounds:{},mapEvents:{click:(marker,eventName,model)=>{const thisMarker={id:1,geo:{type:"Point",coordinates:[0,0]}};thisMarker.geo.coordinates[0]=model[0].latLng.lng().toFixed(6),thisMarker.geo.coordinates[1]=model[0].latLng.lat().toFixed(6),this.map.CoordInfoWindow.marker=thisMarker,$scope.$apply()}},options:{pixelOffset:{width:-1,height:-45}},CoordMarkerEvents:{click:(marker,eventName,model)=>{this.map.CoordInfoWindow.model=model,this.map.CoordInfoWindow.show=!0}},CoordInfoWindow:{marker:{id:1},show:!1,closeClick:function(){this.show=!1}}},this.options={scrollwheel:!1,mapTypeId:google.maps.MapTypeId.SATELLITE}}$onInit(){this.map.center=_.cloneDeep(this.unit.geo);let now=new Date,inSevenDays=moment().add(7,"days"),pmDate=this.unit.nextPmDate?new Date(this.unit.nextPmDate):null,icon="lib/public/images/marker_grey.png";pmDate&&(icon=moment(now).isAfter(pmDate,"day")?"lib/public/images/marker_red.png":moment(inSevenDays).isAfter(pmDate,"day")?"lib/public/images/marker_yellow.png":"lib/public/images/marker_green.png"),this.marker={id:0,geo:this.unit.geo,options:{icon}},this.ui.then(()=>{this.$timeout(()=>{this.showMap=!0},100)})}}]});
angular.module("UnitApp.Components").component("unitSearch",{templateUrl:"/lib/public/angular/apps/unit/views/component-views/unitSearch.html",bindings:{populateUnits:"&",onTypeaheadChange:"&",displayUnits:"<",users:"<",customers:"<"},controller:[class UnitSearchCtrl{constructor(){this.params={numbers:null,supervisor:null,techs:null,customer:null,from:null,to:null,size:99999}}unitChange(changedData,selected){this.onTypeaheadChange({changedData,selected})}supervisorChange(changedData,selected){this.onTypeaheadChange({changedData,selected})}techChange(changedData,selected){this.onTypeaheadChange({changedData,selected})}customerChange(changedData,selected){this.onTypeaheadChange({changedData,selected})}clearText(selected){switch(selected){case"unitNumber":this.params.numbers=null;break;case"supervisor":this.params.supervisor=null;break;case"tech":this.params.techs=null;break;case"customer":this.params.customer=null}}search(){const params=_.omitBy(this.params,_.isNull);this.populateUnits({params})}}]});
angular.module("CallReportApp.Controllers").controller("CallReportCreateCtrl",["$scope","$timeout","$uibModal","$cookies","$location","AlertService","ObjectService","ApiRequestService","CallReports","unittypes","titles","statustypes","opportunitysizes","opptypes","activitytypes","applicationtypes","DateService",function($scope,$timeout,$uibModal,$cookies,$location,AlertService,ObjectService,ApiRequestService,CallReports,unittypes,titles,statustypes,opportunitysizes,opptypes,activitytypes,applicationtypes,DateService){const ARS=ApiRequestService,DS=DateService;$scope.unittypes=unittypes,$scope.titles=titles,$scope.statustypes=statustypes,$scope.opportunitysizes=opportunitysizes,$scope.opptypes=opptypes,$scope.activitytypes=activitytypes,$scope.customers=[],$scope.applicationtypes=applicationtypes,$scope.techId=$cookies.get("tech"),$scope.valid=!1,$scope.callreport=function newCallReport(){return{customer:"",title:"",isManualTitle:!1,activityType:"",isManualActivity:!1,applicationType:"",isManualAppType:!1,unitType:"",isManualUnitType:!1,status:"",isManualStatus:!1,oppType:"",isManualOppType:!1,size:"",phoneNumber:"",contactName:"",officeLocation:"",email:"",callTime:new Date,newCustomer:!1,decisionMaker:"",currentSpend:"",username:$scope.techId,extension:"",comment:""}}(),$scope.oppFormValid=!1,$scope.selectFieldChange=((changedData,selected)=>{ObjectService.updateNonNestedObjectValue($scope.callreport,changedData,selected)}),$scope.typeaheadChange=((changedData,selected)=>{ObjectService.updateNonNestedObjectValue($scope.callreport,changedData,selected),"customer"===selected&&ARS.Customers({regexName:changedData}).then(customers=>{$scope.customers=customers}).catch(err=>{console.log(err)})}),$scope.textFieldChange=((changedData,selected)=>{ObjectService.updateNonNestedObjectValue($scope.callreport,changedData,selected)}),$scope.checkboxChange=((changedData,selected)=>{ObjectService.updateNonNestedObjectValue($scope.callreport,changedData,selected)}),$scope.isManualChange=((changedData,selected)=>{ObjectService.updateNonNestedObjectValue($scope.callreport,changedData,selected)}),$scope.save=(()=>{$scope.callreport.callTime&&($scope.callreport.callTime=DS.saveToOrion($scope.callreport.callTime)),CallReports.save({},$scope.callreport,res=>{AlertService.add("success","Successfully created Call Report."),$location.url("/callreport")},err=>{AlertService.add("danger","An error occurred while attempting to save."),console.log(err)})})}]);
angular.module("CallReportApp.Controllers").controller("CallReportCtrl",["$scope","$http","$timeout","$location","$q","ApiRequestService","DateService",function($scope,$http,$timeout,$location,$q,ApiRequestService,DateService){const ARS=ApiRequestService,DS=DateService;function mapCallReports(cr){return cr.callTime=DS.displayLocal(new Date(cr.callTime)),cr.epoch=new Date(cr.callTime).getTime(),cr}$scope.loaded=!1,$scope.spinner=!0,$scope.displayUsersFromController=[],$scope.displayCustomersFromController=[],$scope.spinnerOff=(()=>{$scope.spinner=!1}),$scope.lookup=(query=>{$scope.loaded=!1,ARS.CallReports(query).then(callreports=>{$scope.callreports=callreports.map(mapCallReports),$scope.loaded=!0,$scope.spinnerOff()}).catch(err=>console.log("Failed to load: ",err))}),$scope.CallReportScrollLookup=(query=>{console.log("Looking up Call Reports..."),ARS.CallReports(query).then(callreports=>{console.log("Call Reports Loaded.");const cr=callreports.map(mapCallReports);$scope.callreports=$scope.callreports.concat(cr)}).catch(err=>console.log("Failed to load call reports on scroll: ",err))}),$scope.typeaheadChange=((changedData,selected)=>{"user"===selected?ARS.Users({regexName:name}).then(users=>{const userArray=[];if(users.length>0){for(let user in users)if(users.hasOwnProperty(user)&&users[user].hasOwnProperty("firstName")){const fullName=users[user].firstName.concat(" ").concat(users[user].lastName),thisUser=users[user];thisUser.fullName=fullName,userArray.push(thisUser)}$scope.displayUsersFromController=userArray}}).catch(err=>console.log(err)):"customer"===selected&&ARS.Customers({regexName:changedData}).then(customers=>{$scope.displayCustomersFromController=customers}).catch(err=>console.log(err))}),$scope.createCallReport=function(){$location.url("/callreport/create")}}]);
angular.module("CallReportApp.Controllers").controller("CallReportReviewCtrl",["$scope","ApiRequestService","callreport","DateService",function($scope,ApiRequestService,callreport,DateService){const ARS=ApiRequestService,DS=DateService;$scope.callreport=callreport,$scope.userRealName="",$scope.callreport.callTime=DS.displayLocal(new Date($scope.callreport.callTime)),ARS.getUser({id:callreport.username}).then(user=>{user.hasOwnProperty("firstName")?$scope.userRealName=user.firstName.concat(" ").concat(user.lastName):$scope.userRealName=callreport.username}).catch(err=>console.log(err))}]);
angular.module("PartOrderApp.Controllers").controller("PartOrderCreateCtrl",["$scope","$timeout","$uibModal","$cookies","$location","AlertService","GeneralPartSearchService","LocationItemService","ObjectService","PartOrders","locations","parts","DateService",function($scope,$timeout,$uibModal,$cookies,$location,AlertService,GeneralPartSearchService,LocationItemService,ObjectService,PartOrders,locations,parts,DateService){const DS=DateService;$scope.partorder={partNSID:null,quantity:null,timeCreated:null,comment:"",trackingNumber:"",techId:"",originNSID:"",destinationNSID:"",part:{}},$scope.parts=parts,$scope.locations=locations,$scope.techId=$cookies.get("tech"),$scope.valid=!1;$scope.isValid=(()=>{$scope.partorder.part.quantity>0&&$scope.partorder.originNSID&&$scope.partorder.destinationNSID?$scope.valid=!0:$scope.valid=!1}),$scope.$watch("partorder.part.quantity",(newVal,oldVal)=>{newVal!==oldVal&&$scope.isValid()}),$scope.$watch("partorder.originNSID",(newVal,oldVal)=>{newVal!==oldVal&&$scope.isValid()}),$scope.$watch("partorder.destinationNSID",(newVal,oldVal)=>{newVal!==oldVal&&($scope.isValid(),$scope.partorder.truckId=LocationItemService.getTruckFromNSID($scope.partorder.destinationNSID,$scope.locations))}),$scope.addManualPart=(part=>{$scope.partorder.part=part}),$scope.deletePart=(()=>{$scope.partorder.part={}}),$scope.originChange=((changedData,selected)=>{ObjectService.updateNonNestedObjectValue($scope.partorder,changedData,selected)}),$scope.destinationChange=((changedData,selected)=>{ObjectService.updateNonNestedObjectValue($scope.partorder,changedData,selected)}),$scope.partsTableModel=GeneralPartSearchService.partTableModel($scope.parts,"replace",$scope.partorder),$scope.save=(()=>{const now=new Date;$scope.partorder.partNSID=$scope.partorder.part.netsuiteId,$scope.partorder.quantity=$scope.partorder.part.quantity,$scope.partorder.timeCreated=now,$scope.partorder.timeSubmitted=now,$scope.partorder.techId=$scope.techId,$scope.partorder.timeCreated&&($scope.partorder.timeCreated=DS.saveToOrion(new Date($scope.partorder.timeCreated))),$scope.partorder.timeSubmitted&&($scope.partorder.timeSubmitted=DS.saveToOrion(new Date($scope.partorder.timeSubmitted))),$scope.partorder.timeOrdered&&($scope.partorder.timeOrdered=DS.saveToOrion(new Date($scope.partorder.timeOrdered))),$scope.partorder.timeComplete&&($scope.partorder.timeComplete=DS.saveToOrion(new Date($scope.partorder.timeComplete))),PartOrders.save({},$scope.partorder,res=>{AlertService.add("success","Successfully created Part Order!"),$location.url("/partorder")},err=>{$scope.partorder.timeCreated&&($scope.partorder.timeCreated=DS.displayLocal(new Date($scope.partorder.timeCreated))),$scope.partorder.timeSubmitted&&($scope.partorder.timeSubmitted=DS.displayLocal(new Date($scope.partorder.timeSubmitted))),$scope.partorder.timeOrdered&&($scope.partorder.timeOrdered=DS.displayLocal(new Date($scope.partorder.timeOrdered))),$scope.partorder.timeComplete&&($scope.partorder.timeComplete=DS.displayLocal(new Date($scope.partorder.timeComplete))),AlertService.add("danger","An error occurred while attempting to save."),console.log(err)})})}]);
angular.module("PartOrderApp.Controllers").controller("PartOrderCtrl",["$scope","$http","$timeout","$location","$q","$cookies","AlertService","LocationItemService","ApiRequestService","locations","DateService",function($scope,$http,$timeout,$location,$q,$cookies,AlertService,LocationItemService,ApiRequestService,locations,DateService){const ARS=ApiRequestService,DS=DateService;function mapPartOrders(po){return po.timeSubmitted=DS.displayLocal(new Date(po.timeSubmitted)),po.epoch=new Date(po.timeSubmitted).getTime(),po.destination=LocationItemService.getNameFromNSID(po.destinationNSID,$scope.locations),po.inList=!!po.inList,po}$scope.loaded=!1,$scope.spinner=!0,$scope.locations=locations,$scope.spinnerOff=(()=>{$scope.spinner=!1}),$scope.listIt=(po=>{po.inList=!!po.inList}),$scope.lookup=(query=>{$scope.loaded=!1,console.log("Looking up Part Orders..."),ARS.PartOrders(query).then(partorders=>{console.log("Part Orders Loaded."),$scope.partorders=partorders.map(mapPartOrders),$scope.loaded=!0,$scope.spinnerOff()}).catch(err=>console.log("Failed to load: ",err))}),$scope.report=(query=>{$http({method:"GET",url:"/api/partorders",params:query}).then(res=>{angular.element("<a/>").attr({href:"data:attachment/csv;charset=utf-8,"+encodeURI(res.data),target:"_blank",download:"PartsReport.csv"})[0].click()},err=>{AlertService.add("danger","Report failed to load",2e3),console.log(err)})}),$scope.PartOrderScrollLookup=(query=>{console.log("Looking up Part Orders..."),ARS.PartOrders(query).then(partorders=>{console.log("Part Orders Loaded.");const po=partorders.map(mapPartOrders);$scope.partorders=$scope.partorders.concat(po)}).catch(err=>console.log("Failed to load part orders: ",err))}),$scope.createPartOrder=(()=>{$location.url("/partorder/create")})}]);
angular.module("PartOrderApp.Controllers").controller("PartOrderEditCtrl",["$scope","$location","$timeout","$cookies","AlertService","ObjectService","LocationItemService","PartOrders","InventoryTransfers","partorder","locations","DateService",function($scope,$location,$timeout,$cookies,AlertService,ObjectService,LocationItemService,PartOrders,InventoryTransfers,partorder,locations,DateService){const DS=DateService;$scope.locations=locations,$scope.partorder=partorder;const setDisplay=()=>{$scope.partorder.timeCreated&&($scope.partorder.timeCreated=DS.displayLocal(new Date($scope.partorder.timeCreated))),$scope.partorder.timeSubmitted&&($scope.partorder.timeSubmitted=DS.displayLocal(new Date($scope.partorder.timeSubmitted))),$scope.partorder.timeOrdered&&($scope.partorder.timeOrdered=DS.displayLocal(new Date($scope.partorder.timeOrdered))),$scope.partorder.timeComplete&&($scope.partorder.timeComplete=DS.displayLocal(new Date($scope.partorder.timeComplete)))};$scope.headerSelectFieldChange=((changedData,selected)=>{ObjectService.updateNonNestedObjectValue($scope.partorder,changedData,selected)}),$scope.headerTextFieldChange=((changedData,selected)=>{ObjectService.updateNonNestedObjectValue($scope.partorder,changedData,selected)}),$scope.changeThisTextField=((changedData,selected)=>{"carrier"===selected&&ObjectService.updateNonNestedObjectValue($scope.partorder,changedData.toUpperCase(),selected)}),$scope.changeThisTextAreaField=((changedData,selected)=>{ObjectService.updateNonNestedObjectValue($scope.partorder,changedData,selected)}),$scope.changeStatus=((changedData,selected)=>{$scope.partorder.status=selected}),$scope.changeQuantity=((changedData,selected)=>{$scope.partorder.quantity=changedData}),$scope.submit=(status=>{let ableToSubmit=!0;"canceled"!==status||$scope.partorder.comment||(AlertService.add("danger","Please fill out the comment box if canceling a part order."),ableToSubmit=!1),"ordered"!==status||$scope.partorder.poNumber||(AlertService.add("danger","Please fill out the PO number. If none leave N/A"),ableToSubmit=!1),ableToSubmit&&("ordered"!==status&&"backorder"!==status&&"canceled"!==status||($scope.partorder.approvedBy=$cookies.get("tech")),"completed"===status&&($scope.partorder.completedBy=$cookies.get("tech")),"canceled"===status&&"Orion"===$scope.partorder.source&&($scope.partorder.completedBy=$cookies.get("tech")),"ordered"===status&&($scope.partorder.timeOrdered=new Date),$scope.partorder.timeCreated&&($scope.partorder.timeCreated=DS.saveToOrion(new Date($scope.partorder.timeCreated))),$scope.partorder.timeSubmitted&&($scope.partorder.timeSubmitted=DS.saveToOrion(new Date($scope.partorder.timeSubmitted))),$scope.partorder.timeOrdered&&($scope.partorder.timeOrdered=DS.saveToOrion(new Date($scope.partorder.timeOrdered))),$scope.partorder.timeComplete&&($scope.partorder.timeComplete=DS.saveToOrion(new Date($scope.partorder.timeComplete))),PartOrders.update({id:$scope.partorder.orderId},$scope.partorder,res=>{if(AlertService.add("success","Update was successful."),console.log(res),"completed"===res.status){const thisIT=$scope.newInventoryTransfer();thisIT.originLocationNSID=res.originNSID,thisIT.destinationLocationNSID=res.destinationNSID,thisIT.originLocation=LocationItemService.getIDFromNSID(res.originNSID,$scope.locations),thisIT.destinationLocation=LocationItemService.getIDFromNSID(res.destinationNSID,$scope.locations),thisIT.truckId=LocationItemService.getTruckFromNSID(res.destinationNSID,$scope.locations),thisIT.parts.push(res.part),thisIT.parts[0].netsuiteId=res.partNSID,thisIT.parts[0].quantity=res.quantity,InventoryTransfers.save({},thisIT,res=>{console.log("Inventory Transfer Created."),$scope.completeForm()},err=>{setDisplay(),AlertService.add("danger","An error occurred while attempting to save inventory transfer."),console.log(err)})}else $scope.completeForm()},function(err){setDisplay(),console.log(err),AlertService.add("danger","An error occurred while attempting to update this part order.")}))}),$scope.newInventoryTransfer=(()=>({inventorytransferDate:DS.saveToOrion(new Date),truckId:"",originLocation:null,originLocationNSID:"",destinationLocation:null,destinationLocationNSID:"",parts:[],techId:$scope.partorder.techId})),$scope.completeForm=(()=>{$location.url("/partorder")}),setDisplay()}]);
angular.module("PartOrderApp.Controllers").controller("PartOrderReviewCtrl",["$scope","partorder","locations","DateService",function($scope,partorder,locations,DateService){const DS=DateService;$scope.locations=locations,$scope.partorder=partorder,$scope.partorder.timeCreated&&($scope.partorder.timeCreated=DS.displayLocal(new Date($scope.partorder.timeCreated))),$scope.partorder.timeSubmitted&&($scope.partorder.timeSubmitted=DS.displayLocal(new Date($scope.partorder.timeSubmitted))),$scope.partorder.timeOrdered&&($scope.partorder.timeOrdered=DS.displayLocal(new Date($scope.partorder.timeOrdered))),$scope.partorder.timeComplete&&($scope.partorder.timeComplete=DS.displayLocal(new Date($scope.partorder.timeComplete)))}]);
angular.module("PartOrderApp.Controllers").controller("PartOrdersEditCtrl",["$scope","$location","$timeout","$cookies","AlertService","ObjectService","LocationItemService","PartOrders","InventoryTransfers","partorders","locations","DateService",function($scope,$location,$timeout,$cookies,AlertService,ObjectService,LocationItemService,PartOrders,InventoryTransfers,partorders,locations,DateService){const AS=AlertService,DS=DateService,LIS=LocationItemService;$scope.locations=locations,$scope.partorders=partorders,$scope.comment="",$scope.status=[{type:"ordered",value:!1},{type:"backorder",value:!1},{type:"canceled",value:!1},{type:"completed",value:!1}],$scope.type={},$scope.disabled=!1;$scope.changeCheckBoxes=((data,selected)=>{_.map($scope.status,obj=>{obj.type===selected&&(obj.value=!0,$scope.type=obj,$scope.status.forEach(x=>{x.type!==selected&&(x.value=!1)}))})});const setDisplay=()=>{$scope.partorders.forEach(po=>{po.timeCreated&&(po.timeCreated=DS.displayLocal(new Date(po.timeCreated))),po.timeSubmitted&&(po.timeSubmitted=DS.displayLocal(new Date(po.timeSubmitted))),po.timeOrdered&&(po.timeOrdered=DS.displayLocal(new Date(po.timeOrdered))),po.timeComplete&&(po.timeComplete=DS.displayLocal(new Date(po.timeComplete)))})};$scope.headerSelectFieldChange=((changedData,selected)=>{$scope.partorders.forEach(po=>{po[selected]=changedData})}),$scope.changeThisTextAreaField=((changedData,selected)=>{$scope.partorders.forEach(po=>{po[selected]=changedData})}),$scope.headerTextFieldChange=((changedData,selected)=>{$scope.partorders.forEach(po=>{po[selected]=changedData})}),$scope.changeStatus=((changedData,selected)=>{$scope.partorders.forEach(po=>po.status=selected)}),$scope.submit=(status=>{let ableToSubmit=!0,commenError=!1,poNumberError=!1,statusError=!1,originError=!1;if($scope.partorders.forEach(po=>{"canceled"!==po.status||po.comment||(commenError=!0,ableToSubmit=!1),"ordered"!==po.status||po.poNumber||(poNumberError=!0,ableToSubmit=!1),po.status||(statusError=!0,ableToSubmit=!1),po.originNSID||(ableToSubmit=!1,originError=!0)}),ableToSubmit){const tech=$cookies.get("tech"),now=new Date;$scope.partorders.forEach(po=>{"ordered"!==po.status&&"backorder"!==po.status&&"canceled"!==po.status||(po.approvedBy=tech),"completed"===po.status&&(po.completedBy=tech),"canceled"===po.status&&"Orion"===po.source&&(po.completedBy=tech),"ordered"===po.status&&(po.timeOrdered=now),(po=>{po.timeCreated&&(po.timeCreated=DS.saveToOrion(new Date(po.timeCreated))),po.timeSubmitted&&(po.timeSubmitted=DS.saveToOrion(new Date(po.timeSubmitted))),po.timeOrdered&&(po.timeOrdered=DS.saveToOrion(new Date(po.timeOrdered))),po.timeComplete&&(po.timeComplete=DS.saveToOrion(new Date(po.timeComplete)))})(po),PartOrders.update({id:po.orderId},po,res=>{if(AS.add("success","Update was successful."),console.log(res),"completed"===res.status){const thisIT=$scope.newInventoryTransfer();thisIT.originLocationNSID=res.originNSID,thisIT.destinationLocationNSID=res.destinationNSID,thisIT.originLocation=LocationItemService.getIDFromNSID(res.originNSID,$scope.locations),thisIT.destinationLocation=LocationItemService.getIDFromNSID(res.destinationNSID,$scope.locations),thisIT.truckId=LocationItemService.getTruckFromNSID(res.destinationNSID,$scope.locations),thisIT.parts.push(res.part),thisIT.parts[0].netsuiteId=res.partNSID,thisIT.parts[0].quantity=res.quantity,InventoryTransfers.save({},thisIT,res=>{console.log("Inventory Transfer Created."),$scope.completeForm()},err=>{setDisplay(),AS.add("danger","An error occurred while attempting to save inventory transfer."),console.log(err)})}else $scope.completeForm()},function(err){setDisplay(),console.log(err),AlertService.add("danger","An error occurred while attempting to update this part order.")})})}else commenError&&AS.add("danger","Please fill out the comment box if canceling a part order."),poNumberError&&AS.add("danger","Please fill out the PO number. If none leave N/A"),statusError&&AS.add("danger","Must select a status"),originError&&AS.add("danger","Must select Origin")}),$scope.completeForm=(()=>{$location.url("/partorder")}),setDisplay(),$scope.partorders.forEach(po=>{po.destinationLocationName=LIS.getNameFromNSID(po.destinationNSID,$scope.locations)}),$scope.partorders.forEach(po=>{"canceled"!==po.status&&"completed"!==po.status||!po.timeComplete||($scope.disabled=!0)})}]);
angular.module("PartOrderApp.Components").controller("AddPartPOModalCtrl",["$scope","$uibModalInstance",function($scope,$uibModalInstance){$scope.part={},$scope.part.netsuiteId=0,$scope.addPart=(()=>{$uibModalInstance.close($scope.part)}),$scope.cancel=(()=>{$uibModalInstance.dismiss("cancel")})}]).component("poCreatePart",{templateUrl:"/lib/public/angular/apps/partorder/views/component-views/poCreatePart.html",bindings:{part:"<",onManualAdd:"&",onDelete:"&"},controller:["$uibModal",class CreatePart{constructor($uibModal){this.$uibModal=$uibModal}Empty(){return!_.isEmpty(this.part)}openManualPartModal(){this.$uibModal.open({templateUrl:"/lib/public/angular/views/modals/manualAddPartModal.html",controller:"AddPartPOModalCtrl"}).result.then(part=>{const thispart=part;thispart.quantity=0,thispart.isManual=!0,this.onManualAdd({part:thispart})})}}]});
angular.module("PartOrderApp.Components").component("poEditHeading",{templateUrl:"/lib/public/angular/apps/partorder/views/component-views/poEditHeading.html",bindings:{selectOriginType:"@",onTextChange:"&",onSelectChange:"&",locations:"<",partorder:"<"},controller:["LocationItemService",class PartOrderEditHeadingCtrl{constructor(LocationItemService){this.LocationItemService=LocationItemService}$onInit(){this.locationWarehouseObjArray=this.LocationItemService.getLocationWarehouseObjArray(this.locations),this.originLocation=this.LocationItemService.getNameFromNSID(this.partorder.originNSID,this.locations),this.destinationLocation=this.LocationItemService.getNameFromNSID(this.partorder.destinationNSID,this.locations)}$doCheck(){null!==this.partorder.originNSID&&(this.originLocation=this.LocationItemService.getNameFromNSID(this.partorder.originNSID,this.locations))}selectFieldChange(changedData,selected){this.onSelectChange({changedData,selected})}textFieldChange(changedData,selected){this.onTextChange({changedData,selected})}}]});
angular.module("PartOrderApp.Components").component("poEditTable",{templateUrl:"/lib/public/angular/apps/partorder/views/component-views/poEditTable.html",bindings:{partorder:"<",onChangeQuantity:"&",onSelection:"&"},controller:class EditTableCtrl{constructor(){this.status=[{type:"ordered",value:!1},{type:"backorder",value:!1},{type:"canceled",value:!1},{type:"completed",value:!1}]}changeCheckBoxes(data,selected){_.map(this.status,obj=>{obj.type===selected&&(obj.value=!0,this.status.forEach(x=>{x.type!==selected&&(x.value=!1)}))})}checkDisabled(box){return!("complete"===box||!this.partorder.timeShipped)}quantityChange(changedData,selected){!0===new RegExp(/^\d+$/).test(changedData)?this.onChangeQuantity({changedData:+changedData,selected}):""===changedData&&this.onChangeQuantity({changedData:0,selected})}thisBoxDataChange(changedData,selected){"canceled"!==selected&&(this.partorder.comment=""),!0===changedData&&(this.changeCheckBoxes(changedData,selected),this.onSelection({changedData,selected}))}}});
angular.module("PartOrderApp.Components").component("poOverviewTable",{templateUrl:"/lib/public/angular/apps/partorder/views/component-views/poOverviewTable.html",bindings:{partorders:"<",locations:"<",listIt:"&",scrollContentSearch:"&",getPartOrderReport:"&",contentSearch:"&"},controller:["$window","LocationItemService","DateService",class PoOverviewCtrl{constructor($window,LocationItemService,DateService){this.$window=$window,this.LIS=LocationItemService,this.DS=DateService,this.sortType="epoch",this.sortReverse=!1,this.searchFilter="",this.isLoaded=!1,this.username=null,this.destination=null,this.pending=!0,this.backorder=!0,this.ordered=!0,this.completed=!1,this.canceled=!1,this.size=50,this.page=0,this.dates={from:null,fromInput:null,to:null,toInput:null}}$onInit(){this.submit()}resort(by){this.sortType=by,this.sortReverse=!this.sortReverse}postartOfDay(input){this.dates.fromInput=input,"object"==typeof input&&(this.dates.from=new Date(new Date(input).setHours(0,0,0,0)))}poendOfDay(input){this.dates.toInput=input,"object"==typeof input&&(this.dates.to=new Date(new Date(input).setHours(23,59,59,999)))}changeThisCheckbox(selected){this.listIt({po:selected})}queryConstruct(size,page){const query={size,page};return this.dates.from&&this.dates.to&&(query.from=this.DS.saveToOrion(this.dates.from),query.to=this.DS.saveToOrion(this.dates.to)),this.username&&(query.techId=this.username.toUpperCase()),this.destination&&(query.destination=this.LIS.getTruckFromString(this.destination,this.locations).netsuiteId),this.pending&&(query.pending=this.pending),this.ordered&&(query.ordered=this.ordered),this.backorder&&(query.backorder=this.backorder),this.canceled&&(query.canceled=this.canceled),this.completed&&(query.completed=this.completed),query}loadOnScroll(){console.log("Scrolling..."),this.page+=this.size;const query=this.queryConstruct(this.size,this.page);this.scrollContentSearch({query})}submit(){this.size=50,this.page=0;const query=this.queryConstruct(this.size,this.page);this.contentSearch({query})}getReport(){const query=this.queryConstruct(this.size,this.page);query.report=!0,this.getPartOrderReport({query})}clearText(selected){switch(selected){case"username":this.username=null;break;case"destination":this.destination=null}}routeToPartOrder(po){if(po.inList){const pos=[];this.partorders.forEach(p=>{p.inList&&pos.push(p._id)}),po.inList&&this.$window.open("#/partorder/editMany/"+JSON.stringify(pos))}else"canceled"!==po.status&&"completed"!==po.status?this.$window.open("#/partorder/edit/"+po.orderId):this.$window.open("#/partorder/review/"+po.orderId)}}]});
angular.module("PartOrderApp.Components").component("poReviewHeading",{templateUrl:"/lib/public/angular/apps/partorder/views/component-views/poReviewHeading.html",bindings:{locations:"<",partorder:"<"},controller:["LocationItemService",class PartOrderReviewHeadingCtrl{constructor(LocationItemService){this.LocationItemService=LocationItemService}$onInit(){this.originLocation=this.LocationItemService.getNameFromNSID(this.partorder.originNSID,this.locations),this.destinationLocation=this.LocationItemService.getNameFromNSID(this.partorder.destinationNSID,this.locations)}}]});
angular.module("PartOrderApp.Components").component("poReviewTable",{templateUrl:"/lib/public/angular/apps/partorder/views/component-views/poReviewTable.html",bindings:{partorder:"<"}});
angular.module("PartOrderApp.Components").component("posEditHeading",{templateUrl:"/lib/public/angular/apps/partorder/views/component-views/posEditHeading.html",bindings:{selectOriginType:"@",onTextChange:"&",onSelectChange:"&",onSelection:"&",changeCheckBoxes:"&",disabled:"<",locations:"<",status:"<",partorders:"<"},controller:["LocationItemService",class PartOrderEditHeadingCtrl{constructor(LocationItemService){this.LocationItemService=LocationItemService,this.poNumber="",this.originNSID=0}$onInit(){this.locationWarehouseObjArray=this.LocationItemService.getLocationWarehouseObjArray(this.locations)}selectFieldChange(changedData,selected){this.onSelectChange({changedData,selected})}textFieldChange(changedData,selected){this.onTextChange({changedData,selected})}thisBoxDataChange(changedData,selected){"canceled"!==selected&&this.partorders.forEach(po=>po.comment=""),!0===changedData&&(this.changeCheckBoxes({changedData,selected}),this.onSelection({changedData,selected}))}}]});
angular.module("PartOrderApp.Components").component("posEditTable",{templateUrl:"/lib/public/angular/apps/partorder/views/component-views/posEditTable.html",bindings:{onTextChagne:"&",disabled:"<",partorders:"<"},controller:class EditTableCtrl{constructor(){this.status=[{type:"ordered",value:!1},{type:"backorder",value:!1},{type:"canceled",value:!1},{type:"completed",value:!1}]}checkDisabled(box){return!("complete"===box||!this.partorder.timeShipped)}}});
class WorkOrderOverviewTableCtrl{constructor($window,$cookies,$uibModal,SessionService,TimeDisplayService,DateService,WorkOrders){this.$window=$window,this.$cookies=$cookies,this.modal=$uibModal,this.TDS=TimeDisplayService,this.SS=SessionService,this.DS=DateService,this.dbWorkorders=WorkOrders,this.orderByField="epoch",this.reverseSort=!0,this.unitNumber=this.SS.get("unitNumber")?this.SS.get("unitNumber"):null,this.techName=null,this.type=null,this.pm=!1,this.pmNa=!0,this.leaseName=null,this.customerName=null,this.billable=null,this.billed=null,this.billParts=null,this.unapproved=!1,this.approved=!1,this.synced=!1,this.limit=50,this.skip=0,this.open=!1,this.pad=this.TDS.pad,this.searchSupervisor=null,this.role="admin",this.dates={from:null,to:null,fromInput:null,toInput:null}}setSave(wo){wo.timeStarted&&(wo.timeStarted=this.DS.saveToOrion(new Date(wo.timeStarted)))}setDisplay(wo){wo.timeStarted&&(wo.timeStarted=this.DS.displayLocal(new Date(wo.timeStarted)))}$onInit(){this.role=this.$cookies.get("role"),this.SS.get("unitNumber")||("admin"===this.role&&(this.approved=!0,this.reverseSort=!0),"manager"===this.role&&(this.unapproved=!0,this.reverseSort=!1)),this.submit()}clicked(){this.role=this.$cookies.get("role"),"admin"===this.role&&(this.approved=!0,this.unapproved=!0,this.synced=!0,this.reverseSort=!0,this.open=!this.open)}changeTextField(changedData,selected){this.onTextFieldChange({changedData,selected})}changeCheckBox(changedData,selected){this.onCheckBoxChange({changedData,selected})}startOfDay(input){this.dates.fromInput=input,"object"==typeof input&&null!==input&&(this.dates.from=new Date(new Date(input).setHours(0,0,0,0))),null===input&&(this.dates.from=null)}endOfDay(input){this.dates.toInput=input,"object"==typeof input&&null!==input&&(this.dates.to=new Date(new Date(input).setHours(23,59,59,999))),null===input&&(this.dates.to=null)}canSyncWO(wo){wo.billingInfo.billableToCustomer&&(wo.canSync=!1),wo.timeStarted.getMonth()===(new Date).getMonth()&&(wo.canSync=!1)}syncWO(wo){return new Promise((resolve,reject)=>{this.dbWorkorders.update({},wo,res=>{this.setDisplay(wo),resolve(wo)},err=>(console.log(err),reject(err)))})}SyncAllSearched(){this.modal.open({templateUrl:"/lib/public/angular/apps/workorder/views/modals/submitAllWarning.html",controller:"SubmitAllModalCtrl"}).result.then(()=>{const promises=[];this.workorders.forEach(wo=>{wo.canSync=!0,this.canSyncWO(wo)}),this.workorders.forEach(wo=>{wo.canSync&&(this.setSave(wo),wo.netsuiteSyned=!0,promises.push(this.syncWO(wo)))}),Promise.all(promises).then(res=>{console.log(res),this.$window.confirm("Success fully synced all"),this.$window.location.reload()}).catch(err=>{this.$window.confirm(err),this.$window.location.reload()})})}submit(){console.log("submit"),this.limit=50,this.skip=0;const query={limit:this.limit,skip:this.skip};this.dates.from&&this.dates.to&&(query.from=this.DS.saveToOrion(this.dates.from),query.to=this.DS.saveToOrion(this.dates.to)),(this.endTime||this.startTime)&&(query.from=this.startTime?new Date(this.startTime):this.DS.saveToOrion(this.dates.from),query.to=this.endTime?new Date(this.endTime):this.dates.to?this.DS.saveToOrion(this.dates.to):this.DS.saveToOrion(new Date)),!1===this.pmNa&&(query.pm=this.pm),this.type&&(query.type=this.type),this.unitNumber&&this.unitNumber===this.SS.get("unitNumber")?query.unit=this.unitNumber:this.unitNumber!==this.SS.get("unitNumber")?(query.unit=this.unitNumber,this.SS.drop("unitNumber")):this.SS.drop("unitNumber"),(this.techId||this.techName)&&(this.techName=this.techId?this.techId:this.techName.toUpperCase(),query.tech=this.techName),this.leaseName&&(query.loc=this.leaseName),this.searchSupervisor&&(query.searchSupervisor=this.searchSupervisor.toUpperCase()),this.customerName&&(query.cust=this.customerName),this.billed&&(query.billed=this.billed),this.billable&&(query.billable=this.billable),this.billParts&&(query.billParts=this.billParts),(this.unapproved||this.techId)&&(query.unapproved=!!this.techId||this.unapproved),(this.approved||this.techId)&&(query.approved=!!this.techId||this.approved),(this.synced||this.techId)&&(query.synced=!!this.techId||this.synced),this.woType&&(query.type=this.woType),console.log(query),this.contentSearch({query})}report(type){this.reportText="Loading...",this.reportDisabled=!0;const query={};this.dates.from&&this.dates.to&&(query.from=this.DS.saveToOrion(this.dates.from),query.to=this.DS.saveToOrion(this.dates.to)),(this.endTime||this.startTime)&&(query.from=this.startTime?new Date(this.startTime):this.dates.from,query.to=this.endTime?new Date(this.endTime):this.dates.to?this.dates.to:this.DS.saveToOrion(new Date)),!1===this.pmNa&&(query.pm=this.pm),this.type&&(query.type=this.type),this.unitNumber&&this.unitNumber===this.SS.get("unitNumber")?query.unit=this.unitNumber:this.unitNumber!==this.SS.get("unitNumber")?(query.unit=this.unitNumber,this.SS.drop("unitNumber")):this.SS.drop("unitNumber"),(this.techId||this.techName)&&(this.techName=this.techId?this.techId:this.techName.toUpperCase(),query.tech=this.techName),this.leaseName&&(query.loc=this.leaseName.toString()),this.customerName&&(query.cust=this.customerName.toString()),this.searchSupervisor&&(query.searchSupervisor=this.searchSupervisor.toUpperCase()),this.billed&&(query.billed=this.billed),this.billable&&(query.billable=this.billable),this.billParts&&(query.billParts=this.billParts),(this.unapproved||this.techId)&&(query.unapproved=!!this.techId||this.unapproved),(this.approved||this.techId)&&(query.approved=!!this.techId||this.approved),(this.synced||this.techId)&&(query.synced=!!this.techId||this.synced),this.woType&&(query.type=this.woType),"payrollDump"===type?this.payrollReport({query}):"woDump"===type?this.woDumpReport({query}):"woPartsDump"===type&&this.woPartsDumpReport({query})}resort(by){this.orderByField=by,this.reverseSort=!this.reverseSort}setBillableBackgroundColor(wo){if(wo.parts.length>0){const partBillable=wo.isPartBillable.color;if(wo.billingInfo.billableToCustomer||"#a4cf80"===partBillable)return"#a4cf80"}else if(wo.billingInfo.billableToCustomer)return"#a4cf80"}clearText(selected){switch(selected){case"unitNumber":this.unitNumber=null;break;case"leaseName":this.leaseName=null;break;case"techName":this.techName=null;break;case"customerName":this.customerName=null;break;case"searchSupervisor":this.searchSupervisor=null;break;case"type":this.type=null}}clickWorkOrder(wo){this.$window.open("#/workorder/review/"+wo._id)}}angular.module("WorkOrderApp.Components").component("woOverviewTable",{templateUrl:"/lib/public/angular/apps/workorder/views/component.views/woOverviewTable.html",bindings:{payrollReport:"&",woDumpReport:"&",woPartsDumpReport:"&",contentSearch:"&",onTextFieldChange:"&",onCheckBoxChange:"&",woSearchCount:"<",reportDisabled:"<",workorders:"<",startTime:"<",endTime:"<",woType:"<",techId:"<"},controller:["$window","$cookies","$uibModal","SessionService","TimeDisplayService","DateService","WorkOrders",WorkOrderOverviewTableCtrl]});
angular.module("PaidTimeOffApp.Controllers").controller("PaidTimeOffCtrl",["$scope","$http","$timeout","$location","$q","$cookies","AlertService","ApiRequestService","DateService",function($scope,$http,$timeout,$location,$q,$cookies,AlertService,ApiRequestService,DateService){const ARS=ApiRequestService,DS=DateService;function mapPaidTimeOffs(pto){return pto.DateFrom=DS.displayLocal(new Date(pto.DateFrom)),pto.DateTo=DS.displayLocal(new Date(pto.DateTo)),pto.epochDateFrom=pto.DateFrom.getTime(),pto.epochDateTo=pto.DateTo.getTime(),pto}$scope.loaded=!1,$scope.spinner=!0,$scope.spinnerOff=(()=>{$scope.spinner=!1}),$scope.lookup=(query=>{$scope.loaded=!1,console.log("Looking up PTOs..."),console.log(query),ARS.PaidTimeOffs(query).then(paidtimeoffs=>{console.log("PTOs Loaded."),$scope.paidtimeoffs=paidtimeoffs.map(mapPaidTimeOffs),$scope.loaded=!0,$scope.spinnerOff()}).catch(err=>console.log("Failed to load: ",err))}),$scope.PaidTimeOffScrollLookup=(query=>{console.log("Looking up Ptos..."),ARS.PaidTimeOffs(query).then(paidtimeoffs=>{console.log("Part Orders Loaded.");const pto=paidtimeoffs.map(mapPaidTimeOffs);$scope.paidtimeoffs=$scope.paidtimeoffs.concat(pto)}).catch(err=>console.log("Failed to load part orders: ",err))})}]);
angular.module("PaidTimeOffApp.Controllers").controller("PaidTimeOffReviewCtrl",["$scope","$timeout","$location","$cookies","paidtimeoff","PaidTimeOffs","AlertService","DateService",function($scope,$timeout,$location,$cookies,paidtimeoff,PaidTimeOffs,AlertService,DateService){const DS=DateService;$scope.paidtimeoff=paidtimeoff;const preLoad=()=>{$scope.paidtimeoff.DateFrom=DS.displayLocal(new Date($scope.paidtimeoff.DateFrom)),$scope.paidtimeoff.DateTo=DS.displayLocal(new Date($scope.paidtimeoff.DateTo)),$scope.paidtimeoff.ptoDays.forEach(day=>{day.dateOf=DS.displayLocal(new Date(day.dateOf))}),$scope.paidtimeoff.timeReviewed&&($scope.paidtimeoff.timeReviewed=DS.displayLocal(new Date($scope.paidtimeoff.timeReviewed)))};preLoad();const preSave=()=>{$scope.paidtimeoff.DateFrom=DS.saveToOrion(new Date($scope.paidtimeoff.DateFrom)).toISOString(),$scope.paidtimeoff.DateTo=DS.saveToOrion(new Date($scope.paidtimeoff.DateTo)).toISOString(),$scope.paidtimeoff.ptoDays.forEach(day=>{day.dateOf=DS.saveToOrion(new Date(day.dateOf)).toISOString()}),$scope.paidtimeoff.timeReviewed&&($scope.paidtimeoff.timeReviewed=DS.saveToOrion(new Date($scope.paidtimeoff.timeReviewed)).toISOString())};$scope.approvalStatusChange=(selected=>{$timeout(()=>{"approved"===selected&&($scope.paidtimeoff.status="Approved"),"rejected"===selected&&($scope.paidtimeoff.status="Rejected")})}),$scope.changeManagerComment=((changedData,selected)=>{$scope.paidtimeoff.managerComment=changedData}),$scope.update=(doc=>{PaidTimeOffs.update({id:doc._id},doc,res=>{AlertService.add("success","Update was successful."),$location.url("/paidtimeoff")},err=>{console.log(err),preLoad(),AlertService.add("danger","An error occurred while attempting to update this PTO.")})}),$scope.setAdminChanges=(()=>{"Pending"!==$scope.paidtimeoff.status&&""===$scope.paidtimeoff.reviewedBy&&($scope.paidtimeoff.reviewedBy=$cookies.get("tech"),$scope.paidtimeoff.timeReviewed=new Date),preSave(),$scope.update($scope.paidtimeoff)}),$scope.setManagerReviewed=(()=>{$scope.paidtimeoff.reviewedBy=$cookies.get("tech"),$scope.paidtimeoff.timeReviewed=new Date,preSave(),$scope.update($scope.paidtimeoff)})}]);
angular.module("WorkOrderApp.Services").factory("CommonWOfunctions",["ObjectService",function(ObjectService){var CommonWOFunctions={addComponentNameToParts:function(wo,parts){return wo.hasOwnProperty("parts")&&0!==wo.parts.length&&wo.parts.map(function(part){var netsuiteId=+part.netsuiteId;_.forEach(parts,function(obj){obj.netsuiteId===netsuiteId&&(part.componentName=obj.componentName?obj.componentName:"")})}),wo},clearNoneEngineFrame:function(wo,woInputs){return woInputs.forEach(input=>{let found=!1;input.engines.forEach(engine=>{engine.netsuiteId===wo.unitReadings.engineModel&&(found=!0)}),input.compressors.forEach(frame=>{frame.netsuiteId===wo.unitReadings.compressorModel&&(found=!0)}),found||ObjectService.setObjValue(wo,input.path,"")}),wo},defaultWO:function(){return{netsuiteId:"",netsuiteSyned:!1,truckId:"",truckNSID:"",unitNumber:"",unitSnapShot:null,technician:null,techId:"",newEngineSerial:"",newCompressorSerial:"",managerApproved:!1,approvedBy:"",syncedBy:"",timePosted:new Date,timeStarted:null,timeSubmitted:null,timeApproved:null,timeSynced:null,pm:!1,pm2:!1,pm3:!1,pm4:!1,pm5:!1,type:"",atShop:!1,header:{unitNumber:"",unitNumberNSID:"",customerName:"",contactName:"",county:"",state:"",leaseName:"",rideAlong:"",startMileage:null,endMileage:null,applicationtype:""},unitChangeInfo:{releaseDestination:"",transferLease:"",transferCounty:"",transferState:"",swapUnitNSID:"",swapUnitNumber:"",swapDestination:""},unitOwnership:{isRental:!1,isCustomerUnit:!1},billingInfo:{billableToCustomer:!1,billed:!1,warrantyWork:!1,AFENumber:"",AFE:!1},misc:{leaseNotes:"",unitNotes:"",typeOfAsset:"",isUnitRunningOnDeparture:!1},geo:{type:"Point",coordinates:[0,0]},unitReadings:{displayEngineModel:"",displayFrameModel:"",engineModel:"",engineSerial:"",engBattery:null,engOilTemp:null,engOilTempKill:null,engineJWTemp:null,engineJWTempKill:null,engineOilPressure:null,engOilPressureKill:null,alternatorOutput:null,hourReading:null,engAirInletTemp:null,engAirInletTempKill:null,engJWPress:null,engJWPressKill:null,engTurboExhTempR:null,engTurboExhTempRKill:null,engTurboExhTempL:null,engTurboExhTempLKill:null,rpm:null,engIgnitionTiming:null,engVacuumBoostR:null,engVacuumBoostRKill:null,engVacuumBoostL:null,engVacuumBoostLKill:null,engManifoldTempR:null,engManifoldTempRKill:null,engManifoldTempL:null,engManifoldTempLKill:null,engineManifoldVac:null,compressorModel:"",compressorSerial:"",suctionPressure:null,compInterPress1:null,compInterPress1Low:null,compInterPress1High:null,compInterPress2:null,compInterPress2Low:null,compInterPress2High:null,compInterPress3:null,compInterPress3Low:null,compInterPress3High:null,dischargePressure:null,dischargeTemp1:null,dischargeTemp2:null,dischargeStg1Temp:null,dischargeStg1TempKill:null,dischargeStg3Temp:null,dischargeStg3TempKill:null,dischargeStg4Temp:null,dischargeStg4TempKill:null,compressorOilPressure:null,compOilPressKill:null,compOilTemp:null,compOilTempKill:null,compDiffPCFilter:null,compDiffPCFilterKill:null,flowMCF:null},emissionsReadings:{afrmvTarget:null,catalystTempPre:null,catalystTempPreCatKill:null,catalystTempPost:null,catalystTempPostCatKill:null,afrMake:"",afrModel:"",afrSN:"",EICSCPUSoftware:"",EICSDisplaySoftware:"",catalystHousingMake:"",catalystHousingModel:"",catalystHousingSN:"",catalystElementMake:"",catalystElementSN1:"",catalystElementSN2:"",o2Sensors:"",NOxSensor:"",testPInchesH2O:""},pmChecklist:{killSettings:{highSuctionKill:null,highDischargeKill:null,lowSuctionKill:null,lowDischargeKill:null,highDischargeTempKill:null},taskList:[],engineChecks:{battery:!1,capAndRotor:!1,airFilter:!1,oilAndFilters:!1,magPickup:!1,belts:!1,guardsAndBrackets:!1,sparkPlugs:!1,plugWires:!1,driveLine:!1,batteryNa:!1,capAndRotorNa:!1,airFilterNa:!1,oilAndFiltersNa:!1,magPickupNa:!1,beltsNa:!1,guardsAndBracketsNa:!1,sparkPlugsNa:!1,plugWiresNa:!1,driveLineNa:!1},generalChecks:{kills:!1,airHoses:!1,coolerForCracks:!1,coolerLouverMovement:!1,coolerLouverCleaned:!1,pressureReliefValve:!1,scrubberDump:!1,plugInSkid:!1,filledDayTank:!1,fanForCracking:!1,panelWires:!1,oilPumpBelt:!1,killsNa:!1,airHosesNa:!1,coolerForCracksNa:!1,coolerLouverMovementNa:!1,coolerLouverCleanedNa:!1,pressureReliefValveNa:!1,scrubberDumpNa:!1,plugInSkidNa:!1,filledDayTankNa:!1,fanForCrackingNa:!1,panelWiresNa:!1,oilPumpBeltNa:!1},fuelPressureFirstCut:null,fuelPressureSecondCut:null,fuelPressureThirdCut:null,visibleLeaksNotes:"",engineCompression:{cylinder1:null,cylinder2:null,cylinder3:null,cylinder4:null,cylinder5:null,cylinder6:null,cylinder7:null,cylinder8:null,cylinder9:null,cylinder10:null,cylinder11:null,cylinder12:null,cylinder13:null,cylinder14:null,cylinder15:null,cylinder16:null}},comments:{repairsDescription:"",repairsReason:"",calloutReason:"",swapReason:"",transferReason:"",newsetNotes:"",releaseNotes:"",indirectNotes:"",timeAdjustmentNotes:""},laborCodes:{basic:{safety:{hours:0,minutes:0,text:"Safety"},positiveAdj:{hours:0,minutes:0,text:"Positive Time Adjustment"},negativeAdj:{hours:0,minutes:0,text:"Negative Time Adjustment"},lunch:{hours:0,minutes:0,text:"Lunch"},custRelations:{hours:0,minutes:0,text:"Cust. Relations"},telemetry:{hours:0,minutes:0,text:"Telemetry"},environmental:{hours:0,minutes:0,text:"Environment"},diagnostic:{hours:0,minutes:0,text:"Diagnostic"},serviceTravel:{hours:0,minutes:0,text:"Service Travel"},optimizeUnit:{hours:0,minutes:0,text:"Optimize Unit"},pm:{hours:0,minutes:0,text:"PM"},washUnit:{hours:0,minutes:0,text:"Wash Unit"},inventory:{hours:0,minutes:0,text:"Inventory"},training:{hours:0,minutes:0,text:"Training"}},engine:{oilAndFilter:{hours:0,minutes:0,text:"Oil and Filter"},addOil:{hours:0,minutes:0,text:"Add Oil"},compression:{hours:0,minutes:0,text:"Compression"},replaceEngine:{hours:0,minutes:0,text:"Replace Engine"},replaceCylHead:{hours:0,minutes:0,text:"Replace Cyl Head"},coolingSystem:{hours:0,minutes:0,text:"Cooling System"},fuelSystem:{hours:0,minutes:0,text:"Fuel System"},ignition:{hours:0,minutes:0,text:"Ignition"},starter:{hours:0,minutes:0,text:"Starter"},lubrication:{hours:0,minutes:0,text:"Lubrication"},exhaust:{hours:0,minutes:0,text:"Exhaust"},alternator:{hours:0,minutes:0,text:"Alternator"},driveOrCoupling:{hours:0,minutes:0,text:"Drive or Coupling"},sealsAndGaskets:{hours:0,minutes:0,text:"Seals and Gaskets"}},emissions:{install:{hours:0,minutes:0,text:"Install"},test:{hours:0,minutes:0,text:"Test"},repair:{hours:0,minutes:0,text:"Repair"}},panel:{panel:{hours:0,minutes:0,text:"Panel"},electrical:{hours:0,minutes:0,text:"Electrical"}},compressor:{inspect:{hours:0,minutes:0,text:"Inspect"},replace:{hours:0,minutes:0,text:"Replace"},addOil:{hours:0,minutes:0,text:"Add Oil"}},cooler:{cooling:{hours:0,minutes:0,text:"Cooling"}},vessel:{dumpControl:{hours:0,minutes:0,text:"Dump Control"},reliefValve:{hours:0,minutes:0,text:"Relief Valve"},suctionValve:{hours:0,minutes:0,text:"Suction Valve"}}},parts:[],jsa:{agree:!1,location:"",customer:"",descriptionOfWork:"",emergencyEvac:"",hazardPlanning:"",techinicians:[],controlsAndPractices:{confinedSpaceEntry:!1,spillKit:!1,restrictAccess:!1,cutResistantGloves:!1,ppe:!1,reviewEmergencyActionPlan:!1,drinkWater:!1,electrician:!1,heatResistantGloves:!1,lockoutTagout:!1,depressurize:!1,chemGloves:!1,siteJobOrientation:!1,samplingMonitoring:!1,equipmentCooldown:!1,fireExtinguisher:!1},potentialHazards:{bodyPosition:!1,pinch:!1,crushOrStriking:!1,sharpEdges:!1,materialHandling:!1,environmental:!1,lifting:!1,elevatedBodyTemp:!1,h2s:!1,hotColdSurfaces:!1,laceration:!1,chemExposure:!1,fallFromElevation:!1,slickSurfaces:!1,excavation:!1,slips:!1,trips:!1,falls:!1,equipment:!1,fireExplosionPotential:!1,eletricShock:!1,confinedSpace:!1}}}}};return CommonWOFunctions}]);
angular.module("WorkOrderApp.Directives").directive("newSerialNumbers",[function(){return{restrict:"E",templateUrl:"/lib/public/angular/apps/workorder/views/newSerial.html",scope:!0}}]);
angular.module("WorkOrderApp.Directives").directive("pesCollectionMatch",function(){return{restrict:"A",require:"ngModel",link:function(scope,elem,attr,ctrl){scope.myStyle={borderWidth:"6px"};var setInvalid=function(arg){ctrl.$setValidity(arg,!1),elem.parent().hasClass("has-success")?(elem.parent().removeClass("has-success"),elem.parent().addClass("has-error")):elem.parent().addClass("has-error")},setHighlight=function(arg){ctrl.$setValidity(arg,!1),elem.parent().hasClass("has-success")&&elem.parent().removeClass("has-success"),elem.parent().hasClass("has-error")&&elem.parent().removeClass("has-error"),elem.parent().addClass("has-highlight")},setValid=function(arg){ctrl.$setValidity(arg,!0),elem.parent().hasClass("has-error")?(elem.parent().removeClass("has-error"),elem.parent().addClass("has-success")):elem.parent().addClass("has-success")};scope.$watch(attr.ngModel,_.debounce(function(viewValue){scope.$apply(function(){var unitExists,attribute=attr.ngModel;unitExists=scope.displayUnit&&"Indirect"!==scope.workorder.type?"is_unit":scope.displayUnit||"Indirect"===scope.workorder.type?"no_unit":"should_unit";if(viewValue||""===viewValue||null===viewValue||0===viewValue)return function(vv){switch(attribute){case"workorder.header.unitNumber":"is_unit"===unitExists?("Transfer"===scope.workorder.type?scope.headerUnit.number:scope.displayUnit.number).toUpperCase()===scope.workorder.header.unitNumber.toUpperCase()&&scope.workorder.header.unitNumber.toUpperCase()===scope.workorder.unitNumber.toUpperCase()&&"Swap"!==scope.workorder.type?setValid(attribute):setInvalid(attribute):"should_unit"===unitExists?setInvalid(attribute):"no_unit"===unitExists&&(vv?setInvalid(attribute):setValid(attribute));break;case"workorder.header.customerName":"is_unit"===unitExists?("Swap"===scope.workorder.type?scope.headerUnit.customerName:scope.displayUnit.customerName).toUpperCase()===scope.workorder.header.customerName.toUpperCase()?setValid(attribute):setInvalid(attribute):"should_unit"===unitExists?setInvalid(attribute):"no_unit"===unitExists&&(vv?setInvalid(attribute):setValid(attribute));break;case"workorder.header.leaseName":"is_unit"===unitExists?("Swap"===scope.workorder.type?scope.headerUnit.locationName:scope.displayUnit.locationName).toUpperCase()===scope.workorder.header.leaseName.toUpperCase()?setValid(attribute):setInvalid(attribute):"should_unit"===unitExists?setInvalid(attribute):"no_unit"===unitExists&&(vv?setInvalid(attribute):setValid(attribute));break;case"workorder.header.county":"is_unit"===unitExists?("Swap"===scope.workorder.type?null===scope.headerUnit.county||void 0===scope.headerUnit.county?"":scope.headerUnit.county.name:null===scope.displayUnit.county||void 0===scope.displayUnit.county?"":scope.displayUnit.county.name).toUpperCase()===scope.workorder.header.county.toUpperCase()?setValid(attribute):setInvalid(attribute):"should_unit"===unitExists?setInvalid(attribute):"no_unit"===unitExists&&(vv?setInvalid(attribute):setValid(attribute));break;case"workorder.header.state":"is_unit"===unitExists?("Swap"===scope.workorder.type?null===scope.headerUnit.state||void 0===scope.headerUnit.state?"":scope.headerUnit.state.name:null===scope.displayUnit.state||void 0===scope.displayUnit.state?"":scope.displayUnit.state.name).toUpperCase()===scope.workorder.header.state.toUpperCase()?setValid(attribute):setInvalid(attribute):"should_unit"===unitExists?setInvalid(attribute):"no_unit"===unitExists&&(vv?setInvalid(attribute):setValid(attribute));break;case"workorder.unitReadings.compressorSerial":"is_unit"===unitExists?(null===scope.displayUnit.compressorSerial?"":scope.displayUnit.compressorSerial)===scope.workorder.unitReadings.compressorSerial?"Swap"===scope.workorder.type?setHighlight(attribute):setValid(attribute):"Swap"===scope.workorder.type?setHighlight(attribute):setInvalid(attribute):"should_unit"===unitExists?setInvalid(attribute):"no_unit"===unitExists&&(vv?setInvalid(attribute):setValid(attribute));break;case"workorder.unitReadings.engineSerial":"is_unit"===unitExists?(null===scope.displayUnit.engineSerial?"":scope.displayUnit.engineSerial)===scope.workorder.unitReadings.engineSerial?"Swap"===scope.workorder.type?setHighlight(attribute):setValid(attribute):"Swap"===scope.workorder.type?setHighlight(attribute):setInvalid(attribute):"should_unit"===unitExists?setInvalid(attribute):"no_unit"===unitExists&&(vv?setInvalid(attribute):setValid(attribute));break;case"workorder.geo.coordinates[1]":"is_unit"===unitExists?("Swap"===scope.workorder.type?0===scope.headerUnit.geo.coordinates[1]?0:scope.headerUnit.geo.coordinates[1]:0===scope.displayUnit.geo.coordinates[1]?0:scope.displayUnit.geo.coordinates[1])===scope.workorder.geo.coordinates[1]?setValid(attribute):scope.workorder.atShop?setValid(attribute):setInvalid(attribute):"should_unit"===unitExists?setInvalid(attribute):"no_unit"===unitExists&&(vv?setInvalid(attribute):setValid(attribute));break;case"workorder.geo.coordinates[0]":"is_unit"===unitExists?("Swap"===scope.workorder.type?0===scope.headerUnit.geo.coordinates[0]?0:scope.headerUnit.geo.coordinates[0]:0===scope.displayUnit.geo.coordinates[0]?0:scope.displayUnit.geo.coordinates[0])===scope.workorder.geo.coordinates[0]?setValid(attribute):scope.workorder.atShop?setValid(attribute):setInvalid(attribute):"should_unit"===unitExists?setInvalid(attribute):"no_unit"===unitExists&&(vv?setInvalid(attribute):setValid(attribute));break;case"workorder.unitReadings.displayEngineModel":if("is_unit"===unitExists){let engineModelID="";scope.engineModels.forEach(engine=>{scope.displayUnit.engineModel&&engine._id===scope.displayUnit.engineModel._id&&(engineModelID=engine.netsuiteId)}),engineModelID===scope.workorder.unitReadings.engineModel?setValid(attribute):setInvalid(attribute)}else"should_unit"===unitExists?setInvalid(attribute):"no_unit"===unitExists&&(vv?setInvalid(attribute):setValid(attribute));break;case"workorder.unitReadings.displayFrameModel":if("is_unit"===unitExists){let frameModelID="";scope.frameModels.forEach(frame=>{scope.displayUnit.frameModel&&frame._id===scope.displayUnit.frameModel._id&&(frameModelID=frame.netsuiteId)}),frameModelID===scope.workorder.unitReadings.compressorModel?setValid(attribute):setInvalid(attribute)}else"should_unit"===unitExists?setInvalid(attribute):"no_unit"===unitExists&&(vv?setInvalid(attribute):setValid(attribute))}}(viewValue),viewValue})},300))}}}).directive("unitInput",[function(){return{restrict:"E",templateUrl:"/lib/public/angular/apps/workorder/views/unitInput.html",scope:!1}}]);
angular.module("WorkOrderApp.Directives").directive("pesSwapCollectionMatch",function(){return{restrict:"A",require:"ngModel",link:function(scope,elem,attr,ctrl){scope.myStyle={borderWidth:"6px"};var setInvalid=function(arg){ctrl.$setValidity(arg,!1),elem.parent().hasClass("has-success")?(elem.parent().removeClass("has-success"),elem.parent().addClass("has-highlight")):elem.parent().addClass("has-highlight")},setValid=function(arg){ctrl.$setValidity(arg,!0),elem.parent().hasClass("has-error")?(elem.parent().removeClass("has-error"),elem.parent().addClass("has-highlight")):elem.parent().addClass("has-highlight")};scope.$watch(attr.ngModel,_.debounce(function(viewValue){scope.$apply(function(){var unitExists,attribute=attr.ngModel;unitExists=scope.displayUnit&&"Indirect"!==scope.workorder.type?"is_unit":scope.displayUnit||"Indirect"===scope.workorder.type?"no_unit":"should_unit";if(viewValue||""===viewValue||null===viewValue||0===viewValue)return function(vv){switch(attribute){case"workorder.unitChangeInfo.transferCounty":"is_unit"===unitExists?(null===scope.displayUnit.county?"":scope.displayUnit.county.name).toUpperCase()===scope.workorder.unitChangeInfo.transferCounty.toUpperCase()?setValid(attribute):setInvalid(attribute):"should_unit"===unitExists&&setInvalid(attribute);break;case"workorder.unitChangeInfo.transferState":"is_unit"===unitExists?(null===scope.displayUnit.state?"":scope.displayUnit.state.name).toUpperCase()===scope.workorder.unitChangeInfo.transferState.toUpperCase()?setValid(attribute):setInvalid(attribute):"should_unit"===unitExists&&setInvalid(attribute);break;case"workorder.unitChangeInfo.transferLease":"is_unit"===unitExists?scope.displayUnit.locationName.toUpperCase()===scope.workorder.unitChangeInfo.transferLease.toUpperCase()?setValid(attribute):setInvalid(attribute):"should_unit"===unitExists&&setInvalid(attribute);break;case"workorder.unitChangeInfo.swapUnitNumber":"is_unit"===unitExists?scope.displayUnit.number.toUpperCase()===scope.workorder.unitChangeInfo.swapUnitNumber.toUpperCase()?setValid(attribute):setInvalid(attribute):"should_unit"===unitExists&&setInvalid(attribute)}}(),viewValue})},300))}}}).directive("unitChangeInfo",[function(){return{restrict:"E",templateUrl:"/lib/public/angular/apps/workorder/views/woChangeInfo.html",scope:!0}}]);
function WorkOrderCreateCtrlFunc($window,$q,$scope,$location,$timeout,$uibModal,$cookies,AlertService,TimeDisplayService,ApiRequestService,GeneralPartSearchService,ObjectService,CommonWOfunctions,assettypes,me,parts,states,counties,applicationtypes,DateService,locations,woInputMatrixes,frameModels,engineModels,woSOPChecks,customers,users){$scope.locations=locations,$scope.woInputMatrix=woInputMatrixes,$scope.frameModels=frameModels,$scope.engineModels=engineModels,$scope.assetTypes=assettypes,$scope.parts=parts,$scope.states=states,$scope.counties=counties,$scope.applicationTypes=applicationtypes,$scope.woSOPChecks=woSOPChecks,$scope.customers=customers,$scope.users=users,$scope.workorder=CommonWOfunctions.defaultWO()}angular.module("WorkOrderApp.Controllers").controller("WorkOrderCreateCtrl",["$window","$q","$scope","$location","$timeout","$uibModal","$cookies","AlertService","TimeDisplayService","ApiRequestService","GeneralPartSearchService","ObjectService","CommonWOfunctions","assettypes","me","parts","states","counties","applicationtypes","DateService","locations","woInputMatrixes","frameModels","engineModels","woSOPChecks","customers","users",WorkOrderCreateCtrlFunc]);
angular.module("WorkOrderApp.Controllers").controller("WorkOrderCtrl",["$window","$location","$scope","SessionService","ApiRequestService","AlertService","$http","STARTTIME","ENDTIME","WOTYPE","TECHNICIANID","DateService",function($window,$location,$scope,SessionService,ApiRequestService,AlertService,$http,STARTTIME,ENDTIME,WOTYPE,TECHNICIANID,DateService){const SS=SessionService,ARS=ApiRequestService,DS=DateService;function mapWorkorders(wo){return wo.unitNumber?wo.unitSort=Number(wo.unitNumber.replace(/\D+/g,"")):wo.unitSort=0,wo.technician?wo.techName=wo.technician.firstName+" "+wo.technician.lastName:wo.techName=wo.techId,wo.header?(wo.header.customerName||(wo.header.customerName=""),wo.customerName=wo.header.customerName,wo.locationName=wo.header.leaseName,wo.header.state?wo.stateName=wo.header.state:wo.stateName=""):(wo.stateName="",wo.customerName="",wo.locationName=""),wo.timeStarted?(wo.timeStarted=DS.displayLocal(new Date(wo.timeStarted)),wo.epoch=new Date(wo.timeStarted).getTime()):wo.epoch=0,wo.totalMinutes=60*wo.totalWoTime.hours+wo.totalWoTime.minutes,wo.header&&wo.header.leaseName&&(wo.header.leaseName<=20?wo.displayLocationName=wo.header.leaseName:wo.displayLocationName=wo.header.leaseName.slice(0,17)+"..."),wo}$scope.infiniteScroll=!1,$scope.spinner=!0,$scope.loaded=!0,$scope.WOSearchCount=0,$scope.reportDisabled=!1,$scope.STARTTIME=STARTTIME,$scope.ENDTIME=ENDTIME,$scope.WOTYPE=WOTYPE,$scope.TECHNICIANID=TECHNICIANID,$window.onhashchange=(()=>SS.drop("unitNumber")),$scope.spinnerOff=function(){$scope.spinner=!1},$scope.spinnerOn=function(){$scope.spinner=!0},$scope.lookup=(query=>{console.log("lookup"),console.log(query),$scope.infiniteScroll=!1;const queryParams=$location.search();queryParams.unit&&(obj.unit=queryParams),$scope.loaded=!1,$scope.spinnerOn(),SS.get("unitNumber")?ARS.http.get.UnitWorkOrders(query).then(res=>{$scope.workorders=res.data.map(mapWorkorders),$scope.loaded=!0,$scope.spinnerOff(),ARS.http.get.WorkOrdersNoIdentityCount(query).then(res=>{$scope.WOSearchCount=res.data,query.skip<$scope.WOSearchCount&&(query.skip+=query.limit,$scope.infiniteScroll=!0,$scope.WorkOrderScrollLookup(query))},err=>{console.log(`Counting Error: ${err}`)})},err=>{console.log(`Failure: ${err}`)}):ARS.WorkOrders(query).then(res=>{$scope.workorders=res.map(mapWorkorders),$scope.loaded=!0,$scope.spinnerOff(),ARS.http.get.WorkOrderCount(query).then(res=>{$scope.WOSearchCount=res.data,query.skip<$scope.WOSearchCount&&(query.skip+=query.limit,$scope.infiniteScroll=!0,$scope.WorkOrderScrollLookup(query))},err=>{console.log(`Counting Error: ${err}`)})},err=>{console.log(`Failure: ${err}`)})}),$scope.WorkOrderScrollLookup=(query=>{console.log("Scroll"),console.log(query),SS.get("unitNumber")?ARS.http.get.UnitWorkOrders(query).then(res=>{const wo=res.data.map(mapWorkorders);$scope.workorders=$scope.workorders.concat(wo),$scope.infiniteScroll&&(query.skip<$scope.WOSearchCount?(query.skip+=query.limit,$scope.infiniteScroll=!0,$scope.WorkOrderScrollLookup(query)):$scope.workorders.length===$scope.WOSearchCount&&($scope.infiniteScroll=!1))},err=>{console.log(`Failure: ${err}`)}):ARS.WorkOrders(query).then(res=>{const wo=res.map(mapWorkorders);$scope.workorders=$scope.workorders.concat(wo),$scope.infiniteScroll&&(query.skip<$scope.WOSearchCount?(query.skip+=query.limit,$scope.infiniteScroll=!0,$scope.WorkOrderScrollLookup(query)):$scope.workorders.length===$scope.WOSearchCount&&($scope.infiniteScroll=!1))},err=>{console.log(`Failure: ${err}`)})}),$scope.$on("$destroy",function(){$scope.infiniteScroll=!1}),$scope.payrollDumpReport=(query=>{$http({method:"GET",url:"/api/WorkOrderPayrollDump",params:query}).then(res=>{angular.element("<a/>").attr({href:"data:attachment/tsv;charset=utf-8,"+encodeURI(res.data),target:"_blank",download:"payrollDump.tsv"})[0].click(),$scope.reportDisabled=!1},err=>{AlertService.add("danger","Work Order Report failed",2e3),console.log(err),$scope.reportDisabled=!1})}),$scope.woDumpReport=(query=>{$http({method:"GET",url:"/api/WorkOrderDump",params:query}).then(res=>{angular.element("<a/>").attr({href:"data:attachment/tsv;charset=utf-8,"+encodeURI(res.data),target:"_blank",download:"woDump.tsv"})[0].click(),$scope.reportDisabled=!1},err=>{AlertService.add("danger","Work Order Report failed",2e3),console.log(err),$scope.reportDisabled=!1})}),$scope.woPartsDumpReport=(query=>{$http({method:"GET",url:"/api/WorkorderPartDump",params:query}).then(res=>{angular.element("<a/>").attr({href:"data:attachment/tsv;charset=utf-8,"+encodeURI(res.data),target:"_blank",download:"woPartsDump.tsv"})[0].click(),$scope.reportDisabled=!1},err=>{AlertService.add("danger","Work Order Parts Report failed",2e3),console.log(err),$scope.reportDisabled=!1})})}]);
function WorkOrderEditCtrlFunc($window,$q,$scope,$location,$timeout,$uibModal,$cookies,AlertService,TimeDisplayService,ApiRequestService,GeneralPartSearchService,ObjectService,CommonWOfunctions,WorkOrders,ReviewNotes,EditHistories,Units,Users,Customers,workorder,reviewNotes,editHistories,assettypes,me,parts,states,applicationtypes,DateService,locations,woInputMatrixes,frameModels,engineModels){const setDisplay=wo=>{wo.timeStarted&&(wo.timeStarted=DS.displayLocal(new Date(wo.timeStarted))),wo.timeSubmitted&&(wo.timeSubmitted=DS.displayLocal(new Date(wo.timeSubmitted))),wo.timeApproved&&(wo.timeApproved=DS.displayLocal(new Date(wo.timeApproved))),wo.timeSynced&&(wo.timeSynced=DS.displayLocal(new Date(wo.timeSynced)))},setDisplayUnit=number=>{$scope.workorder.unitSnapShot&&$scope.workorder.unitSnapShot.hasOwnProperty("number")?$timeout(()=>{$scope.displayUnit=$scope.workorder.unitSnapShot,$scope.headerUnit=$scope.workorder.unitSnapShot}):ARS.Units({regexN:number}).then(units=>{for(let unit in units)if(units.hasOwnProperty(unit)&&units[unit].hasOwnProperty("productSeries")){const thisUnit=units[unit];$timeout(()=>{$scope.displayUnit=thisUnit})}ARS.Units({regexN:$scope.workorder.header.unitNumber}).then(units=>{for(let unit in units)units.hasOwnProperty(unit)&&units[unit].hasOwnProperty("productSeries")&&($scope.headerUnit=units[unit])}).catch(err=>console.log(err))}).catch(err=>console.log(err))},ARS=ApiRequestService,DS=DateService;$scope.me=me,$scope.yards=locations.filter(loc=>-1===loc.name.indexOf(":")),$scope.parts=parts,$scope.woInputMatrixes=woInputMatrixes,$scope.engineModels=engineModels,$scope.frameModels=frameModels,$scope.assettypes=assettypes,$scope.states=states,$scope.applicationtypes=applicationtypes,$scope.workorder=workorder,$scope.reviewNotes=reviewNotes,$scope.editHistories=editHistories,$scope.unitNumberArray=[],$scope.disabled=!1,$scope.hours=function getHours(){const hours=[];for(let i=0;i<=24;i++)hours.push(i);return hours}(),$scope.minutes=function getMinutes(){const minutes=[];for(let i=0;i<60;i+=5)minutes.push(i);return minutes}(),$scope.pad=TimeDisplayService.pad,$scope.customersArray=[],$scope.countiesArray=[],$scope.statesArray=[],$scope.userRideAlongArray=[],$scope.SyncedToNetsuite=$scope.workorder.timeSynced||$scope.workorder.updated_at,$scope.tripleInputStyling={display:"inline-block",width:"32%"},$scope.inputStyling={display:"inline-block",width:"49%"},_.map($scope.states,obj=>{$scope.statesArray.push(obj.name)}),$scope.getAssetTypeNSID=(name=>{let returnId="";return _.forEach($scope.assettypes,doc=>{name===doc.type&&(returnId=doc.netsuiteId)}),returnId}),setDisplay($scope.workorder),$scope.workorder.unitNumber&&setDisplayUnit($scope.workorder.unitNumber);const getAssetTypeNSID=ps=>{let NSID=null;return $scope.assettypes.forEach(asset=>{asset.type===ps&&(NSID=asset.netsuiteId)}),NSID};if($scope.workorder=CommonWOfunctions.addComponentNameToParts($scope.workorder,$scope.parts),$scope.swapUnitNumberChange=(changedData=>{$scope.workorder.unitSnapShot&&($scope.workorder.unitSnapShot=null,$scope.workorder.assetType=null),ARS.Units({regexN:changedData}).then(units=>{$scope.unitNumberArray=units;for(let unit in units)if(units.hasOwnProperty(unit)&&units[unit].number===changedData){const header=$scope.workorder.header;$scope.workorder.header=null;const thisUnit=units[unit];let engineObj,frameObj;thisUnit.engineModel&&$scope.engineModels.forEach(engine=>{engine._id===thisUnit.engineModel&&(engineObj=engine)}),thisUnit.frameModel&&$scope.frameModels.forEach(frame=>{frame._id===thisUnit.frameModel&&(frameObj=frame)}),$timeout(()=>{$scope.workorder.header=header,$scope.workorder.unitNumber=thisUnit.number,$scope.workorder.assetType=getAssetTypeNSID(thisUnit.productSeries),$scope.displayUnit=thisUnit,$scope.workorder.unitReadings.engineSerial=thisUnit.engineSerial,$scope.workorder.unitReadings.compressorSerial=thisUnit.compressorSerial,$scope.workorder.unitSnapShot=thisUnit,$scope.workorder.unitChangeInfo.swapUnitNumber=thisUnit.number,$scope.workorder.unitChangeInfo.swapUnitNSID=thisUnit.netsuiteId,$scope.workorder.unitReadings.displayEngineModel=void 0!==engineObj?engineObj.model:"",$scope.workorder.unitReadings.displayFrameModel=void 0!==frameObj?frameObj.model:"",$scope.workorder.unitReadings.engineModel=void 0!==engineObj?engineObj.netsuiteId:"",$scope.workorder.unitReadings.compressorModel=void 0!==frameObj?frameObj.netsuiteId:""}),$timeout(()=>console.log(getAssetTypeNSID(thisUnit.productSeries)),1e3)}}).catch(console.error)}),$scope.countyNameChange=(changedData=>{ARS.Counties({regexN:changedData,limit:12}).then(counties=>{$scope.countiesArray=counties}).catch(err=>console.error(err))}),$scope.unitEngineModelChange=(changedData=>{$scope.workorder.unitReadings.displayEngineModel=changedData}),$scope.$watch("workorder.unitReadings.displayEngineModel",(newModel,oldModel)=>{newModel!==oldModel&&$scope.engineModels.forEach(engine=>{engine.model===newModel&&$timeout(()=>{$scope.workorder.unitReadings.engineModel=engine.netsuiteId})})},!0),$scope.unitFrameModelChange=(changedData=>{$scope.workorder.unitReadings.displayFrameModel=changedData}),$scope.$watch("workorder.unitReadings.displayFrameModel",(newModel,oldModel)=>{newModel!==oldModel&&$scope.frameModels.forEach(frame=>{frame.model===newModel&&$timeout(()=>{$scope.workorder.unitReadings.compressorModel=frame.netsuiteId})})},!0),$scope.unitNumberChange=(changedData=>{$scope.workorder.unitSnapShot&&($scope.workorder.unitSnapShot=null,$scope.workorder.assetType=null),ARS.Units({regexN:changedData}).then(units=>{$scope.unitNumberArray=units;for(let unit in units)if(units.hasOwnProperty(unit))if(units[unit].number===changedData&&"string"==typeof units[unit].number){const thisUnit=units[unit];let engineObj,frameObj;thisUnit.engineModel&&$scope.engineModels.forEach(engine=>{engine._id===thisUnit.engineModel&&(engineObj=engine)}),thisUnit.frameModel&&$scope.frameModels.forEach(frame=>{frame._id===thisUnit.frameModel&&(frameObj=frame)});for(let u in $scope.workorder.header)$scope.workorder.header.hasOwnProperty(u)&&("state"!==u&&"county"!==u&&"leaseName"!==u&&"unitNumber"!==u&&"customerName"!==u||($scope.workorder.header[u]=""));$scope.workorder.unitReadings.engineModel="",$scope.workorder.unitReadings.compressorModel="",$scope.workorder.unitReadings.displayEngineModel="",$scope.workorder.unitReadings.displayFrameModel="",$scope.workorder.geo.coordinates[0]=0,$scope.workorder.geo.coordinates[1]=0,$timeout(()=>{$scope.workorder.header.state=null===thisUnit.state?"":thisUnit.state.name,$scope.workorder.header.county=null===thisUnit.county?"":thisUnit.county.name,$scope.workorder.header.leaseName=thisUnit.locationName,$scope.workorder.header.customerName=thisUnit.customerName,$scope.workorder.header.unitNumber=thisUnit.number,$scope.workorder.geo=thisUnit.geo,$scope.workorder.unitReadings.engineSerial=thisUnit.engineSerial,$scope.workorder.unitReadings.compressorSerial=thisUnit.compressorSerial,$scope.workorder.assetType=getAssetTypeNSID(thisUnit.productSeries),$scope.workorder.geo.coordinates[0]=thisUnit.geo.coordinates[0],$scope.workorder.geo.coordinates[1]=thisUnit.geo.coordinates[1],$scope.displayUnit=thisUnit,$scope.workorder.jsa.customer=thisUnit.customerName,$scope.workorder.jsa.location=thisUnit.locationName,$scope.workorder.unit=thisUnit._id,$scope.workorder.unitReadings.displayEngineModel=void 0!==engineObj?engineObj.model:"",$scope.workorder.unitReadings.displayFrameModel=void 0!==frameObj?frameObj.model:"",$scope.workorder.unitReadings.engineModel=void 0!==engineObj?engineObj.netsuiteId:"",$scope.workorder.unitReadings.compressorModel=void 0!==frameObj?frameObj.netsuiteId:""})}else void 0!==units[unit].number&&($scope.workorder.jsa.customer="",$scope.workorder.jsa.location="")}).catch(err=>console.log(err)),$scope.workorder.unitNumber=$scope.workorder.header.unitNumber}),$scope.customerChange=(changedData=>{ARS.Customers({regexName:changedData}).then(customers=>{$scope.customersArray=customers}).catch(err=>console.log(err))}),$scope.leaseChange=(changedData=>{ARS.Units({regexL:changedData}).then(units=>{$scope.unitLocationArray=units}).catch(err=>console.log(err))}),$scope.changeThisSelectList=((changedData,selected)=>{ObjectService.updateNestedObjectValue($scope.workorder,changedData,selected)}),$scope.changeThisTypeahead=((changedData,selected)=>{if("header.rideAlong"===selected){const name=changedData.toUpperCase();ARS.Users({regexName:name}).then(users=>{const userArray=[];if(users.length>0){for(let user in users)users.hasOwnProperty(user)&&users[user].hasOwnProperty("firstName")&&userArray.push(users[user].firstName.concat(" ").concat(users[user].lastName));$scope.userRideAlongArray=userArray}}).catch(err=>console.log(err))}ObjectService.updateNestedObjectValue($scope.workorder,changedData,selected)}),$scope.changeThisCheckbox=((changedData,selected)=>{ObjectService.updateNestedObjectValue($scope.workorder,changedData,selected)}),$scope.changeThisTextField=((changedData,selected)=>{ObjectService.updateNestedObjectValue($scope.workorder,changedData,selected)}),$scope.changeThisTextAreaField=((changedData,selected)=>{ObjectService.updateNestedObjectValue($scope.workorder,changedData,selected)}),$scope.changeThisTimeField=((changedData,selected)=>{$scope.getTimeElapsed(),$scope.getTotalLaborTime(),$scope.getUnaccountedTime(),ObjectService.updateNestedObjectValue($scope.workorder,changedData,selected)}),$scope.$watch("workorder.laborCodes.basic",()=>{$scope.workorder.laborCodes.basic.positiveAdj.hours>0||$scope.workorder.laborCodes.basic.negativeAdj.hours>0||$scope.workorder.laborCodes.basic.positiveAdj.minutes>0||$scope.workorder.laborCodes.basic.negativeAdj.minutes>0?$scope.timeAdjustment=!0:$scope.timeAdjustment=!1},!0),$scope.$watch("workorder.laborCodes.engine.replaceEngine",()=>{0===$scope.workorder.laborCodes.engine.replaceEngine.hours&&0===$scope.workorder.laborCodes.engine.replaceEngine.minutes&&($scope.workorder.newEngineSerial="")},!0),$scope.$watch("workorder.laborCodes.compressor.replace",()=>{0===$scope.workorder.laborCodes.compressor.replace.hours&&0===$scope.workorder.laborCodes.compressor.replace.minutes&&($scope.workorder.newCompressorSerial="")},!0),$scope.type=[{text:"Corrective",value:!1},{text:"Trouble Call",value:!1},{text:"New Set",value:!1},{text:"Transfer",value:!1},{text:"Swap",value:!1},{text:"Release",value:!1},{text:"Indirect",value:!1}],$scope.getTypeObj=(str=>{let value=!1;return $scope.type.forEach(obj=>{obj.text===str&&(value=obj)}),value}),$scope.setType=(type=>{$timeout(()=>{$scope.workorder.type=type})}),$scope.setPM=((type,value)=>{$scope.workorder.pm=!1,$scope.workorder.pm2=!1,$scope.workorder.pm3=!1,$scope.workorder.pm4=!1,$scope.workorder.pm5=!1,$timeout(()=>{$scope.workorder[type.toLowerCase()]=value})}),$scope.doItAll=((type,value)=>{$timeout(()=>{$scope.workorder.type=type,$scope.type=[...$scope.type.map(obj=>(obj.value=!1,obj))],$scope.workorder.pm=!1,$scope.workorder.pm2=!1,$scope.workorder.pm3=!1,$scope.workorder.pm4=!1,$scope.workorder.pm5=!1,$scope.workorder[type.toLowerCase()]=value})}),$scope.setTypeObj=((text,value)=>{$timeout(()=>{$scope.type=[...$scope.type.map(obj=>(obj.text===text&&(obj.value=value),obj))]})}),$scope.wipeTypeObj=(()=>{$timeout(()=>{$scope.type=[...$scope.type.map(obj=>(obj.value=!1,obj))]})}),$scope.runHeaderValidation=(()=>{const header=$scope.workorder.header;$scope.workorder.header=null,"Swap"!==$scope.workorder.type&&(setDisplayUnit(header.unitNumber),$scope.workorder.comments.swapReason="",$scope.workorder.unitChangeInfo.swapUnitNSID="",$scope.workorder.unitChangeInfo.swapUnitNumber="",$scope.workorder.unitChangeInfo.swapDestination=""),"Transfer"!==$scope.workorder.type&&($scope.workorder.unitChangeInfo.transferLease="",$scope.workorder.unitChangeInfo.transferCounty="",$scope.workorder.unitChangeInfo.transferState="",$scope.workorder.comments.transferReason=""),"Release"!==$scope.workorder.type&&($scope.workorder.unitChangeInfo.releaseDestination=""),$timeout(()=>{$scope.workorder.header=header})}),$scope.pmChange=((val,type)=>{$scope.typeChange({text:type,value:val})}),$scope.typeChange=(obj=>{const type=$scope.workorder.type;"PM"===obj.text||"PM2"===obj.text||"PM3"===obj.text||"PM4"===obj.text||"PM5"===obj.text?"New Set"===type||"Release"===type||"Indirect"===type?$scope.doItAll(obj.text,obj.value):"Corrective"!==type&&"Trouble Call"!==type&&"Transfer"!==type&&"Swap"!==type||obj.value?obj.text!==type?("Corrective"!==type&&"Trouble Call"!==type&&"Transfer"!==type&&"Swap"!==type&&$scope.setType(obj.text),$scope.setPM(obj.text,obj.value)):"Corrective"===type||"Trouble Call"===type||"Transfer"===type||"Swap"===type||obj.value||$scope.setPM(obj.text,!obj.value):$timeout(()=>{$scope.workorder.pm=!1,$scope.workorder.pm2=!1,$scope.workorder.pm3=!1,$scope.workorder.pm4=!1,$scope.workorder.pm5=!1}):($scope.wipeTypeObj(),"New Set"===obj.text||"Release"===obj.text||"Indirect"===obj.text?(obj.text!==$scope.workorder.type?($scope.setType(obj.text),$scope.setTypeObj(obj.text,obj.value)):($scope.setType(obj.text),$scope.setTypeObj(obj.text,!obj.value)),$scope.workorder.pm=!1,$scope.workorder.pm2=!1,$scope.workorder.pm3=!1,$scope.workorder.pm4=!1,$scope.workorder.pm5=!1):"Corrective"!==obj.text&&"Trouble Call"!==obj.text&&"Transfer"!==obj.text&&"Swap"!==obj.text||($scope.workorder.pm||$scope.workorder.pm2||$scope.workorder.pm3||$scope.workorder.pm4||$scope.workorder.pm5?"PM"===type||"PM2"===type||"PM3"===type||"PM4"===type||"PM5"===type||obj.value?($scope.workorder.type=obj.text,$scope.setTypeObj(obj.text,obj.value)):($scope.workorder.type=$scope.workorder.pm?"PM":$scope.workorder.pm2?"PM2":$scope.workorder.pm3?"PM3":$scope.workorder.pm4?"PM4":$scope.workorder.pm5?"PM5":obj.text,$scope.setTypeObj(obj.text,obj.value)):obj.text!==$scope.workorder.type?($scope.setType(obj.text),$scope.setTypeObj(obj.text,obj.value)):($scope.setType(obj.text),$scope.setTypeObj(obj.text,!obj.value)))),console.log($scope.workorder),$scope.runHeaderValidation()}),$scope.workorder.pm)"Corrective"===$scope.workorder.type?$scope.type[0].value=!0:"Trouble Call"===$scope.workorder.type?$scope.type[1].value=!0:"Transfer"===$scope.workorder.type?$scope.type[3].value=!0:"Swap"===$scope.workorder.type&&($scope.type[4].value=!0);else switch($scope.workorder.type){case"Corrective":$scope.type[0].value=!0;break;case"Trouble Call":$scope.type[1].value=!0;break;case"New Set":$scope.type[2].value=!0;break;case"Transfer":$scope.type[3].value=!0;break;case"Swap":$scope.type[4].value=!0;break;case"Release":$scope.type[5].value=!0;break;case"Indirect":$scope.type[6].value=!0;break;default:console.log($scope.workorder.type)}function ClassSubmission(){return{type:"",firstname:"",lastname:"",submissionTime:Date}}$scope.isFound=(input=>{let show;const frameModel=$scope.workorder.unitReadings.compressorModel;frameModel&&$scope.woInputMatrixes.forEach(matrix=>{matrix.name===input&&matrix.compressors.forEach(frame=>{frame.netsuiteId===frameModel&&(show=!0)})});const engineModel=$scope.workorder.unitReadings.engineModel;return engineModel&&$scope.woInputMatrixes.forEach(matrix=>{matrix.name===input&&matrix.engines.forEach(engine=>{engine.netsuiteId===engineModel&&(show=!0)})}),engineModel||frameModel||(show=!1),show}),$scope.comment=function ClassNote(){return{note:"",workOrder:$scope.workorder._id}}(),$scope.sendingNote=!1,$scope.newNote=(()=>{$scope.comment.note&&($scope.sendingNote=!0,console.log("Saving new note..."),ReviewNotes.save({},$scope.comment,response=>{$scope.sendingNote=!1,console.log(response),console.log("Successful save."),ARS.ReviewNotes({workOrder:response.workOrder}).then(newNotes=>{$scope.reviewNotes=newNotes}).catch(err=>console.log(err)),$scope.comment.note=null},err=>{$scope.sendingNote=!1,console.log(err),console.log("Error Saving Note."),$scope.comment.note=null}))}),$scope.displaySubmissions=[],$scope.workorder.timeSubmitted&&ARS.getUser({id:$scope.workorder.techId}).then(user=>{let thisUser=user;const techSubmission=ClassSubmission();techSubmission.type="Submission",void 0!==thisUser?(techSubmission.firstname=thisUser.firstName,techSubmission.lastname=thisUser.lastName):techSubmission.firstname=$scope.workorder.techId,techSubmission.submissionTime=$scope.workorder.timeSubmitted,$scope.displaySubmissions.push(techSubmission),$scope.workorder.timeApproved&&ARS.getUser({id:$scope.workorder.approvedBy}).then(manager=>{thisUser=manager;const managerSubmission=ClassSubmission();managerSubmission.type="Reviewed",managerSubmission.firstname=thisUser.firstName,managerSubmission.lastname=thisUser.lastName,managerSubmission.submissionTime=$scope.workorder.timeApproved,$scope.displaySubmissions.push(managerSubmission)}).catch(err=>console.log(err)),$scope.workorder.timeSynced&&ARS.getUser({id:$scope.workorder.syncedBy}).then(admin=>{thisUser=admin;const adminSubmission=ClassSubmission();adminSubmission.type="Synced",adminSubmission.firstname=thisUser.firstName,adminSubmission.lastname=thisUser.lastName,adminSubmission.submissionTime=$scope.workorder.timeSynced,$scope.displaySubmissions.push(adminSubmission)}).catch(err=>console.log(err))}).catch(err=>console.log(err)),$scope.displayChanges=[],_.map($scope.editHistories,edit=>{if($scope.workorder._id===edit.workOrder){const thisEdit={panelName:"",itemName:"",type:"",before:"",after:""};thisEdit.panelName=edit.path[0],thisEdit.itemName=edit.path.pop(),thisEdit.type=edit.editType,thisEdit.before=edit.before,thisEdit.after=edit.after,$scope.displayChanges.push(thisEdit)}}),0!==$scope.editHistories.length&&(ARS.getUser({id:$scope.editHistories.pop().user}).then(admin=>{$scope.editor=admin}).catch(err=>{console.log("Editor retrieval error"),console.log(err)}),$scope.editCount=$scope.editHistories.length+1),$scope.highMileageConfirm=!1,$scope.save=(()=>{$scope.submitting=!0,$scope.allowSubmit=!0,+$scope.workorder.header.startMileage>+$scope.workorder.header.endMileage&&($scope.openErrorModal("woMileageError.html"),$scope.allowSubmit=!1),($scope.unaccountedH<0||$scope.unaccountedM<-15||$scope.unaccountedH>0||$scope.unaccountedM>15)&&!1===$scope.timeAdjustment&&($scope.openErrorModal("woUnaccoutedTimeError.html"),$scope.allowSubmit=!1),+$scope.workorder.header.endMileage-+$scope.workorder.header.startMileage>75&&!$scope.highMileageConfirm&&($scope.openConfirmationModal("woHighMileageConfirmation.html"),$scope.allowSubmit=!1),($scope.workorder.unitReadings.compressorModel||$scope.workorder.unitReadings.engineModel)&&($scope.workorder=CommonWOfunctions.clearNoneEngineFrame($scope.workorder,$scope.woInputMatrixes)),$scope.allowSubmit&&"admin"===$cookies.get("role")&&((wo=>{wo.timeStarted&&(wo.timeStarted=DS.saveToOrion(new Date(wo.timeStarted))),wo.timeSubmitted&&(wo.timeSubmitted=DS.saveToOrion(new Date(wo.timeSubmitted))),wo.timeApproved&&(wo.timeApproved=DS.saveToOrion(new Date(wo.timeApproved))),wo.timeSynced&&(wo.timeSynced=DS.saveToOrion(new Date(wo.timeSynced)))})($scope.workorder),WorkOrders.update({id:$scope.workorder._id},$scope.workorder,res=>{AlertService.add("success","Update was successful!"),$scope.submitting=!1,console.log($scope.workorder._id),$location.url("/workorder/review/"+$scope.workorder._id)},err=>{console.log(err),setDisplay($scope.workorder),AlertService.add("danger","An error occurred while attempting to update."),$scope.submitting=!1}))}),$scope.destroy=(()=>{$scope.submitting=!0,WorkOrders.delete({id:workorder._id},response=>{$location.path("/workorder"),$scope.submitting=!1},err=>{AlertService.add("error",err),$scope.submitting=!1})}),$scope.usedLaborCodes=[],$scope.getUsedLaborCodes=(()=>{_.forEach($scope.workorder.laborCodes,lc=>{_.forEach(lc,code=>{(code.hours>0||code.minutes>0)&&-1===$scope.usedLaborCodes.indexOf(code.text)&&$scope.usedLaborCodes.push(code.text)})})}),$scope.getTimeElapsed=(()=>{const start=new Date($scope.workorder.timeStarted),now=$scope.workorder.timeSubmitted?new Date($scope.workorder.timeSubmitted):new Date;$scope.eMilli=(now.getTime()-start.getTime()).toFixed(),$scope.eSeconds=Math.floor($scope.eMilli/1e3%60),$scope.eMinutes=Math.floor($scope.eMilli/6e4%60),$scope.eHours=Math.floor($scope.eMilli/36e5),$scope.getTotalLaborTime(),$scope.getUnaccountedTime()}),$scope.getTotalLaborTime=(()=>{$scope.laborH=0,$scope.laborM=0,$scope.totalMinutes=0;let AdjMinutes=0;const{laborCodes}=$scope.workorder;let AdjH;Object.keys(laborCodes).forEach(item=>{Object.keys(laborCodes[item]).forEach(child=>{"Negative Time Adjustment"===laborCodes[item][child].text?($scope.totalMinutes-=60*+laborCodes[item][child].hours,$scope.totalMinutes-=+laborCodes[item][child].minutes,AdjMinutes-=60*+laborCodes[item][child].hours,AdjMinutes-=+laborCodes[item][child].minutes):($scope.totalMinutes+=60*+laborCodes[item][child].hours,$scope.totalMinutes+=+laborCodes[item][child].minutes,"Positive Time Adjustment"!==laborCodes[item][child].text&&"Lunch"!==laborCodes[item][child].text||(AdjMinutes+=60*+laborCodes[item][child].hours,AdjMinutes+=+laborCodes[item][child].minutes))})}),AdjH=AdjMinutes>0?Math.floor(AdjMinutes/60):Math.ceil(AdjMinutes/60),$scope.totalMinutes>0?$scope.laborH=Math.floor($scope.totalMinutes/60):$scope.laborH=Math.ceil($scope.totalMinutes/60),$scope.laborM=Math.round($scope.totalMinutes%60);const AdjM=Math.round(AdjMinutes%60),ShowH=$scope.laborH-AdjH,ShowM=$scope.laborM-AdjM;$scope.totalLabor=TimeDisplayService.timeManager(ShowH,ShowM)}),$scope.getUnaccountedTime=(()=>{$scope.unaccountedM=60*($scope.eHours-$scope.laborH),$scope.unaccountedM+=$scope.eMinutes-$scope.laborM,$scope.unaccountedM>0?$scope.unaccountedH=Math.floor($scope.unaccountedM/60):$scope.unaccountedH=Math.ceil($scope.unaccountedM/60),$scope.unaccountedM=Math.round($scope.unaccountedM%60),$scope.unaccountedTime=TimeDisplayService.timeManager($scope.unaccountedH,$scope.unaccountedM)}),parts=parts.map(part=>(part.searchStr=[part.description,part.componentName,part.MPN].join(" "),part)),$scope.partsTableModel=GeneralPartSearchService.partTableModel($scope.parts,"wo",$scope.workorder),$scope.removePart=(part=>{const index=$scope.workorder.parts.indexOf(part);$scope.workorder.parts.splice(index,1)}),$scope.openErrorModal=(modalUrl=>{$uibModal.open({templateUrl:"/lib/public/angular/apps/workorder/views/modals/"+modalUrl,controller:"ErrorCtrl"})}),$scope.openConfirmationModal=(modalUrl=>{$uibModal.open({templateUrl:"/lib/public/angular/apps/workorder/views/modals/"+modalUrl,controller:"ConfirmationCtrl"}).result.then(()=>{$scope.highMileageConfirm=!0,$scope.save()})}),$scope.openLeaseNotes=(()=>{$uibModal.open({templateUrl:"/lib/public/angular/apps/workorder/views/modals/woLeaseNotesModal.html",controller:"NotesModalCtrl",resolve:{notes:function(){return $scope.workorder.misc.leaseNotes}}}).result.then(notes=>{$scope.workorder.misc.leaseNotes=notes})}),$scope.openUnitNotes=(()=>{$uibModal.open({templateUrl:"/lib/public/angular/apps/workorder/views/modals/woUnitNotesModal.html",controller:"NotesModalCtrl",resolve:{notes:function(){return $scope.workorder.misc.unitNotes}}}).result.then(notes=>{$scope.workorder.misc.unitNotes=notes})}),$scope.openUnitView=(()=>{if(void 0!==$scope.displayUnit){$uibModal.open({templateUrl:"/lib/public/angular/apps/workorder/views/modals/woLocationModal.html",scope:$scope,controller:"woLocationModalCtrl"})}else AlertService.add("danger","No unit exists on this work order.")}),$scope.openJSA=(()=>{$uibModal.open({templateUrl:"/lib/public/angular/apps/workorder/views/edit/modals/woJsaModal.html",controller:"JsaEditModalCtrl",windowClass:"jsa-modal",resolve:{jsa:function(){return $scope.workorder.jsa}}}).result.then(jsa=>{$scope.workorder.jsa=jsa})}),$scope.openManualPartModal=(()=>{$uibModal.open({templateUrl:"/lib/public/angular/apps/workorder/views/edit/modals/woManualAddModal.html",controller:"AddPartEditModalCtrl"}).result.then(part=>{$scope.workorder.parts.push(GeneralPartSearchService.manualAddPart(part))})}),$scope.getUsedLaborCodes(),$scope.getTimeElapsed(),$scope.getTotalLaborTime(),$scope.getUnaccountedTime()}angular.module("WorkOrderApp.Controllers").controller("WorkOrderEditCtrl",["$window","$q","$scope","$location","$timeout","$uibModal","$cookies","AlertService","TimeDisplayService","ApiRequestService","GeneralPartSearchService","ObjectService","CommonWOfunctions","WorkOrders","ReviewNotes","EditHistories","Units","Users","Customers","workorder","reviewNotes","editHistories","assettypes","me","parts","states","applicationtypes","DateService","locations","woInputMatrixes","frameModels","engineModels",WorkOrderEditCtrlFunc]);
function WorkOrderReviewCtrlFunc($window,$http,$q,$scope,$location,$timeout,$uibModal,$cookies,AlertService,TimeDisplayService,ApiRequestService,CommonWOfunctions,WorkOrders,Units,Users,ReviewNotes,EditHistories,workorder,reviewNotes,editHistories,me,applicationtypes,parts,DateService,locations,Utils,woInputMatrixes,frameModels,engineModels){$scope.message="Review Work Order";const ARS=ApiRequestService,DS=DateService,{debounce}=Utils;$scope.yards=locations.filter(loc=>{if(-1===loc.name.indexOf(":"))return!0}),$scope.red="#f4bab2",$scope.workorder=workorder,$scope.woInputMatrixes=woInputMatrixes,$scope.engineModels=engineModels,$scope.frameModels=frameModels,$scope.parts=parts,$scope.reviewNotes=reviewNotes,$scope.editHistories=editHistories,$scope.disabled=!0,$scope.me=me,$scope.hours=function getHours(){const hours=[];for(let i=0;i<=24;i++)hours.push(i);return hours}(),$scope.minutes=function getMinutes(){const minutes=[];for(let i=0;i<60;i+=5)minutes.push(i);return minutes}(),$scope.usedLaborCodes=[],$scope.pad=TimeDisplayService.pad,$scope.editable="admin"===$cookies.get("role"),$scope.SyncedToNetsuite=$scope.workorder.timeSynced||$scope.workorder.updated_at,$scope.tripleInputStyling={display:"inline-block",width:"32%"},$scope.inputStyling={display:"inline-block",width:"49%"},$scope.workorderTypes=["Corrective","Trouble Call","Transfer","Swap","New Set","Release","Indirect"],$scope.applicationtypes=applicationtypes,$scope.isManual=(part=>{if(!0===part.isManual)return{backgroundColor:$scope.red}}),$scope.workorder.unitNumber&&($scope.workorder.unitSnapShot&&$scope.workorder.unitSnapShot.hasOwnProperty("number")?$timeout(()=>{$scope.displayUnit=$scope.workorder.unitSnapShot,$scope.headerUnit=$scope.workorder.unitSnapShot}):(ARS.Units({regexN:$scope.workorder.unitNumber}).then(units=>{for(let unit in units)units.hasOwnProperty(unit)&&units[unit].hasOwnProperty("productSeries")&&$timeout(()=>{$scope.displayUnit=units[unit]})}).catch(err=>console.log(err)),ARS.Units({regexN:$scope.workorder.header.unitNumber}).then(units=>{for(let unit in units)units.hasOwnProperty(unit)&&units[unit].hasOwnProperty("productSeries")&&$timeout(()=>{$scope.headerUnit=units[unit],console.log($scope.headerUnit)})}).catch(err=>console.log(err)))),$scope.isFound=(input=>{let show;$scope.workorder.unitReadings.compressorModel&&$scope.woInputMatrixes.forEach(matrix=>{matrix.name===input&&matrix.compressors.forEach(frame=>{frame.netsuiteId===$scope.workorder.unitReadings.compressorModel&&(show=!0)})});const engineModel=$scope.workorder.unitReadings.engineModel;return engineModel&&$scope.woInputMatrixes.forEach(matrix=>{matrix.name===input&&matrix.engines.forEach(engine=>{engine.netsuiteId===engineModel&&(show=!0)})}),engineModel||$scope.workorder.unitReadings.compressorModel||(show=!1),show});const setSave=wo=>{wo.timeStarted&&(wo.timeStarted=DS.saveToOrion(new Date(wo.timeStarted))),wo.timeSubmitted&&(wo.timeSubmitted=DS.saveToOrion(new Date(wo.timeSubmitted))),wo.timeApproved&&(wo.timeApproved=DS.saveToOrion(new Date(wo.timeApproved))),wo.timeSynced&&(wo.timeSynced=DS.saveToOrion(new Date(wo.timeSynced)))},setDisplay=wo=>{wo.timeStarted&&(wo.timeStarted=DS.displayLocal(new Date(wo.timeStarted))),wo.timeSubmitted&&(wo.timeSubmitted=DS.displayLocal(new Date(wo.timeSubmitted))),wo.timeApproved&&(wo.timeApproved=DS.displayLocal(new Date(wo.timeApproved))),wo.timeSynced&&(wo.timeSynced=DS.displayLocal(new Date(wo.timeSynced)))};setDisplay($scope.workorder),$scope.workorder=CommonWOfunctions.addComponentNameToParts($scope.workorder,$scope.parts),$scope.$watch("workorder",newVal=>{newVal&&$scope.workorder.hasOwnProperty("totalWoTime")&&($scope.totalLaborTime=TimeDisplayService.timeManager($scope.workorder.totalWoTime.hours,$scope.workorder.totalWoTime.minutes))},!0),$scope.getTimeElapsed=(()=>{const start=new Date($scope.workorder.timeStarted),now=$scope.workorder.timeSubmitted?new Date($scope.workorder.timeSubmitted):new Date;$scope.eMilli=(now.getTime()-start.getTime()).toFixed(),$scope.eSeconds=Math.floor($scope.eMilli/1e3%60),$scope.eMinutes=Math.floor($scope.eMilli/6e4%60),$scope.eHours=Math.floor($scope.eMilli/36e5)}),$scope.getUsedLaborCodes=(()=>{_.forEach($scope.workorder.laborCodes,lc=>{_.forEach(lc,code=>{(code.hours>0||code.minutes>0)&&-1===$scope.usedLaborCodes.indexOf(code.text)&&$scope.usedLaborCodes.push(code.text)})}),$timeout(()=>{$scope.getUsedLaborCodes()},500)}),$scope.edit=(()=>{$location.path("/workorder/edit/"+$scope.workorder._id)});const unSync=workorder=>{WorkOrders.update({id:$scope.workorder._id},workorder,response=>{setDisplay(workorder)},err=>{setDisplay(workorder),console.log(err),AlertService.add("danger","An error occurred while Unsync work order.")})};function ClassSubmission(){return{type:"",firstname:"",lastname:"",submissionTime:Date}}$scope.comment=function ClassNote(){return{note:"",workOrder:$scope.workorder._id}}(),$scope.sendingNote=!1,$scope.newNote=(()=>{$scope.comment.note&&($scope.sendingNote=!0,console.log("Saving new note..."),ReviewNotes.save({},$scope.comment,response=>{$scope.sendingNote=!1,console.log(response),console.log("Successful save."),ARS.ReviewNotes({workOrder:response.workOrder}).then(newNotes=>{$scope.reviewNotes=newNotes}).catch(err=>console.log(err)),$scope.comment.note=null},function(err){$scope.sendingNote=!1,console.log(err),console.log("Error Saving Note."),$scope.comment.note=null}))}),$scope.displaySubmissions=[],$scope.workorder.timeSubmitted&&ARS.getUser({id:$scope.workorder.techId}).then(user=>{let thisUser=user;const techSubmission=ClassSubmission();techSubmission.type="Submission",void 0!==thisUser?(techSubmission.firstname=thisUser.firstName,techSubmission.lastname=thisUser.lastName):techSubmission.firstname=$scope.workorder.techId,techSubmission.submissionTime=$scope.workorder.timeSubmitted,$scope.displaySubmissions.push(techSubmission),$scope.workorder.timeApproved&&ARS.getUser({id:$scope.workorder.approvedBy}).then(manager=>{thisUser=manager;const managerSubmission=ClassSubmission();managerSubmission.type="Reviewed",managerSubmission.firstname=thisUser.firstName,managerSubmission.lastname=thisUser.lastName,managerSubmission.submissionTime=$scope.workorder.timeApproved,$scope.displaySubmissions.push(managerSubmission)}).catch(err=>console.log(err)),$scope.workorder.timeSynced&&ARS.getUser({id:$scope.workorder.syncedBy}).then(admin=>{thisUser=admin;const adminSubmission=ClassSubmission();adminSubmission.type="Synced",adminSubmission.firstname=thisUser.firstName,adminSubmission.lastname=thisUser.lastName,adminSubmission.submissionTime=$scope.workorder.timeSynced,$scope.displaySubmissions.push(adminSubmission)}).catch(err=>console.log(err))}).catch(err=>console.log(err)),$scope.displayChanges=[],_.map($scope.editHistories,edit=>{if($scope.workorder._id===edit.workOrder){const thisEdit={panelName:"",itemName:"",type:"",before:"",after:""};thisEdit.panelName=edit.path[0],thisEdit.itemName=edit.path.pop(),thisEdit.type=edit.editType,thisEdit.before=edit.before,thisEdit.after=edit.after,$scope.displayChanges.push(thisEdit)}}),0!==$scope.editHistories.length&&(ARS.getUser({id:$scope.editHistories.pop().user}).then(admin=>{$scope.editor=admin}).catch(err=>{console.log("Editor retrieval error"),console.log(err)}),$scope.editCount=$scope.editHistories.length+1),$scope.submit=(()=>{console.log("Submitting..."),"manager"!==$cookies.get("role")||$scope.workorder.managerApproved&&$scope.workorder.timeApproved?"admin"!==$cookies.get("role")||$scope.workorder.managerApproved||$scope.workorder.timeApproved?"admin"===$cookies.get("role")&&$scope.workorder.managerApproved?"Indirect"!==$scope.workorder.type?(console.log("admin && approved && !indirect"),AlertService.add("info","Will route to dashboard when netsuite returns ID. Otherwise a warning will show here."),$scope.workorder.netsuiteSyned=!0,setSave($scope.workorder),WorkOrders.update({id:$scope.workorder._id},$scope.workorder,response=>{""!==response.netsuiteId?(AlertService.add("success","Successfully synced to netsuite."),$location.path("/myaccount")):($scope.workorder.netsuiteSyned=!1,$scope.workorder.timeSynced=null,$scope.workorder.syncedBy="",unSync($scope.workorder),AlertService.add("danger","Not synced to Netsuite, no NSID in response."))},err=>{console.log(err),$scope.workorder.netsuiteSyned=!1,$scope.workorder.timeSynced=null,$scope.workorder.syncedBy="",unSync($scope.workorder),console.log($scope.workorder),AlertService.add("danger","An error occurred while attempting to sync.")})):(console.log("admin && approved && indirect"),$scope.workorder.netsuiteSyned=!0,setSave($scope.workorder),WorkOrders.update({id:$scope.workorder._id},$scope.workorder,()=>{AlertService.add("success","Successfully saved Indirect work order, not synced to Netsuite."),$location.path("/myaccount")},err=>{console.log(err),$scope.workorder.netsuiteSyned=!1,$scope.workorder.timeSynced=null,$scope.workorder.syncedBy="",unSync($scope.workorder),AlertService.add("danger","An error occurred while attempting to save work order.")})):AlertService.add("info","Either not allowed to submit or no decision based on your authorization could be made."):"Indirect"!==$scope.workorder.type?(console.log("admin && !approved && !indirect"),AlertService.add("info","Will route to dashboard when netsuite returns ID. Otherwise a warning will show here."),$scope.workorder.netsuiteSyned=!0,setSave($scope.workorder),WorkOrders.update({id:$scope.workorder._id},$scope.workorder,response=>{""!==response.netsuiteId?(AlertService.add("success","Successfully synced to netsuite."),$location.path("/myaccount")):($scope.workorder.netsuiteSyned=!1,$scope.workorder.timeSynced=null,$scope.workorder.syncedBy="",unSync($scope.workorder),AlertService.add("danger","Not synced to Netsuite, no NSID in response."))},err=>{console.log(err),console.log($scope.workorder),$scope.workorder.netsuiteSyned=!1,$scope.workorder.timeSynced=null,$scope.workorder.syncedBy="",unSync($scope.workorder),AlertService.add("danger","An error occurred while attempting to sync.")})):(console.log("admin && !approved && indirect"),$scope.workorder.netsuiteSyned=!0,setSave($scope.workorder),WorkOrders.update({id:$scope.workorder._id},$scope.workorder,response=>{AlertService.add("success","Successfully Submitted Indirect."),$location.path("/myaccount")},err=>{console.log(err),$scope.workorder.netsuiteSyned=!1,$scope.workorder.timeSynced=null,$scope.workorder.syncedBy="",unSync($scope.workorder),AlertService.add("danger","An error occurred while attempting to save work order.")})):(setSave($scope.workorder),console.log("manager && !approved"),WorkOrders.update({id:$scope.workorder._id},$scope.workorder,()=>{AlertService.add("success","Successfully submitted for admin approval."),$location.path("/myaccount")},err=>{console.log(err),setDisplay($scope.workorder),AlertService.add("danger","An error occurred while attempting to submit.")}))}),$scope.openLeaseNotes=(()=>{$uibModal.open({templateUrl:"/lib/public/angular/apps/workorder/views/modals/woLeaseNotesModal.html",controller:"NotesModalCtrl",scope:$scope,resolve:{notes:function(){return $scope.workorder.misc.leaseNotes}}}).result.then(notes=>{$scope.workorder.misc.leaseNotes=notes})}),$scope.openUnitNotes=(()=>{$uibModal.open({templateUrl:"/lib/public/angular/apps/workorder/views/modals/woUnitNotesModal.html",controller:"NotesModalCtrl",scope:$scope,resolve:{notes:function(){return $scope.workorder.misc.unitNotes}}}).result.then(notes=>{$scope.workorder.misc.unitNotes=notes})}),$scope.openUnitView=(()=>{if(void 0!==$scope.displayUnit){$uibModal.open({templateUrl:"/lib/public/angular/apps/workorder/views/modals/woLocationModal.html",scope:$scope,controller:"woLocationModalCtrl"})}else AlertService.add("danger","No unit exists on this work order.")}),$scope.openJSA=(()=>{$uibModal.open({templateUrl:"/lib/public/angular/apps/workorder/views/review/modals/woJsaModal.html",controller:"JsaReviewModalCtrl",windowClass:"jsa-modal",resolve:{jsa:function(){return $scope.workorder.jsa}}}).result.then(jsa=>{$scope.workorder.jsa=jsa})}),$scope.getUsedLaborCodes(),$scope.getTimeElapsed(),$scope.debounceSubmit=debounce($scope.submit,1e4,!0)}angular.module("WorkOrderApp.Controllers").controller("WorkOrderReviewCtrl",["$window","$http","$q","$scope","$location","$timeout","$uibModal","$cookies","AlertService","TimeDisplayService","ApiRequestService","CommonWOfunctions","WorkOrders","Units","Users","ReviewNotes","EditHistories","workorder","reviewNotes","editHistories","me","applicationtypes","parts","DateService","locations","Utils","woInputMatrixes","frameModels","engineModels",WorkOrderReviewCtrlFunc]);
angular.module("MCDiligenceApp.Controllers").controller("mcDiligenceModalCtrl",["$window","$scope","$uibModalInstance",function($window,$scope,$uibModalInstance){$scope.unit={},$scope.latLong=$scope.$parent.latLong,$scope.unit.geo={type:"Point",coordinates:[$scope.latLong[1],$scope.latLong[0]]},$scope.toUnitPage=(()=>{$uibModalInstance.close(),$window.open("#/unit/page/"+$scope.unit.geo.coordinates[1]+","+$scope.unit.geo.coordinates[0])}),$scope.ok=(()=>{$uibModalInstance.close()})}]);
class createStartEndDateCtrl{constructor($window,TimeDisplayService,DateService){console.log("in createStartEndDateCtrl")}$onInit(){console.log(this.workorder)}}angular.module("WorkOrderApp.Components").component("createStartEndDate",{templateUrl:"/lib/public/angular/apps/workorder/views/component.views/create/selectStartEndDate.html",bindings:{workorder:"<"},controller:["$window","TimeDisplayService","DateService",createStartEndDateCtrl]});
angular.module("WorkOrderApp.Directives").directive("workorderComments",[function(){return{restrict:"E",templateUrl:"/lib/public/angular/apps/workorder/views/edit/woComments.html",scope:!0}}]);
angular.module("WorkOrderApp.Directives").directive("workorderEmissionsReadings",[function(){return{restrict:"E",templateUrl:"/lib/public/angular/apps/workorder/views/edit/woEmissionsReadings.html",scope:!0}}]);
angular.module("WorkOrderApp.Directives").directive("workorderHistory",[function(){return{restrict:"E",templateUrl:"/lib/public/angular/apps/workorder/views/edit/woHistory.html",scope:!0}}]);
angular.module("WorkOrderApp.Directives").directive("workorderUnitReadings",[function(){return{restrict:"E",templateUrl:"/lib/public/angular/apps/workorder/views/edit/woUnitReadings.html",scope:!0}}]);
angular.module("WorkOrderApp.Directives").directive("reviewComments",[function(){return{restrict:"E",templateUrl:"/lib/public/angular/apps/workorder/views/review/woComments.html",scope:!0}}]);
angular.module("WorkOrderApp.Directives").directive("reviewEmissionsReadings",[function(){return{restrict:"E",templateUrl:"/lib/public/angular/apps/workorder/views/review/woEmissionsReadings.html",scope:!0}}]);
angular.module("WorkOrderApp.Directives").directive("reviewHistory",[function(){return{restrict:"E",templateUrl:"/lib/public/angular/apps/workorder/views/review/woHistory.html",scope:!0}}]);
angular.module("WorkOrderApp.Directives").directive("reviewUnitReadings",[function(){return{restrict:"E",templateUrl:"/lib/public/angular/apps/workorder/views/review/woUnitReadings.html",scope:!0}}]);
angular.module("WorkOrderApp.Controllers").controller("ConfirmationCtrl",function($scope,$uibModalInstance){$scope.confirm=(()=>{$uibModalInstance.close(!0)}),$scope.cancel=(()=>{$uibModalInstance.dismiss("cancel")})});
angular.module("WorkOrderApp.Controllers").controller("ErrorCtrl",function($scope,$uibModalInstance){$scope.ok=(()=>{$uibModalInstance.close()})});
angular.module("WorkOrderApp.Controllers").controller("NotesModalCtrl",function($scope,$uibModalInstance,notes){$scope.notes=notes,$scope.disabled=$scope.$parent.disabled,$scope.changeNoteTextAreaField=((changedData,selected)=>{$scope.notes=changedData}),$scope.ok=(()=>{$uibModalInstance.close($scope.notes)}),$scope.cancel=(()=>{$uibModalInstance.dismiss("cancel")})});
angular.module("WorkOrderApp.Controllers").controller("SubmitAllModalCtrl",function($scope,$uibModalInstance){$scope.ok=(()=>{$uibModalInstance.close(!0)}),$scope.cancel=function(){$uibModalInstance.dismiss(!1)}});
angular.module("WorkOrderApp.Controllers").controller("woLocationModalCtrl",["$window","$scope","$uibModalInstance",function($window,$scope,$uibModalInstance){$scope.unit=$scope.$parent.displayUnit,$scope.unit.geo=$scope.$parent.workorder.geo,$scope.toUnitPage=(()=>{$uibModalInstance.close(),$window.open("#/unit/page/"+$scope.unit.geo.coordinates[1]+","+$scope.unit.geo.coordinates[0])}),$scope.ok=(()=>{$uibModalInstance.close()})}]);
angular.module("WorkOrderApp.Directives").directive("workorderPartsAdd",[function(){return{restrict:"E",templateUrl:"/lib/public/angular/apps/workorder/views/edit/parts/woPartsAdd.html",scope:!0}}]);
angular.module("WorkOrderApp.Directives").directive("workorderPartsList",[function(){return{restrict:"E",templateUrl:"/lib/public/angular/apps/workorder/views/edit/parts/woPartsList.html",scope:!0}}]);
angular.module("WorkOrderApp.Directives").directive("workorderParts",[function(){return{restrict:"E",templateUrl:"/lib/public/angular/apps/workorder/views/edit/parts/workorderParts.html",scope:!0}}]);
angular.module("WorkOrderApp.Directives").directive("workorderEngineChecks",[function(){return{restrict:"E",templateUrl:"/lib/public/angular/apps/workorder/views/edit/pm/woEngineChecks.html",scope:!0}}]);
angular.module("WorkOrderApp.Directives").directive("workorderEngineCompression",[function(){return{restrict:"E",templateUrl:"/lib/public/angular/apps/workorder/views/edit/pm/woEngineCompression.html",scope:!0}}]);
angular.module("WorkOrderApp.Directives").directive("workorderGeneralChecks",[function(){return{restrict:"E",templateUrl:"/lib/public/angular/apps/workorder/views/edit/pm/woGeneralChecks.html",scope:!0}}]);
angular.module("WorkOrderApp.Directives").directive("workorderKillSettings",[function(){return{restrict:"E",templateUrl:"/lib/public/angular/apps/workorder/views/edit/pm/woKillSettings.html",scope:!0}}]);
angular.module("WorkOrderApp.Directives").directive("workorderPmMisc",[function(){return{restrict:"E",templateUrl:"/lib/public/angular/apps/workorder/views/edit/pm/woPMMisc.html",scope:!0}}]);
angular.module("WorkOrderApp.Directives").directive("workorderPm",[function(){return{restrict:"E",templateUrl:"/lib/public/angular/apps/workorder/views/edit/pm/woPM.html",scope:!0}}]);
angular.module("WorkOrderApp.Directives").directive("workorderBasicLc",[function(){return{restrict:"E",templateUrl:"/lib/public/angular/apps/workorder/views/edit/lc/woBasicLC.html",scope:!0}}]);
angular.module("WorkOrderApp.Directives").directive("workorderCompressorLc",[function(){return{restrict:"E",templateUrl:"/lib/public/angular/apps/workorder/views/edit/lc/woCompressorLC.html",scope:!0}}]);
angular.module("WorkOrderApp.Directives").directive("workorderCoolerLc",[function(){return{restrict:"E",templateUrl:"/lib/public/angular/apps/workorder/views/edit/lc/woCoolerLC.html",scope:!0}}]);
angular.module("WorkOrderApp.Directives").directive("workorderEmissionsLc",[function(){return{restrict:"E",templateUrl:"/lib/public/angular/apps/workorder/views/edit/lc/woEmissionsLC.html",scope:!0}}]);
angular.module("WorkOrderApp.Directives").directive("workorderEngineLc",[function(){return{restrict:"E",templateUrl:"/lib/public/angular/apps/workorder/views/edit/lc/woEngineLC.html",scope:!0}}]);
angular.module("WorkOrderApp.Directives").directive("workorderPanelLc",[function(){return{restrict:"E",templateUrl:"/lib/public/angular/apps/workorder/views/edit/lc/woPanelLC.html",scope:!0}}]);
angular.module("WorkOrderApp.Directives").directive("workorderVesselLc",[function(){return{restrict:"E",templateUrl:"/lib/public/angular/apps/workorder/views/edit/lc/woVesselLC.html",scope:!0}}]);
angular.module("WorkOrderApp.Directives").directive("workorderLaborCodes",[function(){return{restrict:"E",templateUrl:"/lib/public/angular/apps/workorder/views/edit/lc/workorderLaborCodes.html",scope:!0}}]);
angular.module("WorkOrderApp.Directives").directive("workorderBilling",[function(){return{restrict:"E",templateUrl:"/lib/public/angular/apps/workorder/views/edit/header/woBilling.html",scope:!0}}]);
angular.module("WorkOrderApp.Directives").directive("editDataHistory",[function(){return{restrict:"E",templateUrl:"/lib/public/angular/apps/workorder/views/edit/header/woDataHistory.html",scope:!0}}]);
angular.module("WorkOrderApp.Directives").directive("workorderHeading",[function(){return{restrict:"E",templateUrl:"/lib/public/angular/apps/workorder/views/edit/header/woHeading.html",scope:!0}}]);
angular.module("WorkOrderApp.Directives").directive("workorderMisc",[function(){return{restrict:"E",templateUrl:"/lib/public/angular/apps/workorder/views/edit/header/woMisc.html",scope:!0}}]);
angular.module("WorkOrderApp.Directives").directive("editNotes",[function(){return{restrict:"E",templateUrl:"/lib/public/angular/apps/workorder/views/edit/header/woNotes.html",scope:!0}}]);
angular.module("WorkOrderApp.Directives").directive("workorderOwnership",[function(){return{restrict:"E",templateUrl:"/lib/public/angular/apps/workorder/views/edit/header/woOwnership.html",scope:!0}}]);
angular.module("WorkOrderApp.Directives").directive("workorderType",[function(){return{restrict:"E",templateUrl:"/lib/public/angular/apps/workorder/views/edit/header/woType.html",scope:!0}}]);
angular.module("WorkOrderApp.Directives").directive("workorderHeader",[function(){return{restrict:"E",templateUrl:"/lib/public/angular/apps/workorder/views/edit/header/workorderheader.html",scope:!0}}]);
angular.module("WorkOrderApp.Directives").directive("reviewBilling",[function(){return{restrict:"E",templateUrl:"/lib/public/angular/apps/workorder/views/review/header/woBilling.html",scope:!0}}]);
angular.module("WorkOrderApp.Directives").directive("reviewHeading",[function(){return{restrict:"E",templateUrl:"/lib/public/angular/apps/workorder/views/review/header/woHeading.html",scope:!0}}]);
angular.module("WorkOrderApp.Directives").directive("reviewDataHistory",[function(){return{restrict:"E",templateUrl:"/lib/public/angular/apps/workorder/views/review/header/woDataHistory.html",scope:!0}}]);
angular.module("WorkOrderApp.Directives").directive("reviewInfo",[function(){return{restrict:"E",templateUrl:"/lib/public/angular/apps/workorder/views/review/header/woInfo.html",scope:!0}}]);
angular.module("WorkOrderApp.Directives").directive("reviewMisc",[function(){return{restrict:"E",templateUrl:"/lib/public/angular/apps/workorder/views/review/header/woMisc.html",scope:!0}}]);
angular.module("WorkOrderApp.Directives").directive("reviewNotes",[function(){return{restrict:"E",templateUrl:"/lib/public/angular/apps/workorder/views/review/header/woNotes.html",scope:!0}}]);
angular.module("WorkOrderApp.Directives").directive("reviewOwnership",[function(){return{restrict:"E",templateUrl:"/lib/public/angular/apps/workorder/views/review/header/woOwnership.html",scope:!0}}]);
angular.module("WorkOrderApp.Directives").directive("reviewType",[function(){return{restrict:"E",templateUrl:"/lib/public/angular/apps/workorder/views/review/header/woType.html",scope:!0}}]);
angular.module("WorkOrderApp.Directives").directive("reviewHeader",[function(){return{restrict:"E",templateUrl:"/lib/public/angular/apps/workorder/views/review/header/workorderheader.html",scope:!0}}]);
angular.module("WorkOrderApp.Directives").directive("reviewBasicLc",[function(){return{restrict:"E",templateUrl:"/lib/public/angular/apps/workorder/views/review/lc/woBasicLC.html",scope:!0}}]);
angular.module("WorkOrderApp.Directives").directive("reviewCompressorLc",[function(){return{restrict:"E",templateUrl:"/lib/public/angular/apps/workorder/views/review/lc/woCompressorLC.html",scope:!0}}]);
angular.module("WorkOrderApp.Directives").directive("reviewCoolerLc",[function(){return{restrict:"E",templateUrl:"/lib/public/angular/apps/workorder/views/review/lc/woCoolerLC.html",scope:!0}}]);
angular.module("WorkOrderApp.Directives").directive("reviewEmissionsLc",[function(){return{restrict:"E",templateUrl:"/lib/public/angular/apps/workorder/views/review/lc/woEmissionsLC.html",scope:!0}}]);
angular.module("WorkOrderApp.Directives").directive("reviewEngineLc",[function(){return{restrict:"E",templateUrl:"/lib/public/angular/apps/workorder/views/review/lc/woEngineLC.html",scope:!0}}]);
angular.module("WorkOrderApp.Directives").directive("reviewPanelLc",[function(){return{restrict:"E",templateUrl:"/lib/public/angular/apps/workorder/views/review/lc/woPanelLC.html",scope:!0}}]);
angular.module("WorkOrderApp.Directives").directive("reviewVesselLc",[function(){return{restrict:"E",templateUrl:"/lib/public/angular/apps/workorder/views/review/lc/woVesselLC.html",scope:!0}}]);
angular.module("WorkOrderApp.Directives").directive("reviewLaborCodes",[function(){return{restrict:"E",templateUrl:"/lib/public/angular/apps/workorder/views/review/lc/workorderLaborCodes.html",scope:!0}}]);
angular.module("WorkOrderApp.Directives").directive("reviewEngineChecks",[function(){return{restrict:"E",templateUrl:"/lib/public/angular/apps/workorder/views/review/pm/woEngineChecks.html",scope:!0}}]);
angular.module("WorkOrderApp.Directives").directive("reviewEngineCompression",[function(){return{restrict:"E",templateUrl:"/lib/public/angular/apps/workorder/views/review/pm/woEngineCompression.html",scope:!0}}]);
angular.module("WorkOrderApp.Directives").directive("reviewGeneralChecks",[function(){return{restrict:"E",templateUrl:"/lib/public/angular/apps/workorder/views/review/pm/woGeneralChecks.html",scope:!0}}]);
angular.module("WorkOrderApp.Directives").directive("reviewKillSettings",[function(){return{restrict:"E",templateUrl:"/lib/public/angular/apps/workorder/views/review/pm/woKillSettings.html",scope:!0}}]);
angular.module("WorkOrderApp.Directives").directive("reviewPmMisc",[function(){return{restrict:"E",templateUrl:"/lib/public/angular/apps/workorder/views/review/pm/woPMMisc.html",scope:!0}}]);
angular.module("WorkOrderApp.Directives").directive("sopChecks",[function(){return{restrict:"E",templateUrl:"/lib/public/angular/apps/workorder/views/review/pm/woSOPChecks.html",scope:!0}}]);
angular.module("WorkOrderApp.Directives").directive("reviewPm",[function(){return{restrict:"E",templateUrl:"/lib/public/angular/apps/workorder/views/review/pm/woPM.html",scope:!0}}]);
angular.module("WorkOrderApp.Directives").directive("reviewPartsAdd",[function(){return{restrict:"E",templateUrl:"/lib/public/angular/apps/workorder/views/review/parts/woPartsAdd.html",scope:!0}}]);
angular.module("WorkOrderApp.Directives").directive("reviewPartsList",[function(){return{restrict:"E",templateUrl:"/lib/public/angular/apps/workorder/views/review/parts/woPartsList.html",scope:!0}}]);
angular.module("WorkOrderApp.Directives").directive("reviewParts",[function(){return{restrict:"E",templateUrl:"/lib/public/angular/apps/workorder/views/review/parts/workorderParts.html",scope:!0}}]);
angular.module("WorkOrderApp.Controllers").controller("AddPartEditModalCtrl",function($scope,$uibModalInstance,ObjectService){$scope.part={},$scope.changePartTextAreaField=((changedData,selected)=>{ObjectService.updateNonNestedObjectValue($scope.part,changedData,selected)}),$scope.changePartTextField=((changedData,selected)=>{ObjectService.updateNonNestedObjectValue($scope.part,changedData,selected)}),$scope.addPart=(()=>{$uibModalInstance.close($scope.part)}),$scope.cancel=(()=>{$uibModalInstance.dismiss("cancel")})});
angular.module("WorkOrderApp.Controllers").controller("JsaEditModalCtrl",function($scope,$uibModalInstance,jsa,ObjectService){$scope.jsa=jsa,$scope.changeJsaTextAreaField=((changeData,selected)=>{ObjectService.updateNestedObjectValue($scope.jsa,changeData,selected)}),$scope.changeJsaCheckbox=((changedData,selected)=>{ObjectService.updateNestedObjectValue($scope.jsa,changedData,selected)}),$scope.changeJsaTextField=((changedData,selected)=>{ObjectService.updateNonNestedObjectValue($scope.jsa,changedData,selected)}),$scope.ok=(()=>{$uibModalInstance.close($scope.jsa)}),$scope.cancel=function(){$uibModalInstance.dismiss("cancel")},$scope.removeTech=(tech=>{const index=$scope.jsa.techinicians.indexOf(tech);$scope.jsa.techinicians.splice(index,1)})});
angular.module("WorkOrderApp.Controllers").controller("JsaReviewModalCtrl",function($scope,$uibModalInstance,jsa){$scope.jsa=jsa,$scope.ok=(()=>{$uibModalInstance.close($scope.jsa)}),$scope.cancel=(()=>{$uibModalInstance.dismiss("cancel")})});
!function($){$.fn.numeric=function(config,callback){"boolean"==typeof config&&(config={decimal:config}),void 0===(config=config||{}).negative&&(config.negative=!0);var decimal=!1===config.decimal?"":config.decimal||".",negative=!0===config.negative;return callback="function"==typeof callback?callback:function(){},this.data("numeric.decimal",decimal).data("numeric.negative",negative).data("numeric.callback",callback).keypress($.fn.numeric.keypress).keyup($.fn.numeric.keyup).blur($.fn.numeric.blur)},$.fn.numeric.keypress=function(e){var decimal=$.data(this,"numeric.decimal"),negative=$.data(this,"numeric.negative"),key=e.charCode?e.charCode:e.keyCode?e.keyCode:0;if(13==key&&"input"==this.nodeName.toLowerCase())return!0;if(13==key)return!1;var allow=!1;if(e.ctrlKey&&97==key||e.ctrlKey&&65==key)return!0;if(e.ctrlKey&&120==key||e.ctrlKey&&88==key)return!0;if(e.ctrlKey&&99==key||e.ctrlKey&&67==key)return!0;if(e.ctrlKey&&122==key||e.ctrlKey&&90==key)return!0;if(e.ctrlKey&&118==key||e.ctrlKey&&86==key||e.shiftKey&&45==key)return!0;if(key<48||key>57){var value=$(this).val();if(0!==$.inArray("-",value.split(""))&&negative&&45==key&&(0===value.length||0===parseInt($.fn.getSelectionStart(this),10)))return!0;decimal&&key==decimal.charCodeAt(0)&&-1!=$.inArray(decimal,value.split(""))&&(allow=!1),8!=key&&9!=key&&13!=key&&35!=key&&36!=key&&37!=key&&39!=key&&46!=key?allow=!1:void 0!==e.charCode&&(e.keyCode==e.which&&0!==e.which?(allow=!0,46==e.which&&(allow=!1)):0!==e.keyCode&&0===e.charCode&&0===e.which&&(allow=!0)),decimal&&key==decimal.charCodeAt(0)&&(allow=-1==$.inArray(decimal,value.split("")))}else allow=!0;return allow},$.fn.numeric.keyup=function(e){var val=$(this).val();if(val&&val.length>0){var carat=$.fn.getSelectionStart(this),selectionEnd=$.fn.getSelectionEnd(this),decimal=$.data(this,"numeric.decimal"),negative=$.data(this,"numeric.negative");if(""!==decimal&&null!==decimal){var dot=$.inArray(decimal,val.split(""));0===dot&&(this.value="0"+val,carat++,selectionEnd++),1==dot&&"-"==val.charAt(0)&&(this.value="-0"+val.substring(1),carat++,selectionEnd++),val=this.value}for(var validChars=[0,1,2,3,4,5,6,7,8,9,"-",decimal],length=val.length,i=length-1;i>=0;i--){var ch=val.charAt(i);0!==i&&"-"==ch?val=val.substring(0,i)+val.substring(i+1):0!==i||negative||"-"!=ch||(val=val.substring(1));for(var validChar=!1,j=0;j<validChars.length;j++)if(ch==validChars[j]){validChar=!0;break}validChar&&" "!=ch||(val=val.substring(0,i)+val.substring(i+1))}var firstDecimal=$.inArray(decimal,val.split(""));if(firstDecimal>0)for(var k=length-1;k>firstDecimal;k--){val.charAt(k)==decimal&&(val=val.substring(0,k)+val.substring(k+1))}this.value=val,$.fn.setSelection(this,[carat,selectionEnd])}},$.fn.numeric.blur=function(){var decimal=$.data(this,"numeric.decimal"),callback=$.data(this,"numeric.callback"),val=this.value;""!==val&&(new RegExp("^\\d+$|^\\d*"+decimal+"\\d+$").exec(val)||callback.apply(this))},$.fn.removeNumeric=function(){return this.data("numeric.decimal",null).data("numeric.negative",null).data("numeric.callback",null).unbind("keypress",$.fn.numeric.keypress).unbind("blur",$.fn.numeric.blur)},$.fn.getSelectionStart=function(o){if("number"!==o.type){var r;if(o.createTextRange)return void 0===document.selection?r=document.getSelection():(r=document.selection.createRange().duplicate()).moveEnd("character",o.value.length),""==r.text?o.value.length:o.value.lastIndexOf(r.text);try{return o.selectionStart}catch(e){return 0}}},$.fn.getSelectionEnd=function(o){if("number"!==o.type){if(o.createTextRange){var r=document.selection.createRange().duplicate();return r.moveStart("character",-o.value.length),r.text.length}return o.selectionEnd}},$.fn.setSelection=function(o,p){if("number"==typeof p&&(p=[p,p]),p&&p.constructor==Array&&2==p.length)if("number"===o.type)o.focus();else if(o.createTextRange){var r=o.createTextRange();r.collapse(!0),r.moveStart("character",p[0]),r.moveEnd("character",p[1]),r.select()}else{o.focus();try{o.setSelectionRange&&o.setSelectionRange(p[0],p[1])}catch(e){}}}}(jQuery);
if("undefined"==typeof jQuery)throw new Error("Bootstrap's JavaScript requires jQuery");!function(a){"use strict";a.fn.emulateTransitionEnd=function(b){var c=!1,d=this;a(this).one("bsTransitionEnd",function(){c=!0});return setTimeout(function(){c||a(d).trigger(a.support.transition.end)},b),this},a(function(){a.support.transition=function b(){var a=document.createElement("bootstrap"),b={WebkitTransition:"webkitTransitionEnd",MozTransition:"transitionend",OTransition:"oTransitionEnd otransitionend",transition:"transitionend"};for(var c in b)if(void 0!==a.style[c])return{end:b[c]};return!1}(),a.support.transition&&(a.event.special.bsTransitionEnd={bindType:a.support.transition.end,delegateType:a.support.transition.end,handle:function(b){return a(b.target).is(this)?b.handleObj.handler.apply(this,arguments):void 0}})})}(jQuery),function(a){"use strict";var c='[data-dismiss="alert"]',d=function(b){a(b).on("click",c,this.close)};d.VERSION="3.2.0",d.prototype.close=function(b){function c(){f.detach().trigger("closed.bs.alert").remove()}var d=a(this),e=d.attr("data-target");e||(e=(e=d.attr("href"))&&e.replace(/.*(?=#[^\s]*$)/,""));var f=a(e);b&&b.preventDefault(),f.length||(f=d.hasClass("alert")?d:d.parent()),f.trigger(b=a.Event("close.bs.alert")),b.isDefaultPrevented()||(f.removeClass("in"),a.support.transition&&f.hasClass("fade")?f.one("bsTransitionEnd",c).emulateTransitionEnd(150):c())};var e=a.fn.alert;a.fn.alert=function b(b){return this.each(function(){var c=a(this),e=c.data("bs.alert");e||c.data("bs.alert",e=new d(this)),"string"==typeof b&&e[b].call(c)})},a.fn.alert.Constructor=d,a.fn.alert.noConflict=function(){return a.fn.alert=e,this},a(document).on("click.bs.alert.data-api",c,d.prototype.close)}(jQuery),function(a){"use strict";function b(b){return this.each(function(){var d=a(this),e=d.data("bs.button"),f="object"==typeof b&&b;e||d.data("bs.button",e=new c(this,f)),"toggle"==b?e.toggle():b&&e.setState(b)})}var c=function(b,d){this.$element=a(b),this.options=a.extend({},c.DEFAULTS,d),this.isLoading=!1};c.VERSION="3.2.0",c.DEFAULTS={loadingText:"loading..."},c.prototype.setState=function(b){var c="disabled",d=this.$element,e=d.is("input")?"val":"html",f=d.data();b+="Text",null==f.resetText&&d.data("resetText",d[e]()),d[e](null==f[b]?this.options[b]:f[b]),setTimeout(a.proxy(function(){"loadingText"==b?(this.isLoading=!0,d.addClass(c).attr(c,c)):this.isLoading&&(this.isLoading=!1,d.removeClass(c).removeAttr(c))},this),0)},c.prototype.toggle=function(){var a=!0,b=this.$element.closest('[data-toggle="buttons"]');if(b.length){var c=this.$element.find("input");"radio"==c.prop("type")&&(c.prop("checked")&&this.$element.hasClass("active")?a=!1:b.find(".active").removeClass("active")),a&&c.prop("checked",!this.$element.hasClass("active")).trigger("change")}a&&this.$element.toggleClass("active")};var d=a.fn.button;a.fn.button=b,a.fn.button.Constructor=c,a.fn.button.noConflict=function(){return a.fn.button=d,this},a(document).on("click.bs.button.data-api",'[data-toggle^="button"]',function(c){var d=a(c.target);d.hasClass("btn")||(d=d.closest(".btn")),b.call(d,"toggle"),c.preventDefault()})}(jQuery),function(a){"use strict";function b(b){return this.each(function(){var d=a(this),e=d.data("bs.carousel"),f=a.extend({},c.DEFAULTS,d.data(),"object"==typeof b&&b),g="string"==typeof b?b:f.slide;e||d.data("bs.carousel",e=new c(this,f)),"number"==typeof b?e.to(b):g?e[g]():f.interval&&e.pause().cycle()})}var c=function(b,c){this.$element=a(b).on("keydown.bs.carousel",a.proxy(this.keydown,this)),this.$indicators=this.$element.find(".carousel-indicators"),this.options=c,this.paused=this.sliding=this.interval=this.$active=this.$items=null,"hover"==this.options.pause&&this.$element.on("mouseenter.bs.carousel",a.proxy(this.pause,this)).on("mouseleave.bs.carousel",a.proxy(this.cycle,this))};c.VERSION="3.2.0",c.DEFAULTS={interval:5e3,pause:"hover",wrap:!0},c.prototype.keydown=function(a){switch(a.which){case 37:this.prev();break;case 39:this.next();break;default:return}a.preventDefault()},c.prototype.cycle=function(b){return b||(this.paused=!1),this.interval&&clearInterval(this.interval),this.options.interval&&!this.paused&&(this.interval=setInterval(a.proxy(this.next,this),this.options.interval)),this},c.prototype.getItemIndex=function(a){return this.$items=a.parent().children(".item"),this.$items.index(a||this.$active)},c.prototype.to=function(b){var c=this,d=this.getItemIndex(this.$active=this.$element.find(".item.active"));return b>this.$items.length-1||0>b?void 0:this.sliding?this.$element.one("slid.bs.carousel",function(){c.to(b)}):d==b?this.pause().cycle():this.slide(b>d?"next":"prev",a(this.$items[b]))},c.prototype.pause=function(b){return b||(this.paused=!0),this.$element.find(".next, .prev").length&&a.support.transition&&(this.$element.trigger(a.support.transition.end),this.cycle(!0)),this.interval=clearInterval(this.interval),this},c.prototype.next=function(){return this.sliding?void 0:this.slide("next")},c.prototype.prev=function(){return this.sliding?void 0:this.slide("prev")},c.prototype.slide=function(b,c){var d=this.$element.find(".item.active"),e=c||d[b](),f=this.interval,g="next"==b?"left":"right",h="next"==b?"first":"last",i=this;if(!e.length){if(!this.options.wrap)return;e=this.$element.find(".item")[h]()}if(e.hasClass("active"))return this.sliding=!1;var j=e[0],k=a.Event("slide.bs.carousel",{relatedTarget:j,direction:g});if(this.$element.trigger(k),!k.isDefaultPrevented()){if(this.sliding=!0,f&&this.pause(),this.$indicators.length){this.$indicators.find(".active").removeClass("active");var l=a(this.$indicators.children()[this.getItemIndex(e)]);l&&l.addClass("active")}var m=a.Event("slid.bs.carousel",{relatedTarget:j,direction:g});return a.support.transition&&this.$element.hasClass("slide")?(e.addClass(b),e[0].offsetWidth,d.addClass(g),e.addClass(g),d.one("bsTransitionEnd",function(){e.removeClass([b,g].join(" ")).addClass("active"),d.removeClass(["active",g].join(" ")),i.sliding=!1,setTimeout(function(){i.$element.trigger(m)},0)}).emulateTransitionEnd(1e3*d.css("transition-duration").slice(0,-1))):(d.removeClass("active"),e.addClass("active"),this.sliding=!1,this.$element.trigger(m)),f&&this.cycle(),this}};var d=a.fn.carousel;a.fn.carousel=b,a.fn.carousel.Constructor=c,a.fn.carousel.noConflict=function(){return a.fn.carousel=d,this},a(document).on("click.bs.carousel.data-api","[data-slide], [data-slide-to]",function(c){var d,e=a(this),f=a(e.attr("data-target")||(d=e.attr("href"))&&d.replace(/.*(?=#[^\s]+$)/,""));if(f.hasClass("carousel")){var g=a.extend({},f.data(),e.data()),h=e.attr("data-slide-to");h&&(g.interval=!1),b.call(f,g),h&&f.data("bs.carousel").to(h),c.preventDefault()}}),a(window).on("load",function(){a('[data-ride="carousel"]').each(function(){var c=a(this);b.call(c,c.data())})})}(jQuery),function(a){"use strict";function b(b){return this.each(function(){var d=a(this),e=d.data("bs.collapse"),f=a.extend({},c.DEFAULTS,d.data(),"object"==typeof b&&b);!e&&f.toggle&&"show"==b&&(b=!b),e||d.data("bs.collapse",e=new c(this,f)),"string"==typeof b&&e[b]()})}var c=function(b,d){this.$element=a(b),this.options=a.extend({},c.DEFAULTS,d),this.transitioning=null,this.options.parent&&(this.$parent=a(this.options.parent)),this.options.toggle&&this.toggle()};c.VERSION="3.2.0",c.DEFAULTS={toggle:!0},c.prototype.dimension=function(){return this.$element.hasClass("width")?"width":"height"},c.prototype.show=function(){if(!this.transitioning&&!this.$element.hasClass("in")){var c=a.Event("show.bs.collapse");if(this.$element.trigger(c),!c.isDefaultPrevented()){var d=this.$parent&&this.$parent.find("> .panel > .in");if(d&&d.length){var e=d.data("bs.collapse");if(e&&e.transitioning)return;b.call(d,"hide"),e||d.data("bs.collapse",null)}var f=this.dimension();this.$element.removeClass("collapse").addClass("collapsing")[f](0),this.transitioning=1;var g=function(){this.$element.removeClass("collapsing").addClass("collapse in")[f](""),this.transitioning=0,this.$element.trigger("shown.bs.collapse")};if(!a.support.transition)return g.call(this);var h=a.camelCase(["scroll",f].join("-"));this.$element.one("bsTransitionEnd",a.proxy(g,this)).emulateTransitionEnd(350)[f](this.$element[0][h])}}},c.prototype.hide=function(){if(!this.transitioning&&this.$element.hasClass("in")){var b=a.Event("hide.bs.collapse");if(this.$element.trigger(b),!b.isDefaultPrevented()){var c=this.dimension();this.$element[c](this.$element[c]())[0].offsetHeight,this.$element.addClass("collapsing").removeClass("collapse").removeClass("in"),this.transitioning=1;var d=function(){this.transitioning=0,this.$element.trigger("hidden.bs.collapse").removeClass("collapsing").addClass("collapse")};return a.support.transition?void this.$element[c](0).one("bsTransitionEnd",a.proxy(d,this)).emulateTransitionEnd(350):d.call(this)}}},c.prototype.toggle=function(){this[this.$element.hasClass("in")?"hide":"show"]()};var d=a.fn.collapse;a.fn.collapse=b,a.fn.collapse.Constructor=c,a.fn.collapse.noConflict=function(){return a.fn.collapse=d,this},a(document).on("click.bs.collapse.data-api",'[data-toggle="collapse"]',function(c){var d,e=a(this),f=e.attr("data-target")||c.preventDefault()||(d=e.attr("href"))&&d.replace(/.*(?=#[^\s]+$)/,""),g=a(f),h=g.data("bs.collapse"),i=h?"toggle":e.data(),j=e.attr("data-parent"),k=j&&a(j);h&&h.transitioning||(k&&k.find('[data-toggle="collapse"][data-parent="'+j+'"]').not(e).addClass("collapsed"),e[g.hasClass("in")?"addClass":"removeClass"]("collapsed")),b.call(g,i)})}(jQuery),function(a){"use strict";function b(b){b&&3===b.which||(a(e).remove(),a(f).each(function(){var d=c(a(this)),e={relatedTarget:this};d.hasClass("open")&&(d.trigger(b=a.Event("hide.bs.dropdown",e)),b.isDefaultPrevented()||d.removeClass("open").trigger("hidden.bs.dropdown",e))}))}function c(b){var c=b.attr("data-target");c||(c=(c=b.attr("href"))&&/#[A-Za-z]/.test(c)&&c.replace(/.*(?=#[^\s]*$)/,""));var d=c&&a(c);return d&&d.length?d:b.parent()}var e=".dropdown-backdrop",f='[data-toggle="dropdown"]',g=function(b){a(b).on("click.bs.dropdown",this.toggle)};g.VERSION="3.2.0",g.prototype.toggle=function(d){var e=a(this);if(!e.is(".disabled, :disabled")){var f=c(e),g=f.hasClass("open");if(b(),!g){"ontouchstart"in document.documentElement&&!f.closest(".navbar-nav").length&&a('<div class="dropdown-backdrop"/>').insertAfter(a(this)).on("click",b);var h={relatedTarget:this};if(f.trigger(d=a.Event("show.bs.dropdown",h)),d.isDefaultPrevented())return;e.trigger("focus"),f.toggleClass("open").trigger("shown.bs.dropdown",h)}return!1}},g.prototype.keydown=function(b){if(/(38|40|27)/.test(b.keyCode)){var d=a(this);if(b.preventDefault(),b.stopPropagation(),!d.is(".disabled, :disabled")){var e=c(d),g=e.hasClass("open");if(!g||g&&27==b.keyCode)return 27==b.which&&e.find(f).trigger("focus"),d.trigger("click");var h=" li:not(.divider):visible a",i=e.find('[role="menu"]'+h+', [role="listbox"]'+h);if(i.length){var j=i.index(i.filter(":focus"));38==b.keyCode&&j>0&&j--,40==b.keyCode&&j<i.length-1&&j++,~j||(j=0),i.eq(j).trigger("focus")}}}};var h=a.fn.dropdown;a.fn.dropdown=function d(b){return this.each(function(){var c=a(this),d=c.data("bs.dropdown");d||c.data("bs.dropdown",d=new g(this)),"string"==typeof b&&d[b].call(c)})},a.fn.dropdown.Constructor=g,a.fn.dropdown.noConflict=function(){return a.fn.dropdown=h,this},a(document).on("click.bs.dropdown.data-api",b).on("click.bs.dropdown.data-api",".dropdown form",function(a){a.stopPropagation()}).on("click.bs.dropdown.data-api",f,g.prototype.toggle).on("keydown.bs.dropdown.data-api",f+', [role="menu"], [role="listbox"]',g.prototype.keydown)}(jQuery),function(a){"use strict";function b(b,d){return this.each(function(){var e=a(this),f=e.data("bs.modal"),g=a.extend({},c.DEFAULTS,e.data(),"object"==typeof b&&b);f||e.data("bs.modal",f=new c(this,g)),"string"==typeof b?f[b](d):g.show&&f.show(d)})}var c=function(b,c){this.options=c,this.$body=a(document.body),this.$element=a(b),this.$backdrop=this.isShown=null,this.scrollbarWidth=0,this.options.remote&&this.$element.find(".modal-content").load(this.options.remote,a.proxy(function(){this.$element.trigger("loaded.bs.modal")},this))};c.VERSION="3.2.0",c.DEFAULTS={backdrop:!0,keyboard:!0,show:!0},c.prototype.toggle=function(a){return this.isShown?this.hide():this.show(a)},c.prototype.show=function(b){var c=this,d=a.Event("show.bs.modal",{relatedTarget:b});this.$element.trigger(d),this.isShown||d.isDefaultPrevented()||(this.isShown=!0,this.checkScrollbar(),this.$body.addClass("modal-open"),this.setScrollbar(),this.escape(),this.$element.on("click.dismiss.bs.modal",'[data-dismiss="modal"]',a.proxy(this.hide,this)),this.backdrop(function(){var d=a.support.transition&&c.$element.hasClass("fade");c.$element.parent().length||c.$element.appendTo(c.$body),c.$element.show().scrollTop(0),d&&c.$element[0].offsetWidth,c.$element.addClass("in").attr("aria-hidden",!1),c.enforceFocus();var e=a.Event("shown.bs.modal",{relatedTarget:b});d?c.$element.find(".modal-dialog").one("bsTransitionEnd",function(){c.$element.trigger("focus").trigger(e)}).emulateTransitionEnd(300):c.$element.trigger("focus").trigger(e)}))},c.prototype.hide=function(b){b&&b.preventDefault(),b=a.Event("hide.bs.modal"),this.$element.trigger(b),this.isShown&&!b.isDefaultPrevented()&&(this.isShown=!1,this.$body.removeClass("modal-open"),this.resetScrollbar(),this.escape(),a(document).off("focusin.bs.modal"),this.$element.removeClass("in").attr("aria-hidden",!0).off("click.dismiss.bs.modal"),a.support.transition&&this.$element.hasClass("fade")?this.$element.one("bsTransitionEnd",a.proxy(this.hideModal,this)).emulateTransitionEnd(300):this.hideModal())},c.prototype.enforceFocus=function(){a(document).off("focusin.bs.modal").on("focusin.bs.modal",a.proxy(function(a){this.$element[0]===a.target||this.$element.has(a.target).length||this.$element.trigger("focus")},this))},c.prototype.escape=function(){this.isShown&&this.options.keyboard?this.$element.on("keyup.dismiss.bs.modal",a.proxy(function(a){27==a.which&&this.hide()},this)):this.isShown||this.$element.off("keyup.dismiss.bs.modal")},c.prototype.hideModal=function(){var a=this;this.$element.hide(),this.backdrop(function(){a.$element.trigger("hidden.bs.modal")})},c.prototype.removeBackdrop=function(){this.$backdrop&&this.$backdrop.remove(),this.$backdrop=null},c.prototype.backdrop=function(b){var c=this,d=this.$element.hasClass("fade")?"fade":"";if(this.isShown&&this.options.backdrop){var e=a.support.transition&&d;if(this.$backdrop=a('<div class="modal-backdrop '+d+'" />').appendTo(this.$body),this.$element.on("click.dismiss.bs.modal",a.proxy(function(a){a.target===a.currentTarget&&("static"==this.options.backdrop?this.$element[0].focus.call(this.$element[0]):this.hide.call(this))},this)),e&&this.$backdrop[0].offsetWidth,this.$backdrop.addClass("in"),!b)return;e?this.$backdrop.one("bsTransitionEnd",b).emulateTransitionEnd(150):b()}else if(!this.isShown&&this.$backdrop){this.$backdrop.removeClass("in");var f=function(){c.removeBackdrop(),b&&b()};a.support.transition&&this.$element.hasClass("fade")?this.$backdrop.one("bsTransitionEnd",f).emulateTransitionEnd(150):f()}else b&&b()},c.prototype.checkScrollbar=function(){document.body.clientWidth>=window.innerWidth||(this.scrollbarWidth=this.scrollbarWidth||this.measureScrollbar())},c.prototype.setScrollbar=function(){var a=parseInt(this.$body.css("padding-right")||0,10);this.scrollbarWidth&&this.$body.css("padding-right",a+this.scrollbarWidth)},c.prototype.resetScrollbar=function(){this.$body.css("padding-right","")},c.prototype.measureScrollbar=function(){var a=document.createElement("div");a.className="modal-scrollbar-measure",this.$body.append(a);var b=a.offsetWidth-a.clientWidth;return this.$body[0].removeChild(a),b};var d=a.fn.modal;a.fn.modal=b,a.fn.modal.Constructor=c,a.fn.modal.noConflict=function(){return a.fn.modal=d,this},a(document).on("click.bs.modal.data-api",'[data-toggle="modal"]',function(c){var d=a(this),e=d.attr("href"),f=a(d.attr("data-target")||e&&e.replace(/.*(?=#[^\s]+$)/,"")),g=f.data("bs.modal")?"toggle":a.extend({remote:!/#/.test(e)&&e},f.data(),d.data());d.is("a")&&c.preventDefault(),f.one("show.bs.modal",function(a){a.isDefaultPrevented()||f.one("hidden.bs.modal",function(){d.is(":visible")&&d.trigger("focus")})}),b.call(f,g,this)})}(jQuery),function(a){"use strict";var c=function(a,b){this.type=this.options=this.enabled=this.timeout=this.hoverState=this.$element=null,this.init("tooltip",a,b)};c.VERSION="3.2.0",c.DEFAULTS={animation:!0,placement:"top",selector:!1,template:'<div class="tooltip" role="tooltip"><div class="tooltip-arrow"></div><div class="tooltip-inner"></div></div>',trigger:"hover focus",title:"",delay:0,html:!1,container:!1,viewport:{selector:"body",padding:0}},c.prototype.init=function(b,c,d){this.enabled=!0,this.type=b,this.$element=a(c),this.options=this.getOptions(d),this.$viewport=this.options.viewport&&a(this.options.viewport.selector||this.options.viewport);for(var e=this.options.trigger.split(" "),f=e.length;f--;){var g=e[f];if("click"==g)this.$element.on("click."+this.type,this.options.selector,a.proxy(this.toggle,this));else if("manual"!=g){var h="hover"==g?"mouseenter":"focusin",i="hover"==g?"mouseleave":"focusout";this.$element.on(h+"."+this.type,this.options.selector,a.proxy(this.enter,this)),this.$element.on(i+"."+this.type,this.options.selector,a.proxy(this.leave,this))}}this.options.selector?this._options=a.extend({},this.options,{trigger:"manual",selector:""}):this.fixTitle()},c.prototype.getDefaults=function(){return c.DEFAULTS},c.prototype.getOptions=function(b){return(b=a.extend({},this.getDefaults(),this.$element.data(),b)).delay&&"number"==typeof b.delay&&(b.delay={show:b.delay,hide:b.delay}),b},c.prototype.getDelegateOptions=function(){var b={},c=this.getDefaults();return this._options&&a.each(this._options,function(a,d){c[a]!=d&&(b[a]=d)}),b},c.prototype.enter=function(b){var c=b instanceof this.constructor?b:a(b.currentTarget).data("bs."+this.type);return c||(c=new this.constructor(b.currentTarget,this.getDelegateOptions()),a(b.currentTarget).data("bs."+this.type,c)),clearTimeout(c.timeout),c.hoverState="in",c.options.delay&&c.options.delay.show?void(c.timeout=setTimeout(function(){"in"==c.hoverState&&c.show()},c.options.delay.show)):c.show()},c.prototype.leave=function(b){var c=b instanceof this.constructor?b:a(b.currentTarget).data("bs."+this.type);return c||(c=new this.constructor(b.currentTarget,this.getDelegateOptions()),a(b.currentTarget).data("bs."+this.type,c)),clearTimeout(c.timeout),c.hoverState="out",c.options.delay&&c.options.delay.hide?void(c.timeout=setTimeout(function(){"out"==c.hoverState&&c.hide()},c.options.delay.hide)):c.hide()},c.prototype.show=function(){var b=a.Event("show.bs."+this.type);if(this.hasContent()&&this.enabled){this.$element.trigger(b);var c=a.contains(document.documentElement,this.$element[0]);if(b.isDefaultPrevented()||!c)return;var d=this,e=this.tip(),f=this.getUID(this.type);this.setContent(),e.attr("id",f),this.$element.attr("aria-describedby",f),this.options.animation&&e.addClass("fade");var g="function"==typeof this.options.placement?this.options.placement.call(this,e[0],this.$element[0]):this.options.placement,h=/\s?auto?\s?/i,i=h.test(g);i&&(g=g.replace(h,"")||"top"),e.detach().css({top:0,left:0,display:"block"}).addClass(g).data("bs."+this.type,this),this.options.container?e.appendTo(this.options.container):e.insertAfter(this.$element);var j=this.getPosition(),k=e[0].offsetWidth,l=e[0].offsetHeight;if(i){var m=g,n=this.$element.parent(),o=this.getPosition(n);g="bottom"==g&&j.top+j.height+l-o.scroll>o.height?"top":"top"==g&&j.top-o.scroll-l<0?"bottom":"right"==g&&j.right+k>o.width?"left":"left"==g&&j.left-k<o.left?"right":g,e.removeClass(m).addClass(g)}var p=this.getCalculatedOffset(g,j,k,l);this.applyPlacement(p,g);var q=function(){d.$element.trigger("shown.bs."+d.type),d.hoverState=null};a.support.transition&&this.$tip.hasClass("fade")?e.one("bsTransitionEnd",q).emulateTransitionEnd(150):q()}},c.prototype.applyPlacement=function(b,c){var d=this.tip(),e=d[0].offsetWidth,f=d[0].offsetHeight,g=parseInt(d.css("margin-top"),10),h=parseInt(d.css("margin-left"),10);isNaN(g)&&(g=0),isNaN(h)&&(h=0),b.top=b.top+g,b.left=b.left+h,a.offset.setOffset(d[0],a.extend({using:function(a){d.css({top:Math.round(a.top),left:Math.round(a.left)})}},b),0),d.addClass("in");var i=d[0].offsetWidth,j=d[0].offsetHeight;"top"==c&&j!=f&&(b.top=b.top+f-j);var k=this.getViewportAdjustedDelta(c,b,i,j);k.left?b.left+=k.left:b.top+=k.top;var l=k.left?2*k.left-e+i:2*k.top-f+j,m=k.left?"left":"top",n=k.left?"offsetWidth":"offsetHeight";d.offset(b),this.replaceArrow(l,d[0][n],m)},c.prototype.replaceArrow=function(a,b,c){this.arrow().css(c,a?50*(1-a/b)+"%":"")},c.prototype.setContent=function(){var a=this.tip(),b=this.getTitle();a.find(".tooltip-inner")[this.options.html?"html":"text"](b),a.removeClass("fade in top bottom left right")},c.prototype.hide=function(){function b(){"in"!=c.hoverState&&d.detach(),c.$element.trigger("hidden.bs."+c.type)}var c=this,d=this.tip(),e=a.Event("hide.bs."+this.type);return this.$element.removeAttr("aria-describedby"),this.$element.trigger(e),e.isDefaultPrevented()?void 0:(d.removeClass("in"),a.support.transition&&this.$tip.hasClass("fade")?d.one("bsTransitionEnd",b).emulateTransitionEnd(150):b(),this.hoverState=null,this)},c.prototype.fixTitle=function(){var a=this.$element;(a.attr("title")||"string"!=typeof a.attr("data-original-title"))&&a.attr("data-original-title",a.attr("title")||"").attr("title","")},c.prototype.hasContent=function(){return this.getTitle()},c.prototype.getPosition=function(b){var c=(b=b||this.$element)[0],d="BODY"==c.tagName;return a.extend({},"function"==typeof c.getBoundingClientRect?c.getBoundingClientRect():null,{scroll:d?document.documentElement.scrollTop||document.body.scrollTop:b.scrollTop(),width:d?a(window).width():b.outerWidth(),height:d?a(window).height():b.outerHeight()},d?{top:0,left:0}:b.offset())},c.prototype.getCalculatedOffset=function(a,b,c,d){return"bottom"==a?{top:b.top+b.height,left:b.left+b.width/2-c/2}:"top"==a?{top:b.top-d,left:b.left+b.width/2-c/2}:"left"==a?{top:b.top+b.height/2-d/2,left:b.left-c}:{top:b.top+b.height/2-d/2,left:b.left+b.width}},c.prototype.getViewportAdjustedDelta=function(a,b,c,d){var e={top:0,left:0};if(!this.$viewport)return e;var f=this.options.viewport&&this.options.viewport.padding||0,g=this.getPosition(this.$viewport);if(/right|left/.test(a)){var h=b.top-f-g.scroll,i=b.top+f-g.scroll+d;h<g.top?e.top=g.top-h:i>g.top+g.height&&(e.top=g.top+g.height-i)}else{var j=b.left-f,k=b.left+f+c;j<g.left?e.left=g.left-j:k>g.width&&(e.left=g.left+g.width-k)}return e},c.prototype.getTitle=function(){var b=this.$element,c=this.options;return b.attr("data-original-title")||("function"==typeof c.title?c.title.call(b[0]):c.title)},c.prototype.getUID=function(a){do{a+=~~(1e6*Math.random())}while(document.getElementById(a));return a},c.prototype.tip=function(){return this.$tip=this.$tip||a(this.options.template)},c.prototype.arrow=function(){return this.$arrow=this.$arrow||this.tip().find(".tooltip-arrow")},c.prototype.validate=function(){this.$element[0].parentNode||(this.hide(),this.$element=null,this.options=null)},c.prototype.enable=function(){this.enabled=!0},c.prototype.disable=function(){this.enabled=!1},c.prototype.toggleEnabled=function(){this.enabled=!this.enabled},c.prototype.toggle=function(b){var c=this;b&&((c=a(b.currentTarget).data("bs."+this.type))||(c=new this.constructor(b.currentTarget,this.getDelegateOptions()),a(b.currentTarget).data("bs."+this.type,c))),c.tip().hasClass("in")?c.leave(c):c.enter(c)},c.prototype.destroy=function(){clearTimeout(this.timeout),this.hide().$element.off("."+this.type).removeData("bs."+this.type)};var d=a.fn.tooltip;a.fn.tooltip=function b(b){return this.each(function(){var d=a(this),e=d.data("bs.tooltip"),f="object"==typeof b&&b;(e||"destroy"!=b)&&(e||d.data("bs.tooltip",e=new c(this,f)),"string"==typeof b&&e[b]())})},a.fn.tooltip.Constructor=c,a.fn.tooltip.noConflict=function(){return a.fn.tooltip=d,this}}(jQuery),function(a){"use strict";var c=function(a,b){this.init("popover",a,b)};if(!a.fn.tooltip)throw new Error("Popover requires tooltip.js");c.VERSION="3.2.0",c.DEFAULTS=a.extend({},a.fn.tooltip.Constructor.DEFAULTS,{placement:"right",trigger:"click",content:"",template:'<div class="popover" role="tooltip"><div class="arrow"></div><h3 class="popover-title"></h3><div class="popover-content"></div></div>'}),c.prototype=a.extend({},a.fn.tooltip.Constructor.prototype),c.prototype.constructor=c,c.prototype.getDefaults=function(){return c.DEFAULTS},c.prototype.setContent=function(){var a=this.tip(),b=this.getTitle(),c=this.getContent();a.find(".popover-title")[this.options.html?"html":"text"](b),a.find(".popover-content").empty()[this.options.html?"string"==typeof c?"html":"append":"text"](c),a.removeClass("fade top bottom left right in"),a.find(".popover-title").html()||a.find(".popover-title").hide()},c.prototype.hasContent=function(){return this.getTitle()||this.getContent()},c.prototype.getContent=function(){var a=this.$element,b=this.options;return a.attr("data-content")||("function"==typeof b.content?b.content.call(a[0]):b.content)},c.prototype.arrow=function(){return this.$arrow=this.$arrow||this.tip().find(".arrow")},c.prototype.tip=function(){return this.$tip||(this.$tip=a(this.options.template)),this.$tip};var d=a.fn.popover;a.fn.popover=function b(b){return this.each(function(){var d=a(this),e=d.data("bs.popover"),f="object"==typeof b&&b;(e||"destroy"!=b)&&(e||d.data("bs.popover",e=new c(this,f)),"string"==typeof b&&e[b]())})},a.fn.popover.Constructor=c,a.fn.popover.noConflict=function(){return a.fn.popover=d,this}}(jQuery),function(a){"use strict";function b(c,d){var e=a.proxy(this.process,this);this.$body=a("body"),this.$scrollElement=a(a(c).is("body")?window:c),this.options=a.extend({},b.DEFAULTS,d),this.selector=(this.options.target||"")+" .nav li > a",this.offsets=[],this.targets=[],this.activeTarget=null,this.scrollHeight=0,this.$scrollElement.on("scroll.bs.scrollspy",e),this.refresh(),this.process()}function c(c){return this.each(function(){var d=a(this),e=d.data("bs.scrollspy"),f="object"==typeof c&&c;e||d.data("bs.scrollspy",e=new b(this,f)),"string"==typeof c&&e[c]()})}b.VERSION="3.2.0",b.DEFAULTS={offset:10},b.prototype.getScrollHeight=function(){return this.$scrollElement[0].scrollHeight||Math.max(this.$body[0].scrollHeight,document.documentElement.scrollHeight)},b.prototype.refresh=function(){var b="offset",c=0;a.isWindow(this.$scrollElement[0])||(b="position",c=this.$scrollElement.scrollTop()),this.offsets=[],this.targets=[],this.scrollHeight=this.getScrollHeight();var d=this;this.$body.find(this.selector).map(function(){var d=a(this),e=d.data("target")||d.attr("href"),f=/^#./.test(e)&&a(e);return f&&f.length&&f.is(":visible")&&[[f[b]().top+c,e]]||null}).sort(function(a,b){return a[0]-b[0]}).each(function(){d.offsets.push(this[0]),d.targets.push(this[1])})},b.prototype.process=function(){var a,b=this.$scrollElement.scrollTop()+this.options.offset,c=this.getScrollHeight(),d=this.options.offset+c-this.$scrollElement.height(),e=this.offsets,f=this.targets,g=this.activeTarget;if(this.scrollHeight!=c&&this.refresh(),b>=d)return g!=(a=f[f.length-1])&&this.activate(a);if(g&&b<=e[0])return g!=(a=f[0])&&this.activate(a);for(a=e.length;a--;)g!=f[a]&&b>=e[a]&&(!e[a+1]||b<=e[a+1])&&this.activate(f[a])},b.prototype.activate=function(b){this.activeTarget=b,a(this.selector).parentsUntil(this.options.target,".active").removeClass("active");var c=this.selector+'[data-target="'+b+'"],'+this.selector+'[href="'+b+'"]',d=a(c).parents("li").addClass("active");d.parent(".dropdown-menu").length&&(d=d.closest("li.dropdown").addClass("active")),d.trigger("activate.bs.scrollspy")};var d=a.fn.scrollspy;a.fn.scrollspy=c,a.fn.scrollspy.Constructor=b,a.fn.scrollspy.noConflict=function(){return a.fn.scrollspy=d,this},a(window).on("load.bs.scrollspy.data-api",function(){a('[data-spy="scroll"]').each(function(){var b=a(this);c.call(b,b.data())})})}(jQuery),function(a){"use strict";function b(b){return this.each(function(){var d=a(this),e=d.data("bs.tab");e||d.data("bs.tab",e=new c(this)),"string"==typeof b&&e[b]()})}var c=function(b){this.element=a(b)};c.VERSION="3.2.0",c.prototype.show=function(){var b=this.element,c=b.closest("ul:not(.dropdown-menu)"),d=b.data("target");if(d||(d=(d=b.attr("href"))&&d.replace(/.*(?=#[^\s]*$)/,"")),!b.parent("li").hasClass("active")){var e=c.find(".active:last a")[0],f=a.Event("show.bs.tab",{relatedTarget:e});if(b.trigger(f),!f.isDefaultPrevented()){var g=a(d);this.activate(b.closest("li"),c),this.activate(g,g.parent(),function(){b.trigger({type:"shown.bs.tab",relatedTarget:e})})}}},c.prototype.activate=function(b,c,d){function e(){f.removeClass("active").find("> .dropdown-menu > .active").removeClass("active"),b.addClass("active"),g?(b[0].offsetWidth,b.addClass("in")):b.removeClass("fade"),b.parent(".dropdown-menu")&&b.closest("li.dropdown").addClass("active"),d&&d()}var f=c.find("> .active"),g=d&&a.support.transition&&f.hasClass("fade");g?f.one("bsTransitionEnd",e).emulateTransitionEnd(150):e(),f.removeClass("in")};var d=a.fn.tab;a.fn.tab=b,a.fn.tab.Constructor=c,a.fn.tab.noConflict=function(){return a.fn.tab=d,this},a(document).on("click.bs.tab.data-api",'[data-toggle="tab"], [data-toggle="pill"]',function(c){c.preventDefault(),b.call(a(this),"show")})}(jQuery),function(a){"use strict";function b(b){return this.each(function(){var d=a(this),e=d.data("bs.affix"),f="object"==typeof b&&b;e||d.data("bs.affix",e=new c(this,f)),"string"==typeof b&&e[b]()})}var c=function(b,d){this.options=a.extend({},c.DEFAULTS,d),this.$target=a(this.options.target).on("scroll.bs.affix.data-api",a.proxy(this.checkPosition,this)).on("click.bs.affix.data-api",a.proxy(this.checkPositionWithEventLoop,this)),this.$element=a(b),this.affixed=this.unpin=this.pinnedOffset=null,this.checkPosition()};c.VERSION="3.2.0",c.RESET="affix affix-top affix-bottom",c.DEFAULTS={offset:0,target:window},c.prototype.getPinnedOffset=function(){if(this.pinnedOffset)return this.pinnedOffset;this.$element.removeClass(c.RESET).addClass("affix");var a=this.$target.scrollTop(),b=this.$element.offset();return this.pinnedOffset=b.top-a},c.prototype.checkPositionWithEventLoop=function(){setTimeout(a.proxy(this.checkPosition,this),1)},c.prototype.checkPosition=function(){if(this.$element.is(":visible")){var b=a(document).height(),d=this.$target.scrollTop(),e=this.$element.offset(),f=this.options.offset,g=f.top,h=f.bottom;"object"!=typeof f&&(h=g=f),"function"==typeof g&&(g=f.top(this.$element)),"function"==typeof h&&(h=f.bottom(this.$element));var i=!(null!=this.unpin&&d+this.unpin<=e.top)&&(null!=h&&e.top+this.$element.height()>=b-h?"bottom":null!=g&&g>=d&&"top");if(this.affixed!==i){null!=this.unpin&&this.$element.css("top","");var j="affix"+(i?"-"+i:""),k=a.Event(j+".bs.affix");this.$element.trigger(k),k.isDefaultPrevented()||(this.affixed=i,this.unpin="bottom"==i?this.getPinnedOffset():null,this.$element.removeClass(c.RESET).addClass(j).trigger(a.Event(j.replace("affix","affixed"))),"bottom"==i&&this.$element.offset({top:b-this.$element.height()-h}))}}};var d=a.fn.affix;a.fn.affix=b,a.fn.affix.Constructor=c,a.fn.affix.noConflict=function(){return a.fn.affix=d,this},a(window).on("load",function(){a('[data-spy="affix"]').each(function(){var c=a(this),d=c.data();d.offset=d.offset||{},d.offsetBottom&&(d.offset.bottom=d.offsetBottom),d.offsetTop&&(d.offset.top=d.offsetTop),b.call(c,d)})})}(jQuery);